---
title: Pruebas y Ejemplos
description: >-
  Prueba la integraci√≥n de tu juego localmente, revisa ejemplos completos y
  soluciona problemas comunes.
lang: es
originalPath: upside/testing-and-examples.mdx
---
## Pruebas en Localhost

### Configuraci√≥n R√°pida de Pruebas

Puedes probar tu juego ejecut√°ndose en localhost directamente en el entorno de prueba de Upside.win sin necesidad de desplegarlo.

**C√≥mo funciona:**

1. Ejecuta tu backend de juego en `http://localhost:3000` (o cualquier puerto)
2. Codifica en Base64 tu URL de localhost
3. Navega a la URL de prueba en upside.win

### Paso a Paso

**Paso 1: Inicia tu backend de juego**

```bash
npm run dev
# Juego ejecut√°ndose en http://localhost:3000
```

**Paso 2: Codifica tu URL en Base64**

Usando Node.js:

```javascript
const url = "http://localhost:3000";
const encoded = Buffer.from(url).toString("base64");
console.log(encoded); // aHR0cDovL2xvY2FsaG9zdDozMDAw
```

Usando la l√≠nea de comandos:

```bash
echo -n "http://localhost:3000" | base64
# aHR0cDovL2xvY2FsaG9zdDozMDAw
```

En l√≠nea: Usa cualquier codificador base64 en https://www.base64encode.org/

**Paso 3: Prueba en Upside.win**

Visita la URL de prueba:

```
https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDozMDAw
```

Reemplaza `aHR0cDovL2xvY2FsaG9zdDozMDAw` con tu URL codificada.

### Ejemplos

Diferentes URLs de localhost:

| URL                     | Base64                         | Enlace de Prueba                                             |
| ----------------------- | ------------------------------ | ------------------------------------------------------------ |
| `http://localhost:3000` | `aHR0cDovL2xvY2FsaG9zdDozMDAw` | `https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDozMDAw` |
| `http://localhost:5000` | `aHR0cDovL2xvY2FsaG9zdDo1MDOw` | `https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDo1MDOw` |
| `http://127.0.0.1:3000` | `aHR0cDovLzEyNy4wLjAuMTozMDAw` | `https://upside.win/test/games/aHR0cDovLzEyNy4wLjAuMTozMDAw` |

### Flujo de Desarrollo

1. **Crea el c√≥digo del juego** - Escribe tu frontend de React y backend de Cloudflare Hono
2. **Inicia localmente** - Ejecuta `npm run dev` en localhost
3. **Genera la URL de prueba** - Codifica en Base64 tu direcci√≥n de localhost
4. **Prueba en Upside** - Visita `https://upside.win/test/games/<BASE64>`
5. **Obt√©n JWT y prueba** - El juego se carga con un JWT real para pruebas
6. **Itera** - Haz cambios localmente y actualiza la URL de prueba
7. **Despliega** - Cuando est√©s listo, despliega el backend y actualiza la URL del juego

### Consejos para Pruebas Locales

- **Usa la misma m√°quina**: Mant√©n localhost ejecut√°ndose mientras pruebas
- **Revisa CORS**: Aseg√∫rate de que tu backend permite solicitudes desde dominios de upside.win

### Soluci√≥n de Problemas en Pruebas Locales

**Problema**: "Juego no encontrado" o 404

- **Soluci√≥n**: Verifica que la URL de localhost sea correcta y la codificaci√≥n sea precisa

**Problema**: Errores de CORS

- **Soluci√≥n**: Tu backend necesita aceptar solicitudes desde el dominio de upside.win

**Problema**: Errores de JWT durante las pruebas

- **Soluci√≥n**: Aseg√∫rate de estar usando la clave API de staging, no de producci√≥n

**Problema**: Solicitudes de red fallando

- **Soluci√≥n**: Verifica que localhost est√© ejecut√°ndose y el firewall permita solicitudes

## Ejemplo Completo: Juego de Volado

### Frontend (React)

```javascript
import { ParentProvider, useParentContext } from "@b3dotfun/upside-sdk";

export default function CoinFlipGame() {
  return (
    <ParentProvider>
      <CoinFlipContent />
    </ParentProvider>
  );
}

function CoinFlipContent() {
  const { token, balance, playerId } = useParentContext();
  const [gameState, setGameState] = useState("ready"); // ready, playing, won, lost
  const [prediction, setPrediction] = useState(null);
  const [result, setResult] = useState(null);
  const [earnings, setEarnings] = useState(0);

  const playGame = async playerPrediction => {
    setPrediction(playerPrediction);
    setGameState("playing");

    try {
      // Llama a tu backend
      const response = await fetch("/api/game/coin-flip", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          playerId,
          prediction: playerPrediction,
          betAmount: "100000000000000000", // 1 token en wei
        }),
      });

      const data = await response.json();

      if (data.outcome === "win") {
        setGameState("won");
        setEarnings(data.payout);
      } else {
        setGameState("lost");
        setEarnings(0);
      }

      setResult(data.result);
    } catch (error) {
      console.error("Error del juego:", error);
      setGameState("error");
    }
  };

  return (
    <div style={{ textAlign: "center", padding: "40px" }}>
      <h1>Volado</h1>
      <p>Saldo: {(balance / 1e18).toFixed(2)} WIN</p>

      {gameState === "ready" && (
        <div>
          <button onClick={() => playGame("heads")}>Predecir Cara</button>
          <button onClick={() => playGame("tails")}>Predecir Cruz</button>
        </div>
      )}

      {gameState === "playing" && <p>Volteando...</p>}

      {gameState === "won" && (
        <div>
          <p>üéâ ¬°Ganaste! La moneda cay√≥ en {result}</p>
          <p>+{(earnings / 1e18).toFixed(2)} WIN</p>
        </div>
      )}

      {gameState === "lost" && (
        <div>
          <p>‚ùå ¬°Perdiste! La moneda cay√≥ en {result}</p>
          <p>Mejor suerte la pr√≥xima vez</p>
        </div>
      )}

      {gameState !== "ready" && <button onClick={() => setGameState("ready")}>Jugar de Nuevo</button>}
    </div>
  );
}
```

### Backend (Hono + Cloudflare Workers)

```javascript
import { Hono } from "hono";
import { createB3Client } from "@b3dotfun/upside-sdk/server";

const app = new Hono();

app.post("/api/game/coin-flip", async c => {
  const { prediction, betAmount } = await c.req.json();

  try {
    // Crea B3Client desde el contexto de Hono
    // Extrae autom√°ticamente el token de autenticaci√≥n del encabezado Authorization
    const b3Client = createB3Client(c);

    // Paso 1: Coloca la apuesta (cantidad en wei)
    const betResult = await b3Client.placeBet("coin-flip", betAmount);

    if (!betResult.sessionId) {
      return c.json({ error: "Fall√≥ al colocar la apuesta" }, 400);
    }

    // Paso 2: L√≥gica del juego - voltea la moneda
    const coin = Math.random() < 0.5 ? "heads" : "tails";
    const isWin = coin === prediction;
    // Calcula el pago: 50% de ganancia en caso de victoria (betAmount * 1.5, en wei)
    const payout = isWin ? (BigInt(betAmount) * BigInt(150)) / BigInt(100) : "0";

    // Paso 3: Almacena el juego en tu base de datos (D1, etc.)
    // await db.execute(
    //   "INSERT INTO games (sessionId, prediction, result, betAmount, payout) VALUES (?, ?, ?, ?, ?)",
    //   [betResult.sessionId, prediction, coin, betAmount, payout.toString()]
    // );

    // Paso 4: Procesa el pago
    const payoutResult = await b3Client.processPayout("coin-flip", betResult.sessionId, payout.toString(), {
      playerChoice: prediction,
      result: coin,
      outcome: isWin ? "win" : "loss",
    });

    // Paso 5: Devuelve el resultado al frontend
    return c.json({
      sessionId: betResult.sessionId,
      prediction,
      result: coin,
      outcome: isWin ? "win" : "loss",
      payout: isWin ? payout.toString() : "0",
      newBalance: payoutResult.newBalance,
    });
  } catch (error) {
    console.error("Error del juego:", error);
    return c.json({ error: error.message }, 500);
  }
});

export default app;
```

## Soluci√≥n de Problemas

### Problemas Comunes

**Problema**: `placeBet` falla con "Saldo insuficiente"

- **Soluci√≥n**: Verifica el saldo del jugador antes de colocar la apuesta, o aumenta la cantidad de la apuesta mostrada en la UI

**Problema**: `processPayout` devuelve "sesi√≥n no encontrada"

- **Soluci√≥n**: Verifica que el sessionId coincida con la respuesta de la apuesta, revisa si hay errores tipogr√°ficos

**Problema**: Sesiones de juego o apuestas duplicadas

- **Soluci√≥n**: Usa el mismo sessionId para reintentos, implementa idempotencia en tu lado

**Problema**: JWT expira durante el juego

- **Soluci√≥n**: Refresca el token antes de que comience el juego, maneja la expiraci√≥n del token de manera elegante

**Problema**: La l√≥gica del juego se ejecuta en el cliente, lo que lleva a trampas

- **Soluci√≥n**: Mueve TODA la l√≥gica del juego al backend, el cliente solo muestra resultados
