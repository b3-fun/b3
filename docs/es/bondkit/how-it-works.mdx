---
title: C√≥mo funciona BondKit
description: >-
  Crear ‚Üí Vincular ‚Üí Migrar: el flujo de principio a fin para lanzar tokens de
  bono ERC20 en Base.
lang: es
originalPath: bondkit/how-it-works.mdx
---
## Visi√≥n General de la Arquitectura

```mermaid
graph TB
    subgraph "Capa Frontend"
        UI["Aplicaci√≥n Web"]
        SDK["BondKit SDK"]
    end
    
    subgraph "Capa de Contrato Inteligente"
        Factory["Contrato de F√°brica"]
        Impl["Contrato de Implementaci√≥n"]
        Token1["Clon de Token 1"]
        Token2["Clon de Token 2"]
        TokenN["Clon de Token N"]
    end
    
    subgraph "Capa DEX"
        V4["Uniswap v4"]
        Pool1["Pool 1"]
        Pool2["Pool 2"]
    end
    
    subgraph "Servicios Backend"
        API["API de Anal√≠ticas"]
        DB["Base de Datos"]
        Indexer["Indexador de Eventos"]
    end
    
    UI --> SDK
    SDK --> Factory
    Factory -.->|despliega| Token1
    Factory -.->|despliega| Token2
    Factory -.->|despliega| TokenN
    Token1 -->|migra a| Pool1
    Token2 -->|migra a| Pool2
    Pool1 --> V4
    Pool2 --> V4
    
    Token1 --> Indexer
    Token2 --> Indexer
    Indexer --> DB
    DB --> API
    API --> UI
    
    Impl -.->|plantilla para| Token1
    Impl -.->|plantilla para| Token2
    
    style Factory fill:#e1f5fe
    style V4 fill:#c8e6c9
    style API fill:#fff9c4
```

## Flujo del Producto en Detalle

<Steps>
  <Step title="Fase 1: Creaci√≥n de Token">
    **Qu√© sucede:**
    - El usuario llama a `deployBondkitToken()` en el contrato de F√°brica
    - La F√°brica clona el contrato de Implementaci√≥n usando el patr√≥n de proxy m√≠nimo
    - El nuevo token se inicializa con par√°metros personalizados
    - El token entra autom√°ticamente en la fase de bonding
    
    **Costo de Gas:** ~200,000 gas (90% m√°s barato que el despliegue completo)
    **Tiempo:** ~15 segundos
  </Step>
  
  <Step title="Fase 2: Trading en la Curva de Bonding">
    **Qu√© sucede:**
    - Los usuarios compran/venden tokens directamente del contrato
    - El precio sigue una curva de bonding algor√≠tmica: `S = S_final √ó (R/R_objetivo)^exponente`
    - Comisi√≥n del 5% en todos los trades va al destinatario de la comisi√≥n
    - El contrato acumula activos de cotizaci√≥n (ETH/B3) hacia el objetivo
    - El backend indexa todas las transacciones para an√°lisis
    
    **Mec√°nica de Trading:**
    - Comprar: Enviar ETH/B3, recibir tokens al precio actual de la curva
    - Vender: Enviar tokens, recibir ETH/B3 menos comisiones
    - Reembolsos autom√°ticos si la compra excediera el objetivo
    
    **Duraci√≥n:** Hasta que se alcance el objetivo (horas a semanas)
  </Step>
  
  <Step title="Fase 3: Migraci√≥n a DEX">
    **Qu√© sucede:**
    - El administrador llama a `migrateToDex()` cuando se alcanza el objetivo
    - El contrato calcula el precio justo de mercado como `sqrtPriceX96`
    - Crea e inicializa el pool de Uniswap v4
    - Transfiere la liquidez acumulada al pool
    - Renuncia a la propiedad a la direcci√≥n cero
    - El token se convierte en un ERC20 est√°ndar con trading en DEX
    
    **Post-migraci√≥n:**
    - Curva de bonding permanentemente deshabilitada
    - Todo el trading a trav√©s de Uniswap v4
    - No quedan controles de administrador
    - Se logra la descentralizaci√≥n completa
    
    **Costo de Gas:** ~500,000 gas
    **Tiempo:** ~30 segundos
  </Step>
</Steps>

## Componentes del Sistema

### Contratos Inteligentes

<AccordionGroup>
  <Accordion title="üè≠ Contrato de F√°brica">
    **Prop√≥sito:** Despliega nuevos tokens de bono de manera eficiente
    
    **Funciones Clave:**
    - `deployBondkitToken()` - Crea un nuevo clon de token
    - `getImplementationAddress()` - Devuelve la direcci√≥n de la plantilla
    - `setAllowedQuoteAsset()` - Funci√≥n de administrador para listar activos
    
    **Optimizaci√≥n de Gas:**
    - Utiliza el patr√≥n de proxy m√≠nimo EIP-1167
    - Comparte l√≥gica a trav√©s de todos los tokens
    - ~90% de ahorro de gas vs despliegues individuales
  </Accordion>
  
  <Accordion title="üìú Contrato de Implementaci√≥n">
    **Prop√≥sito:** Plantilla para todos los tokens de bono
    
    **Caracter√≠sticas Principales:**
    - Cumplimiento del est√°ndar ERC20
    - Matem√°ticas de la curva de bonding
    - L√≥gica de migraci√≥n a Uniswap v4
    - Sistema de distribuci√≥n de comisiones
    
    **Transiciones de Estado:**
    1. No inicializado ‚Üí Fase de Bonding
    2. Fase de Bonding ‚Üí Listo para Migraci√≥n
    3. Listo para Migraci√≥n ‚Üí Fase DEX
  </Accordion>
  
  <Accordion title="ü™ô Clones de Token">
    **Prop√≥sito:** Instancias individuales de token
    
    **Ciclo de Vida:**
    - Creado v√≠a f√°brica
    - Inicializado con par√°metros √∫nicos
    - Gestiona su propia curva de bonding
    - Se auto-migra a Uniswap v4
    
    **Almacenamiento:**
    - Metadatos del token (nombre, s√≠mbolo)
    - Suministro y distribuci√≥n
    - Estado de la curva de bonding
    - Par√°metros de migraci√≥n
  </Accordion>
</AccordionGroup>

### Servicios Backend

<AccordionGroup>
  <Accordion title="üîç Indexador de Eventos">
    **Prop√≥sito:** Captura toda la actividad en cadena
    
    **Monitorea:**
    - Creaciones de token
    - Transacciones de compra/venta
    - Eventos de migraci√≥n
    - Actividades de transferencia
    
    **Tecnolog√≠a:**
    - Escaneo de blockchain en tiempo real
    - Procesamiento de logs de eventos
    - Sincronizaci√≥n con la base de datos
  </Accordion>
  
  <Accordion title="üìä Motor de Anal√≠ticas">
    **Prop√≥sito:** Procesa datos crudos en insights
    
    **Genera:**
    - Datos de velas OHLCV
    - M√©tricas de volumen
    - Seguimiento de liquidez
    - Historial de precios
    - Estad√≠sticas de usuarios
    
    **Actualizaciones:** Cada bloque (~2 segundos)
  </Accordion>
  
  <Accordion title="üåê API REST">
    **Prop√≥sito:** Sirve datos a los frontends
    
    **Endpoints:**
    - `/tokens` - Lista todos los tokens
    - `/tokens/{address}` - Detalles del token
    - `/tokens/{address}/transactions` - Historial de trades
    - `/tokens/{address}/ohlcv` - Datos para gr√°ficos
    - `/users/{address}/portfolio` - Tenencias del usuario
    
    **Formato:** JSON con paginaci√≥n
  </Accordion>
</AccordionGroup>

### Roles de Usuario

| Rol | Responsabilidades | Permisos |
|------|-----------------|-------------|
| **Creador** | Desplegar token, establecer par√°metros, iniciar migraci√≥n | Control total hasta la migraci√≥n |
| **Traders** | Comprar/vender durante el bonding, comerciar en DEX | Derechos de trading est√°ndar |
| **Destinatario de Comisiones** | Recibir comisiones de trading | Solo ingresos pasivos |
| **Admin de Migraci√≥n** | Ejecutar migraci√≥n cuando est√© listo | Derecho de migraci√≥n √∫nica |
| **Proveedores de LP** | (Post-migraci√≥n) Agregar liquidez a Uniswap | Derechos est√°ndar de LP |

## Inmersi√≥n T√©cnica

### Matem√°ticas de la Curva de Bonding

La curva de bonding determina el precio del token basado en la oferta:

```
F√≥rmula de Precio:
S = S_final √ó (R / R_objetivo)^exponente

Donde:
- S = Oferta actual de token
- S_final = Oferta final de token
- R = Monto recaudado (ETH/B3)
- R_objetivo = Monto objetivo
- exponente = 1 / (1 + factorDeAgresividad/100)
```

**C√°lculos de Ejemplo:**

| Agresividad | Exponente | Comportamiento del Precio |
|---------------|----------|----------------|
| 0 | 1.00 | Lineal (precio constante) |
| 25 | 0.80 | Curva suave |
| 50 | 0.67 | Curva moderada |
| 75 | 0.57 | Curva pronunciada |
| 100 | 0.50 | Muy pronunciada (ra√≠z cuadrada) |

### C√°lculo del Precio de Migraci√≥n

Al migrar a Uniswap v4, el contrato:

1. **Calcula el precio de salida** de la curva de bonding
2. **Convierte a formato sqrtPriceX96**:
   ```
   sqrtPriceX96 = sqrt(precio) √ó 2^96
   ```
3. **Inicializa el pool** con este precio
4. **Agrega liquidez** usando los fondos acumulados

### T√©cnicas de Optimizaci√≥n de Gas

<Info>
  **Patr√≥n de Proxy M√≠nimo (EIP-1167)**
  
  En lugar de desplegar el c√≥digo completo del contrato para cada token:
  - Desplegar un contrato de implementaci√≥n (600KB)
  - Desplegar contratos proxy diminutos (45 bytes cada uno)
  - Los proxies delegan todas las llamadas a la implementaci√≥n
  - Resultado: 90% de ahorro de gas por despliegue
</Info>

## Par√°metros de Configuraci√≥n

### Par√°metros de Creaci√≥n de Token

| Par√°metro | Tipo | Rango/Formato | Impacto |
|-----------|------|--------------|--------|
| `name` | string | 1-50 caracteres | Nombre de visualizaci√≥n del token |
| `symbol` | string | 2-10 caracteres | S√≠mbolo de trading |
| `finalTokenSupply` | uint256 | > 0 | Total de tokens acu√±ables |
| `aggressivenessFactor` | uint8 | 0-100 | Inclinaci√≥n de la curva |
| `targetEth` | uint256 | > 0 | Umbral de migraci√≥n |
| `feeRecipient` | address | Direcci√≥n v√°lida | Recibe comisiones |
| `lpSplitRatioFeeRecipientBps` | uint256 | 0-10000 | Participaci√≥n de comisi√≥n de LP (puntos b√°sicos) |
| `migrationAdminAddress` | address | Direcci√≥n v√°lida | Puede activar la migraci√≥n |

### Par√°metros de Ejecuci√≥n

| Acci√≥n | Par√°metros | Validaci√≥n |
|--------|------------|------------|
| Comprar | `minTokensOut`, `ethAmount` | Protecci√≥n contra deslizamiento |
| Vender | `tokenAmount`, `minEthOut` | Verificaci√≥n de saldo, deslizamiento |
| Migrar | Ninguno | Objetivo alcanzado, solo admin |

### Constantes del Sistema

| Constante | Valor | Descripci√≥n |
|----------|-------|-------------|
| Comisi√≥n de Trading | 5% | Aplicada a todos los trades |
| Decimales | 18 | Decimales est√°ndar ERC20 |
| M√≠nimo Objetivo | 0.1 ETH | Objetivo viable m√≠nimo |
| M√°xima Agresividad | 100 | Factor m√°ximo de la curva |

## Consideraciones de Seguridad

<Warning>
  **Caracter√≠sticas de Seguridad Importantes:**
  
  1. **Renuncia de Propiedad**: Autom√°tica despu√©s de la migraci√≥n
  2. **Sin Funci√≥n de Acu√±aci√≥n**: Suministro fijo en la creaci√≥n
  3. **Par√°metros Inmutables**: No se pueden cambiar despu√©s del despliegue
  4. **Contratos Auditados**: C√≥digo revisado profesionalmente
  5. **Sin Puertas Traseras de Admin**: Verdadera descentralizaci√≥n
  6. **Protecci√≥n contra Deslizamiento**: Incorporada en funciones de compra/venta
  7. **Protecci√≥n contra Desbordamiento**: Matem√°ticas seguras en todo
</Warning>

## Escenarios de Fallo y Manejo

| Escenario | Respuesta del Sistema |
|----------|----------------|
| Compra excede el objetivo | Relleno parcial, reembolso del exceso |
| Liquidez insuficiente para vender | Transacci√≥n revertida |
| Migraci√≥n antes del objetivo | Transacci√≥n revertida |
| Intento de migraci√≥n por no-admin | Transacci√≥n revertida |
| Intento de doble migraci√≥n | Transacci√≥n revertida |
| Operaciones con direcci√≥n cero | Transacci√≥n revertida |

## Pr√≥ximos Pasos

<CardGroup cols={2}>
  <Card title="Mec√°nica de Precios" icon="chart-line" href="/bondkit/concepts/pricing">
    Entender la matem√°tica de la curva de bonding
  </Card>
  <Card title="Gu√≠a de Migraci√≥n" icon="rocket" href="/bondkit/guides/migration">
    Aprender el proceso de migraci√≥n
  </Card>
</CardGroup>
