---
title: Hooks
description: React hooks ç”¨äºæ„å»ºè‡ªå®šä¹‰æ”¯ä»˜æµç¨‹å’Œç®¡ç†è®¢å•ç”Ÿå‘½å‘¨æœŸ
lang: cn
originalPath: anyspend/hooks.mdx
---
## æ ¸å¿ƒé’©å­

### `useAnyspendQuote`

è·å–ä»£å¸äº¤æ¢å’Œè·¨é“¾äº¤æ˜“çš„å®æ—¶å®šä»·ä¿¡æ¯ã€‚

```tsx title="åŸºæœ¬ç”¨æ³•" icon="quote-left"
import { useAnyspendQuote } from "@b3dotfun/sdk/anyspend";

const {
  anyspendQuote,
  isLoadingAnyspendQuote,
  getAnyspendQuoteError,
  refetchAnyspendQuote
} = useAnyspendQuote(quoteRequest);
```

#### å‚æ•°

<ParamField path="quoteRequest" type="QuoteRequest" required>
  æŠ¥ä»·é…ç½®å¯¹è±¡
</ParamField>

#### QuoteRequest æ¥å£

```typescript title="ç±»å‹å®šä¹‰" icon="code"
interface QuoteRequest {
  srcChain: number;              // æºé“¾ ID
  dstChain: number;              // ç›®æ ‡é“¾ ID
  srcTokenAddress: string;       // æºä»£å¸åˆçº¦åœ°å€
  dstTokenAddress: string;       // ç›®æ ‡ä»£å¸åˆçº¦åœ°å€
  type: "swap" | "custom";       // è®¢å•ç±»å‹
  tradeType: "EXACT_INPUT" | "EXACT_OUTPUT";
  amount: string;                // æœ€å°å•ä½é‡‘é¢ï¼ˆweiï¼‰
}
```

#### è¿”å›å€¼

<ResponseField name="anyspendQuote" type="QuoteResponse | null">
  æŠ¥ä»·æ•°æ®ï¼ŒåŒ…å«å®šä»·å’Œè´¹ç”¨
</ResponseField>

<ResponseField name="isLoadingAnyspendQuote" type="boolean">
  åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
</ResponseField>

<ResponseField name="getAnyspendQuoteError" type="Error | null">
  å¦‚æœæŠ¥ä»·å¤±è´¥ï¼Œåˆ™ä¸ºé”™è¯¯å¯¹è±¡
</ResponseField>

<ResponseField name="refetchAnyspendQuote" type="() => void">
  æ‰‹åŠ¨åˆ·æ–°æŠ¥ä»·çš„å‡½æ•°
</ResponseField>

#### ä½¿ç”¨ç¤ºä¾‹

```tsx title="äº¤æ¢æŠ¥ä»·ç»„ä»¶" icon="exchange-alt" lines
function SwapQuote() {
  const quoteRequest = {
    srcChain: 1,           // ä»¥å¤ªåŠ
    dstChain: 8333,        // B3
    srcTokenAddress: "0xA0b86a33E6Fb6Dd9a9B3d8B5FEb2b3C8e7D9Ff1E", // USDC
    dstTokenAddress: "0x0000000000000000000000000000000000000000", // ETH
    type: "swap",
    tradeType: "EXACT_INPUT",
    amount: "1000000", // 1 USDC (6ä½å°æ•°)
  };

  const { anyspendQuote, isLoadingAnyspendQuote, getAnyspendQuoteError } =
    useAnyspendQuote(quoteRequest);

  if (isLoadingAnyspendQuote) return <div>æ­£åœ¨è·å–æœ€ä½³ä»·æ ¼...</div>;
  if (getAnyspendQuoteError) return <div>è·å–æŠ¥ä»·å¤±è´¥</div>;

  return (
    <div>
      <p>æ‚¨å°†æ”¶åˆ°ï¼š{anyspendQuote?.expectedOutput} ETH</p>
      <p>ç½‘ç»œè´¹ç”¨ï¼š${anyspendQuote?.networkFeeUsd}</p>
      <p>æœåŠ¡è´¹ç”¨ï¼š${anyspendQuote?.serviceFeeUsd}</p>
      <p>æ€»æˆæœ¬ï¼š${anyspendQuote?.totalUsdCost}</p>
    </div>
  );
}
```

---

### `useAnyspendCreateOrder`

åˆ›å»ºå¹¶æ‰§è¡Œ AnySpend è®¢å•ï¼Œå…·æœ‰å…¨é¢çš„é”™è¯¯å¤„ç†ã€‚

```tsx title="åŸºæœ¬ç”¨æ³•" icon="plus-circle"
import { useAnyspendCreateOrder } from "@b3dotfun/sdk/anyspend";

const {
  createOrder,
  isCreatingOrder,
  createOrderError
} = useAnyspendCreateOrder(options);
```

#### å‚æ•°

<ParamField path="options" type="CreateOrderOptions">
  é…ç½®å¯¹è±¡ï¼ŒåŒ…å«å›è°ƒå‡½æ•°
</ParamField>

#### CreateOrderOptions æ¥å£

```typescript title="ç±»å‹å®šä¹‰" icon="settings"
interface CreateOrderOptions {
  onSuccess?: (data: OrderResponse) => void;
  onError?: (error: Error) => void;
  onSettled?: () => void;
}
```

#### è¿”å›å€¼

<ResponseField name="createOrder" type="(request: CreateOrderRequest) => void">
  åˆ›å»ºå¹¶æ‰§è¡Œè®¢å•çš„å‡½æ•°
</ResponseField>

<ResponseField name="isCreatingOrder" type="boolean">
  åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
</ResponseField>

<ResponseField name="createOrderError" type="Error | null">
  å¦‚æœè®¢å•åˆ›å»ºå¤±è´¥ï¼Œåˆ™ä¸ºé”™è¯¯å¯¹è±¡
</ResponseField>

#### ä½¿ç”¨ç¤ºä¾‹

```tsx title="æ”¯ä»˜è¡¨å•" icon="credit-card" lines
function PaymentForm() {
  const { createOrder, isCreatingOrder } = useAnyspendCreateOrder({
    onSuccess: (data) => {
      console.log("è®¢å•åˆ›å»ºæˆåŠŸï¼š", data.data.id);
      // é‡å®šå‘åˆ°æ”¯ä»˜æˆ–æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
      router.push(`/payment/${data.data.id}`);
    },
    onError: (error) => {
      console.error("è®¢å•å¤±è´¥ï¼š", error.message);
      toast.error("æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚");
    },
  });

  const handlePayment = () => {
    createOrder({
      recipientAddress: userWalletAddress,
      orderType: "swap",
      srcChain: 1,
      dstChain: 8333,
      srcToken: {
        chainId: 1,
        address: "0xA0b86a33E6Fb6Dd9a9B3d8B5FEb2b3C8e7D9Ff1E",
        name: "USD Coin",
        symbol: "USDC",
        decimals: 6,
      },
      dstToken: {
        chainId: 8333,
        address: "0x0000000000000000000000000000000000000000",
        name: "Ether",
        symbol: "ETH",
        decimals: 18,
      },
      srcAmount: "1000000", // 1 USDC
      expectedDstAmount: "500000000000000000", // çº¦ 0.5 ETH
      creatorAddress: userWalletAddress,
    });
  };

  return (
    <button
      onClick={handlePayment}
      disabled={isCreatingOrder}
    >
      {isCreatingOrder ? "å¤„ç†ä¸­..." : "ä½¿ç”¨åŠ å¯†è´§å¸æ”¯ä»˜"}
    </button>
  );
}
```

---

### `useAnyspendOrderAndTransactions`

å®æ—¶ç›‘æ§è®¢å•çŠ¶æ€å¹¶è·Ÿè¸ªå…³è”çš„åŒºå—é“¾äº¤æ˜“ã€‚

```tsx title="åŸºæœ¬ç”¨æ³•" icon="search"
import { useAnyspendOrderAndTransactions } from "@b3dotfun/sdk/anyspend";

const {
  orderAndTransactions,
  isLoadingOrderAndTransactions,
  getOrderAndTransactionsError
} = useAnyspendOrderAndTransactions(orderId);
```

#### å‚æ•°

<ParamField path="orderId" type="string" required>
  è¦è·Ÿè¸ªå’Œç›‘æ§çš„è®¢å• ID
</ParamField>

#### è¿”å›å€¼

<ResponseField name="orderAndTransactions" type="OrderWithTransactions | null">
  å®Œæ•´çš„è®¢å•æ•°æ®å’Œäº¤æ˜“è¯¦æƒ…
</ResponseField>

<ResponseField name="isLoadingOrderAndTransactions" type="boolean">
  åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨
</ResponseField>

<ResponseField name="getOrderAndTransactionsError" type="Error | null">
  å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™ä¸ºé”™è¯¯å¯¹è±¡
</ResponseField>

#### OrderWithTransactions æ¥å£

```typescript title="ç±»å‹å®šä¹‰" icon="database"
interface OrderWithTransactions {
  data: {
    order: Order;               // è®¢å•è¯¦æƒ…å’ŒçŠ¶æ€
    depositTxs: Transaction[];  // ç”¨æˆ·å­˜æ¬¾äº¤æ˜“
    relayTx?: Transaction;      // è·¨é“¾ä¸­ç»§äº¤æ˜“
    executeTx?: Transaction;    // æœ€ç»ˆæ‰§è¡Œäº¤æ˜“
    refundTxs: Transaction[];   // é€€æ¬¾äº¤æ˜“ï¼ˆå¦‚æœæœ‰ï¼‰
  };
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```tsx title="è®¢å•è·Ÿè¸ªå™¨" icon="eye" lines
function OrderTracker({ orderId }: { orderId: string }) {
  const { orderAndTransactions, isLoadingOrderAndTransactions } =
    useAnyspendOrderAndTransactions(orderId);

  if (isLoadingOrderAndTransactions) {
    return <div>æ­£åœ¨åŠ è½½è®¢å•çŠ¶æ€...</div>;
  }

  if (!orderAndTransactions) {
    return <div>è®¢å•æœªæ‰¾åˆ°</div>;
  }

  const { order, depositTxs, executeTx, refundTxs } = orderAndTransactions.data;

  const getStatusMessage = (status: string) => {
    switch (status) {
      case "scanning_deposit_transaction":
        return "â³ ç­‰å¾…æ”¯ä»˜ç¡®è®¤...";
      case "relay":
        return "ğŸ”„ å¤„ç†è·¨é“¾äº¤æ˜“...";
      case "executed":
        return "âœ… äº¤æ˜“æˆåŠŸå®Œæˆï¼";
      case "refunded":
        return "â†©ï¸ å·²å¤„ç†é€€æ¬¾";
      default:
        return "ğŸ”„ å¤„ç†ä¸­...";
    }
  };

  return (
    <div className="order-status">
      <h2>è®¢å• #{orderId.slice(0, 8)}</h2>
      <p>{getStatusMessage(order.status)}</p>

      {depositTxs.length > 0 && (
        <div>
          <h3>æ”¯ä»˜äº¤æ˜“</h3>
          <a
            href={`https://etherscan.io/tx/${depositTxs[0].txHash}`}
            target="_blank"
            rel="noopener noreferrer"
          >
            åœ¨ Etherscan ä¸ŠæŸ¥çœ‹
          </a>
        </div>
      )}

      {executeTx && (
        <div>
          <h3>æ‰§è¡Œäº¤æ˜“</h3>
          <a
            href={`https://explorer.b3.fun/tx/${executeTx.txHash}`}
            target="_blank"
            rel="noopener noreferrer"
          >
            åœ¨ B3 æµè§ˆå™¨ä¸ŠæŸ¥çœ‹
          </a>
        </div>
      )}

      {order.errorDetails && (
        <div className="error">
          <strong>é”™è¯¯ï¼š</strong> {order.errorDetails}
        </div>
      )}
    </div>
  );
}
```

---

### `useAnyspendOrderHistory`

æ£€ç´¢ç”¨æˆ·åœ°å€çš„åˆ†é¡µè®¢å•å†å²è®°å½•ã€‚

```tsx title="åŸºæœ¬ç”¨æ³•" icon="history"
import { useAnyspendOrderHistory } from "@b3dotfun/sdk/anyspend";

const {
  orderHistory,
  isLoadingOrderHistory,
  getOrderHistoryError
} = useAnyspendOrderHistory(creatorAddress, limit, offset);
```

#### å‚æ•°

<ParamField path="creatorAddress" type="string" required>
  ç”¨æˆ·é’±åŒ…åœ°å€
</ParamField>

<ParamField path="limit" type="number" required>
  è¦è·å–çš„è®¢å•æ•°é‡ï¼ˆæœ€å¤§ 100ï¼‰
</ParamField>

<ParamField path="offset" type="number" required>
  åˆ†é¡µåç§»é‡
</ParamField>

#### ä½¿ç”¨ç¤ºä¾‹

```tsx title="è®¢å•å†å²ç»„ä»¶" icon="list" lines
function OrderHistory({ userAddress }: { userAddress: string }) {
  const [page, setPage] = useState(0);
  const pageSize = 10;

  const { orderHistory, isLoadingOrderHistory } = useAnyspendOrderHistory(
    userAddress,
    pageSize,
    page * pageSize
  );

  if (isLoadingOrderHistory) {
    return <div>æ­£åœ¨åŠ è½½è®¢å•å†å²...</div>;
  }

  return (
    <div>
      <h2>æ‚¨çš„è®¢å•</h2>
      {orderHistory?.data.map((order) => (
        <div key={order.id} className="order-item">
          <p>ç±»å‹ï¼š{order.type}</p>
          <p>çŠ¶æ€ï¼š{order.status}</p>
          <p>é‡‘é¢ï¼š{order.srcAmount} {order.srcToken.symbol}</p>
          <p>æ—¥æœŸï¼š{new Date(order.createdAt).toLocaleDateString()}</p>
        </div>
      ))}

      <button
        onClick={() => setPage(page - 1)}
        disabled={page === 0}
      >
        ä¸Šä¸€é¡µ
      </button>
      <button
        onClick={() => setPage(page + 1)}
        disabled={!orderHistory?.data || orderHistory.data.length < pageSize}
      >
        ä¸‹ä¸€é¡µ
      </button>
    </div>
  );
}
```

## é¢å¤–çš„é’©å­

### `useAnyspendTokens`

è·å–ç‰¹å®šé“¾ä¸Šå¯ç”¨çš„ä»£å¸ã€‚

```tsx title="ä»£å¸åˆ—è¡¨" icon="coins"
const { tokens, isLoadingTokens } = useAnyspendTokens(1, "USDC");
```

### `useCoinbaseOnrampOptions`

è·å– Coinbase ä¸Šè¡Œé…ç½®ä»¥è¿›è¡Œæ³•å¸æ”¯ä»˜ã€‚

```tsx title="Coinbase ä¸Šè¡Œ" icon="credit-card"
const { coinbaseOptions, isLoadingCoinbaseOptions } = useCoinbaseOnrampOptions();
```

### `useStripeClientSecret`

è·å– Stripe æ”¯ä»˜æ„å›¾ä»¥è¿›è¡Œä¿¡ç”¨å¡æ”¯ä»˜ã€‚

```tsx title="Stripe é›†æˆ" icon="stripe"
const { clientSecret, isLoadingClientSecret } = useStripeClientSecret(orderData);
```

## é’©å­æ¨¡å¼

### é”™è¯¯å¤„ç†æ¨¡å¼

```tsx title="é”™è¯¯å¤„ç†" icon="shield-exclamation" lines
function PaymentComponent() {
  const { createOrder, isCreatingOrder } = useAnyspendCreateOrder({
    onError: (error) => {
      // è®°å½•é”™è¯¯ä»¥ä¾¿è°ƒè¯•
      console.error("æ”¯ä»˜å¤±è´¥ï¼š", error);

      // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æ¶ˆæ¯
      switch (error.message) {
        case "INSUFFICIENT_BALANCE":
          toast.error("ä½™é¢ä¸è¶³ï¼Œè¯·æ·»åŠ èµ„é‡‘ã€‚");
          break;
        case "SLIPPAGE":
          toast.error("ä»·æ ¼ä¸åˆ©åœ°ç§»åŠ¨ï¼Œè¯·é‡è¯•ã€‚");
          break;
        default:
          toast.error("æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚");
      }
    },
  });

  // ç»„ä»¶å®ç°...
}
```

### åŠ è½½çŠ¶æ€æ¨¡å¼

```tsx title="åŠ è½½çŠ¶æ€" icon="spinner" lines
function SwapInterface() {
  const { anyspendQuote, isLoadingAnyspendQuote } = useAnyspendQuote(quoteRequest);
  const { createOrder, isCreatingOrder } = useAnyspendCreateOrder();

  const isLoading = isLoadingAnyspendQuote || isCreatingOrder;

  return (
    <div>
      {isLoading && <LoadingSpinner />}
      {/* ç»„ä»¶çš„å…¶ä½™éƒ¨åˆ† */}
    </div>
  );
}
```

### å®æ—¶æ›´æ–°æ¨¡å¼

```tsx title="å®æ—¶æ›´æ–°" icon="sync-alt" lines
function OrderStatus({ orderId }: { orderId: string }) {
  const { orderAndTransactions } = useAnyspendOrderAndTransactions(orderId);

  // æ¯ 5 ç§’è‡ªåŠ¨åˆ·æ–°å¾…å¤„ç†çš„è®¢å•
  useEffect(() => {
    if (orderAndTransactions?.data.order.status === "relay") {
      const interval = setInterval(() => {
        // é’©å­ä¼šè‡ªåŠ¨å¤„ç†é‡æ–°è·å–
      }, 5000);

      return () => clearInterval(interval);
    }
  }, [orderAndTransactions?.data.order.status]);

  // ç»„ä»¶å®ç°...
}
```

## ä¸‹ä¸€æ­¥

<CardGroup cols={3}>
<Card title="æŸ¥çœ‹ç¤ºä¾‹" icon="code" href="/anyspend/examples">
  æµè§ˆçœŸå®ä¸–ç•Œçš„å®ç°ç¤ºä¾‹
</Card>

<Card title="é”™è¯¯å¤„ç†" icon="bug" href="/anyspend/error-handling">
  å­¦ä¹ å…¨é¢çš„é”™è¯¯å¤„ç†ç­–ç•¥
</Card>

<Card title="ç»„ä»¶å‚è€ƒ" icon="puzzle-piece" href="/anyspend/components">
  æ¢ç´¢é¢„æ„å»ºç»„ä»¶
</Card>
</CardGroup>
