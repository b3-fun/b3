---
title: é”™è¯¯å¤„ç†ä¸æ•…éšœæ’é™¤
description: å…¨é¢æŒ‡å—ï¼šä¼˜é›…åœ°å¤„ç†é”™è¯¯å¹¶è°ƒè¯• AnySpend å¸¸è§é—®é¢˜
lang: cn
originalPath: anyspend/error-handling.mdx
---
# é”™è¯¯å¤„ç†ä¸æ•…éšœæ’é™¤

å…¨é¢æŒ‡å—ï¼Œä¼˜é›…åœ°å¤„ç†é”™è¯¯å¹¶è°ƒè¯• AnySpend å¸¸è§é—®é¢˜ï¼Œä»¥æä¾›æœ€ä½³ç”¨æˆ·ä½“éªŒã€‚

## ğŸ“Š è®¢å•çŠ¶æ€ç”Ÿå‘½å‘¨æœŸ

äº†è§£è®¢å•çŠ¶æ€å¯¹äºæ­£ç¡®çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚

### è®¢å•çŠ¶æ€ç±»å‹

```typescript title="è®¢å•çŠ¶æ€æšä¸¾" icon="list"
enum OrderStatus {
  // åˆå§‹çŠ¶æ€
  SCANNING_DEPOSIT_TRANSACTION = "scanning_deposit_transaction",
  WAITING_STRIPE_PAYMENT = "waiting_stripe_payment",
  EXPIRED = "expired",

  // å¤„ç†çŠ¶æ€
  SENDING_TOKEN_FROM_VAULT = "sending_token_from_vault",
  RELAY = "relay",

  // æˆåŠŸçŠ¶æ€
  EXECUTED = "executed",

  // å¤±è´¥çŠ¶æ€
  REFUNDING = "refunding",
  REFUNDED = "refunded",
  FAILURE = "failure",
}
```

### çŠ¶æ€æè¿°

<table>
  <thead>
    <tr>
      <th>çŠ¶æ€</th>
      <th>æè¿°</th>
      <th>ç”¨æˆ·æ“ä½œè¦æ±‚</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`scanning_deposit_transaction`</td>
      <td>ç­‰å¾…æ”¯ä»˜ç¡®è®¤</td>
      <td>æ—  - ç­‰å¾…åŒºå—é“¾ç¡®è®¤</td>
    </tr>
    <tr>
      <td>`waiting_stripe_payment`</td>
      <td>æ­£åœ¨å¤„ç†ä¿¡ç”¨å¡æ”¯ä»˜</td>
      <td>å¯èƒ½éœ€è¦å®Œæˆ 3D å®‰å…¨éªŒè¯</td>
    </tr>
    <tr>
      <td>`sending_token_from_vault`</td>
      <td>å‘é€ä»£å¸è¿›è¡Œäº¤æ¢</td>
      <td>æ—  - è‡ªåŠ¨è¿‡ç¨‹</td>
    </tr>
    <tr>
      <td>`relay`</td>
      <td>è·¨é“¾äº¤æ˜“è¿›è¡Œä¸­</td>
      <td>æ—  - ç­‰å¾…å®Œæˆ</td>
    </tr>
    <tr>
      <td>`executed`</td>
      <td>äº¤æ˜“æˆåŠŸå®Œæˆ</td>
      <td>æ—  - æˆåŠŸï¼</td>
    </tr>
    <tr>
      <td>`expired`</td>
      <td>è®¢å•åœ¨å®Œæˆå‰è¿‡æœŸ</td>
      <td>åˆ›å»ºæ–°è®¢å•</td>
    </tr>
    <tr>
      <td>`refunding`</td>
      <td>è‡ªåŠ¨é€€æ¬¾è¿›è¡Œä¸­</td>
      <td>æ—  - ç­‰å¾…é€€æ¬¾</td>
    </tr>
    <tr>
      <td>`refunded`</td>
      <td>é€€æ¬¾å®Œæˆ</td>
      <td>æ£€æŸ¥é’±åŒ…ä¸­çš„é€€æ¬¾ä»£å¸</td>
    </tr>
    <tr>
      <td>`failure`</td>
      <td>äº¤æ˜“å¤±è´¥</td>
      <td>æŸ¥çœ‹é”™è¯¯è¯¦æƒ…ï¼Œé‡è¯•</td>
    </tr>
  </tbody>
</table>

## âš ï¸ å¸¸è§é”™è¯¯ä»£ç 

### æ”¯ä»˜é”™è¯¯

<AccordionGroup>
<Accordion title="INSUFFICIENT_BALANCE">
**æè¿°**ï¼šç”¨æˆ·çš„ä»£å¸ä¸è¶³ä»¥è¿›è¡Œäº¤æ˜“

**è§£å†³æ–¹æ¡ˆ**ï¼šè¯·æ±‚ç”¨æˆ·å‘å…¶é’±åŒ…æ·»åŠ èµ„é‡‘æˆ–é€‰æ‹©ä¸åŒçš„æ”¯ä»˜ä»£å¸

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "INSUFFICIENT_BALANCE") {
  toast.error("ä½™é¢ä¸è¶³ã€‚è¯·å‘æ‚¨çš„é’±åŒ…æ·»åŠ èµ„é‡‘ã€‚");
  // å¯é€‰é‡å®šå‘åˆ°æ³•å¸é€šé“
  openFiatOnramp();
}
```

</Accordion>

<Accordion title="INVALID_TOKEN_ADDRESS">
**æè¿°**ï¼šç›®æ ‡é“¾ä¸Šä¸æ”¯æŒä»£å¸åˆçº¦

**è§£å†³æ–¹æ¡ˆ**ï¼šéªŒè¯ä»£å¸æ˜¯å¦å—æ”¯æŒå¹¶æä¾›æ›¿ä»£é€‰é¡¹

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "INVALID_TOKEN_ADDRESS") {
  toast.error("æ­¤ä»£å¸ä¸å—æ”¯æŒã€‚è¯·é€‰æ‹©å…¶ä»–ä»£å¸ã€‚");
  showSupportedTokens();
}
```

</Accordion>

<Accordion title="MINIMUM_AMOUNT_NOT_MET">
**æè¿°**ï¼šäº¤æ˜“é‡‘é¢ä½äºæœ€ä½é˜ˆå€¼

**è§£å†³æ–¹æ¡ˆ**ï¼šå¢åŠ äº¤æ˜“é‡‘é¢æˆ–å‘ŠçŸ¥ç”¨æˆ·æœ€ä½è¦æ±‚

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "MINIMUM_AMOUNT_NOT_MET") {
  toast.error(`æœ€ä½é‡‘é¢ä¸º $${minimumAmount}ã€‚è¯·å¢åŠ æ‚¨çš„é‡‘é¢ã€‚`);
}
```

</Accordion>

<Accordion title="MAXIMUM_AMOUNT_EXCEEDED">
**æè¿°**ï¼šäº¤æ˜“é‡‘é¢è¶…è¿‡æœ€å¤§é™åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼šå‡å°‘é‡‘é¢æˆ–åˆ†æˆå¤šç¬”äº¤æ˜“

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "MAXIMUM_AMOUNT_EXCEEDED") {
  toast.error(`æœ€å¤§é‡‘é¢ä¸º $${maximumAmount}ã€‚è¯·å‡å°‘æ‚¨çš„é‡‘é¢ã€‚`);
}
```

</Accordion>
</AccordionGroup>

### ç½‘ç»œé”™è¯¯

<AccordionGroup>
<Accordion title="SLIPPAGE">
**æè¿°**ï¼šæ‰§è¡ŒæœŸé—´ä»·æ ¼ç§»åŠ¨è¶…å‡ºå¯æ¥å—çš„å®¹å¿åº¦

**è§£å†³æ–¹æ¡ˆ**ï¼šæé«˜æ»‘ç‚¹å®¹å¿åº¦é‡è¯•æˆ–ç­‰å¾…ä»·æ ¼ç¨³å®š

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "SLIPPAGE") {
  toast.warning("ä»·æ ¼ä¸åˆ©åœ°ç§»åŠ¨ã€‚æ­£åœ¨è°ƒæ•´è®¾ç½®é‡è¯•...");
  retryWithHigherSlippage();
}
```

</Accordion>

<Accordion title="NETWORK_ERROR">
**æè¿°**ï¼šRPC è¿æ¥é—®é¢˜æˆ–åŒºå—é“¾æ‹¥å µ

**è§£å†³æ–¹æ¡ˆ**ï¼šå»¶è¿Ÿåé‡è¯•æˆ–åˆ‡æ¢åˆ°å¤‡ç”¨ RPC

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "NETWORK_ERROR") {
  toast.error("æ£€æµ‹åˆ°ç½‘ç»œé—®é¢˜ã€‚è¯·æ£€æŸ¥è¿æ¥å¹¶é‡è¯•ã€‚");
  scheduleRetry();
}
```

</Accordion>

<Accordion title="QUOTE_EXPIRED">
**æè¿°**ï¼šä»·æ ¼æŠ¥ä»·ä¸å†æœ‰æ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼šè·å–æ–°çš„æŠ¥ä»·å¹¶é‡è¯•äº¤æ˜“

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "QUOTE_EXPIRED") {
  toast.info("ä»·æ ¼æŠ¥ä»·å·²è¿‡æœŸã€‚è·å–æ–°çš„æŠ¥ä»·...");
  refreshQuoteAndRetry();
}
```

</Accordion>

<Accordion title="CHAIN_NOT_SUPPORTED">
**æè¿°**ï¼šè¯·æ±‚çš„åŒºå—é“¾ä¸å—æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å—æ”¯æŒçš„é“¾æˆ–å®æ–½å¤‡ç”¨æ–¹æ¡ˆ

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "CHAIN_NOT_SUPPORTED") {
  toast.error("æ­¤åŒºå—é“¾ä¸å—æ”¯æŒã€‚è¯·é€‰æ‹©å…¶ä»–åŒºå—é“¾ã€‚");
  showSupportedChains();
}
```

</Accordion>
</AccordionGroup>

### åˆçº¦é”™è¯¯

<AccordionGroup>
<Accordion title="CONTRACT_CALL_FAILED">
**æè¿°**ï¼šæ™ºèƒ½åˆçº¦æ‰§è¡Œå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥åˆçº¦å‚æ•°å’ŒçŠ¶æ€

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "CONTRACT_CALL_FAILED") {
  toast.error("åˆçº¦äº¤äº’å¤±è´¥ã€‚è¯·éªŒè¯å‚æ•°ã€‚");
  logContractError(error);
}
```

</Accordion>

<Accordion title="INSUFFICIENT_GAS">
**æè¿°**ï¼šä¸ºäº¤æ˜“è®¾ç½®çš„ Gas é™åˆ¶è¿‡ä½

**è§£å†³æ–¹æ¡ˆ**ï¼šå¢åŠ  Gas é™åˆ¶æˆ–å»ºè®® Gas ä¼˜åŒ–

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "INSUFFICIENT_GAS") {
  toast.error("äº¤æ˜“éœ€è¦æ›´å¤š Gasã€‚æ­£åœ¨å¢åŠ  Gas é™åˆ¶...");
  retryWithHigherGas();
}
```

</Accordion>

<Accordion title="NONCE_TOO_LOW">
**æè¿°**ï¼šäº¤æ˜“ nonce å†²çª

**è§£å†³æ–¹æ¡ˆ**ï¼šç­‰å¾…æŒ‚èµ·çš„äº¤æ˜“å®Œæˆ

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "NONCE_TOO_LOW") {
  toast.info("è¯·ç­‰å¾…æŒ‚èµ·çš„äº¤æ˜“å®Œæˆã€‚");
  waitAndRetry();
}
```

</Accordion>

<Accordion title="TRANSACTION_REVERTED">
**æè¿°**ï¼šåˆçº¦æ’¤é”€äº†äº¤æ˜“

**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥åˆçº¦çŠ¶æ€å’Œå‚æ•°

**ç¤ºä¾‹**ï¼š

```typescript
if (error.message === "TRANSACTION_REVERTED") {
  toast.error("äº¤æ˜“è¢«åˆçº¦æ‹’ç»ã€‚è¯·æ£€æŸ¥è¦æ±‚ã€‚");
  showTransactionDetails();
}
```

</Accordion>
</AccordionGroup>

## ğŸ› ï¸ é”™è¯¯å¤„ç†æ¨¡å¼

### ç»„ä»¶çº§é”™è¯¯å¤„ç†

```tsx title="å¸¦æœ‰é”™è¯¯å¤„ç†çš„æ”¯ä»˜ç»„ä»¶" icon="shield-exclamation" lines
import { useAnyspendCreateOrder } from "@b3dotfun/sdk/anyspend";

function PaymentComponent() {
  const [error, setError] = useState<string | null>(null);
  const [retryCount, setRetryCount] = useState(0);

  const { createOrder, isCreatingOrder } = useAnyspendCreateOrder({
    onError: error => {
      console.error("æ”¯ä»˜å¤±è´¥ï¼š", error);

      // å¤„ç†ç‰¹å®šé”™è¯¯
      switch (error.message) {
        case "INSUFFICIENT_BALANCE":
          setError("ä½™é¢ä¸è¶³ã€‚è¯·å‘æ‚¨çš„é’±åŒ…æ·»åŠ èµ„é‡‘ã€‚");
          break;

        case "SLIPPAGE":
          if (retryCount < 3) {
            setError("ä»·æ ¼ä¸åˆ©åœ°ç§»åŠ¨ã€‚æ­£åœ¨é‡è¯•...");
            setTimeout(() => {
              setRetryCount(prev => prev + 1);
              retryPayment();
            }, 2000);
          } else {
            setError("ä»·æ ¼è¿‡äºæ³¢åŠ¨ã€‚è¯·ç¨åå†è¯•ã€‚");
          }
          break;

        case "NETWORK_ERROR":
          setError("ç½‘ç»œé—®é¢˜ã€‚è¯·æ£€æŸ¥æ‚¨çš„è¿æ¥å¹¶é‡è¯•ã€‚");
          break;

        case "QUOTE_EXPIRED":
          setError("ä»·æ ¼æŠ¥ä»·å·²è¿‡æœŸã€‚è·å–æ–°çš„æŠ¥ä»·...");
          refreshQuote();
          break;

        default:
          setError("æ”¯ä»˜å¤±è´¥ã€‚è¯·é‡è¯•æˆ–è”ç³»æ”¯æŒã€‚");
      }

      // è·Ÿè¸ªé”™è¯¯ä»¥ä¾¿ç›‘æ§
      analytics.track("payment_error", {
        error: error.message,
        retryCount,
        timestamp: new Date().toISOString(),
      });
    },

    onSuccess: () => {
      setError(null);
      setRetryCount(0);
    },
  });

  return (
    <div className="payment-component">
      {error && (
        <div className="error-banner">
          <span className="error-icon">âš ï¸</span>
          <span>{error}</span>
          <button onClick={() => setError(null)}>å…³é—­</button>
        </div>
      )}

      <button onClick={handlePayment} disabled={isCreatingOrder}>
        {isCreatingOrder ? "å¤„ç†ä¸­..." : "ç«‹å³æ”¯ä»˜"}
      </button>
    </div>
  );
}
```

### è®¢å•çŠ¶æ€ç›‘æ§

```tsx title="è®¢å•çŠ¶æ€ç›‘æ§" icon="eye" lines
import { useAnyspendOrderAndTransactions } from "@b3dotfun/sdk/anyspend";

function OrderStatusMonitor({ orderId }: { orderId: string }) {
  const { orderAndTransactions, getOrderAndTransactionsError } = useAnyspendOrderAndTransactions(orderId);

  if (getOrderAndTransactionsError) {
    return (
      <div className="error-state">
        <h3>æ— æ³•åŠ è½½è®¢å•çŠ¶æ€</h3>
        <p>è¯·æ£€æŸ¥æ‚¨çš„è¿æ¥å¹¶é‡è¯•ã€‚</p>
        <button onClick={() => window.location.reload()}>é‡è¯•</button>
      </div>
    );
  }

  if (!orderAndTransactions) {
    return <div>åŠ è½½è®¢å•çŠ¶æ€ä¸­...</div>;
  }

  const { order, depositTxs, executeTx, refundTxs } = orderAndTransactions.data;

  const renderStatusMessage = () => {
    switch (order.status) {
      case "scanning_deposit_transaction":
        return (
          <div className="status-pending">
            <div className="spinner" />
            <div>
              <h3>â³ ç­‰å¾…æ”¯ä»˜ç¡®è®¤</h3>
              <p>è¿™é€šå¸¸éœ€è¦ 1-2 åˆ†é’Ÿã€‚è¯·ä¸è¦å…³é—­æ­¤çª—å£ã€‚</p>
              {depositTxs.length > 0 && (
                <a
                  href={getExplorerUrl(depositTxs[0].txHash, depositTxs[0].chainId)}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  æŸ¥çœ‹æ”¯ä»˜äº¤æ˜“
                </a>
              )}
            </div>
          </div>
        );

      case "relay":
        return (
          <div className="status-processing">
            <div className="spinner" />
            <div>
              <h3>ğŸ”„ å¤„ç†è·¨é“¾äº¤æ˜“</h3>
              <p>æ‚¨çš„æ”¯ä»˜æ­£åœ¨å¤„ç†ä¸­ã€‚è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚</p>
            </div>
          </div>
        );

      case "executed":
        return (
          <div className="status-success">
            <div className="success-icon">âœ…</div>
            <div>
              <h3>äº¤æ˜“æˆåŠŸå®Œæˆï¼</h3>
              <p>æ‚¨çš„è®¢å•å·²å¤„ç†ã€‚</p>
              {executeTx && (
                <a href={getExplorerUrl(executeTx.txHash, executeTx.chainId)} target="_blank" rel="noopener noreferrer">
                  æŸ¥çœ‹äº¤æ˜“
                </a>
              )}
            </div>
          </div>
        );

      case "failure":
      case "obtain_failed":
        return (
          <div className="status-error">
            <div className="error-icon">âŒ</div>
            <div>
              <h3>äº¤æ˜“å¤±è´¥</h3>
              <p>{order.errorDetails || "å¤„ç†æ‚¨çš„è®¢å•æ—¶å‘ç”Ÿé”™è¯¯ã€‚"}</p>
              <div className="error-actions">
                <button onClick={() => createNewOrder()}>é‡è¯•</button>
                <button onClick={() => contactSupport(orderId)}>è”ç³»æ”¯æŒ</button>
              </div>
            </div>
          </div>
        );

      case "refunded":
        return (
          <div className="status-refunded">
            <div className="refund-icon">â†©ï¸</div>
            <div>
              <h3>é€€æ¬¾å·²å¤„ç†</h3>
              <p>æ‚¨çš„æ”¯ä»˜å·²è‡ªåŠ¨é€€æ¬¾ã€‚</p>
              {refundTxs.length > 0 && (
                <a
                  href={getExplorerUrl(refundTxs[0].txHash, refundTxs[0].chainId)}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  æŸ¥çœ‹é€€æ¬¾äº¤æ˜“
                </a>
              )}
            </div>
          </div>
        );

      case "expired":
        return (
          <div className="status-expired">
            <div className="expired-icon">â°</div>
            <div>
              <h3>è®¢å•å·²è¿‡æœŸ</h3>
              <p>æ­¤è®¢å•åœ¨æ”¶åˆ°æ”¯ä»˜å‰å·²è¿‡æœŸã€‚</p>
              <button onClick={() => createNewOrder()}>åˆ›å»ºæ–°è®¢å•</button>
            </div>
          </div>
        );

      default:
        return (
          <div className="status-unknown">
            <div className="spinner" />
            <div>
              <h3>å¤„ç†ä¸­...</h3>
              <p>è®¢å•çŠ¶æ€ï¼š{order.status}</p>
            </div>
          </div>
        );
    }
  };

  return (
    <div className="order-status-monitor">
      <div className="order-header">
        <h2>è®¢å• #{orderId.slice(0, 8)}</h2>
        <div className="order-meta">
          <span>åˆ›å»ºæ—¶é—´ï¼š{new Date(order.createdAt).toLocaleString()}</span>
          <span>çŠ¶æ€ï¼š{order.status}</span>
        </div>
      </div>

      {renderStatusMessage()}

      {/* å¼€å‘ç¯å¢ƒä¸­çš„è°ƒè¯•ä¿¡æ¯ */}
      {process.env.NODE_ENV === "development" && (
        <details className="debug-info">
          <summary>è°ƒè¯•ä¿¡æ¯</summary>
          <pre>{JSON.stringify(order, null, 2)}</pre>
        </details>
      )}
    </div>
  );
}
```

### å…¨å±€é”™è¯¯è¾¹ç•Œ

```tsx title="é”™è¯¯è¾¹ç•Œç»„ä»¶" icon="shield" lines
import React, { Component, ErrorInfo } from "react";

interface Props {
  children: React.ReactNode;
  fallback?: React.ComponentType<{ error: Error; resetError: () => void }>;
}

interface State {
  hasError: boolean;
  error?: Error;
}

class AnySpendErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error("AnySpend é”™è¯¯è¾¹ç•Œæ•è·åˆ°é”™è¯¯ï¼š", error, errorInfo);

    // æŠ¥å‘Šåˆ°é”™è¯¯è·Ÿè¸ªæœåŠ¡
    if (typeof window !== "undefined") {
      // ç¤ºä¾‹ï¼šSentry.captureException(error, { contexts: { errorInfo } });
    }
  }

  resetError = () => {
    this.setState({ hasError: false, error: undefined });
  };

  render() {
    if (this.state.hasError) {
      const FallbackComponent = this.props.fallback || DefaultErrorFallback;
      return <FallbackComponent error={this.state.error!} resetError={this.resetError} />;
    }

    return this.props.children;
  }
}

function DefaultErrorFallback({ error, resetError }: { error: Error; resetError: () => void }) {
  return (
    <div className="error-fallback">
      <h2>å‡ºäº†ç‚¹é—®é¢˜</h2>
      <p>æ”¯ä»˜ç»„ä»¶ä¸­å‘ç”Ÿäº†æ„å¤–é”™è¯¯ã€‚</p>
      <details className="error-details">
        <summary>é”™è¯¯è¯¦æƒ…</summary>
        <pre>{error.message}</pre>
      </details>
      <div className="error-actions">
        <button onClick={resetError}>é‡è¯•</button>
        <button onClick={() => window.location.reload()}>é‡æ–°åŠ è½½é¡µé¢</button>
      </div>
    </div>
  );
}

// ä½¿ç”¨æ–¹å¼
function App() {
  return (
    <AnySpendErrorBoundary>
      <AnySpendProvider>
        <YourApp />
      </AnySpendProvider>
    </AnySpendErrorBoundary>
  );
