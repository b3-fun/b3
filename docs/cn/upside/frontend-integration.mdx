---
title: å‰ç«¯é›†æˆ
description: åœ¨æ‚¨çš„æ¸¸æˆå‰ç«¯è®¾ç½® ParentProvider å¹¶ä½¿ç”¨ hooks æ¥è®¿é—®ç©å®¶è®¤è¯ã€ä½™é¢å’Œ UI æ§åˆ¶ã€‚
lang: cn
originalPath: upside/frontend-integration.mdx
---
## ParentProvider

`ParentProvider` ç»„ä»¶å°†æ‚¨çš„æ¸¸æˆå‰ç«¯è¿æ¥åˆ° Upside å¹³å°ï¼Œå¹¶æä¾›è®¤è¯ã€‚

```javascript
import { ParentProvider, useParent, useBalance, useToken, useAuthenticatedFetch } from "@b3dotfun/upside-sdk";

export default function CoinFlipGame() {
  return (
    <ParentProvider>
      <GameContent />
    </ParentProvider>
  );
}

function GameContent() {
  const { token, balance, showWinModal, showLossModal, refetchBalance } = useParent();

  // æˆ–ä½¿ç”¨å•ç‹¬çš„ hooks:
  const balance = useBalance(); // number | null
  const token = useToken(); // string | null
  const authFetch = useAuthenticatedFetch(); // å¸¦æœ‰ Authorization å¤´çš„ fetch

  return (
    <div>
      <h1>Coin Flip</h1>
      <p>ä½™é¢: {(balance / 1e18).toFixed(2)} WIN</p>
      <button onClick={() => playGame(token)}>ç©æ¸¸æˆ</button>
    </div>
  );
}
```

## å¯ç”¨çš„ Hooks

### useParent()

è®¿é—®å®Œæ•´ä¸Šä¸‹æ–‡ï¼ˆtoken, balance, showWinModal, showLossModal ç­‰ï¼‰

**è¿”å›å€¼:**

- `token` (string | null): ç”¨äºåç«¯è°ƒç”¨çš„ JWT è®¤è¯ä»¤ç‰Œ
- `balance` (number | null): å½“å‰ WIN ä»£å¸ä½™é¢ï¼ˆä»¥ wei ä¸ºå•ä½ï¼‰
- `showWinModal(wins: string)`: æ˜¾ç¤ºèµ¢å¾—æ¨¡æ€æ¡†
- `showLossModal(loss: string)`: æ˜¾ç¤ºè¾“æ‰æ¨¡æ€æ¡†
- `showToast(options)`: æ˜¾ç¤ºåå¸é€šçŸ¥
- `showCustomModal(content)`: æ˜¾ç¤ºè‡ªå®šä¹‰æ¨¡æ€æ¡†
- `refetchBalance()`: ä»å¹³å°è¯·æ±‚ä½™é¢åˆ·æ–°

### useBalance()

è·å–ç©å®¶ä½™é¢ï¼ˆnumber | nullï¼‰

```javascript
const balance = useBalance();
```

### useToken()

è·å–è®¤è¯ä»¤ç‰Œï¼ˆstring | nullï¼‰

```javascript
const token = useToken();
```

### useRefetchBalance()

è¯·æ±‚ä½™é¢åˆ·æ–°çš„å‡½æ•°

```javascript
const refetchBalance = useRefetchBalance();
```

### useCustomModal()

æ˜¾ç¤ºè‡ªå®šä¹‰æ¨¡æ€æ¡†çš„å‡½æ•°

```javascript
const showCustomModal = useCustomModal();
```

### useAuthenticatedFetch()

å¸¦æœ‰è‡ªåŠ¨ Bearer ä»¤ç‰Œå¤´çš„ Fetch å‡½æ•°

```javascript
const authFetch = useAuthenticatedFetch();
```

## å‘èµ· API è°ƒç”¨

ä½¿ç”¨ `useAuthenticatedFetch()` hook å‘èµ·è®¤è¯è¯·æ±‚ï¼š

```javascript
import { useAuthenticatedFetch, useBalance, useToken } from "@b3dotfun/upside-sdk";

function GameComponent() {
  const authFetch = useAuthenticatedFetch();
  const balance = useBalance();
  const token = useToken();

  const playGame = async prediction => {
    // è‡ªåŠ¨æ·»åŠ  Authorization å¤´
    const response = await authFetch("/api/game/coin-flip", {
      method: "POST",
      body: JSON.stringify({
        playerId: "player-id",
        prediction,
        betAmount: "1000000000000000000", // 1 WIN in wei
      }),
    });

    const data = await response.json();
    return data;
  };

  return (
    <div>
      <p>ä½™é¢: {(balance / 1e18).toFixed(2)} WIN</p>
      <button onClick={() => playGame("heads")}>é¢„æµ‹æ­£é¢</button>
    </div>
  );
}
```

**useAuthenticatedFetch() å¦‚ä½•å·¥ä½œ:**

- è‡ªåŠ¨åŒ…å« `Authorization: Bearer {token}` å¤´
- é»˜è®¤è®¾ç½® `Content-Type: application/json`
- åˆå¹¶æ‚¨æä¾›çš„é¢å¤–å¤´
- è‡ªåŠ¨å¤„ç†æ¥è‡ª `useToken()` çš„ä»¤ç‰Œ

## å‰ç«¯ç¤ºä¾‹

```javascript
import { ParentProvider, useParentContext } from "@b3dotfun/upside-sdk";

export default function CoinFlipGame() {
  return (
    <ParentProvider>
      <CoinFlipContent />
    </ParentProvider>
  );
}

function CoinFlipContent() {
  const { token, balance, playerId } = useParentContext();
  const [gameState, setGameState] = useState("ready"); // ready, playing, won, lost
  const [prediction, setPrediction] = useState(null);
  const [result, setResult] = useState(null);
  const [earnings, setEarnings] = useState(0);

  const playGame = async playerPrediction => {
    setPrediction(playerPrediction);
    setGameState("playing");

    try {
      // è°ƒç”¨æ‚¨çš„åç«¯
      const response = await fetch("/api/game/coin-flip", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          playerId,
          prediction: playerPrediction,
          betAmount: "100000000000000000", // 1 token in wei
        }),
      });

      const data = await response.json();

      if (data.outcome === "win") {
        setGameState("won");
        setEarnings(data.payout);
      } else {
        setGameState("lost");
        setEarnings(0);
      }

      setResult(data.result);
    } catch (error) {
      console.error("æ¸¸æˆé”™è¯¯:", error);
      setGameState("error");
    }
  };

  return (
    <div style={{ textAlign: "center", padding: "40px" }}>
      <h1>Coin Flip</h1>
      <p>ä½™é¢: {(balance / 1e18).toFixed(2)} WIN</p>

      {gameState === "ready" && (
        <div>
          <button onClick={() => playGame("heads")}>é¢„æµ‹æ­£é¢</button>
          <button onClick={() => playGame("tails")}>é¢„æµ‹åé¢</button>
        </div>
      )}

      {gameState === "playing" && <p>æ­£åœ¨ç¿»è½¬...</p>}

      {gameState === "won" && (
        <div>
          <p>ğŸ‰ ä½ èµ¢äº†ï¼ç¡¬å¸è½åœ¨äº† {result}</p>
          <p>+{(earnings / 1e18).toFixed(2)} WIN</p>
        </div>
      )}

      {gameState === "lost" && (
        <div>
          <p>âŒ ä½ è¾“äº†ï¼ç¡¬å¸è½åœ¨äº† {result}</p>
          <p>ç¥ä½ ä¸‹æ¬¡å¥½è¿</p>
        </div>
      )}

      {gameState !== "ready" && <button onClick={() => setGameState("ready")}>å†ç©ä¸€æ¬¡</button>}
    </div>
  );
}
```
