---
title: æµ‹è¯•ä¸ç¤ºä¾‹
description: åœ¨æœ¬åœ°æµ‹è¯•æ‚¨çš„æ¸¸æˆé›†æˆï¼ŒæŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ï¼Œå¹¶æ’æŸ¥å¸¸è§é—®é¢˜ã€‚
lang: cn
originalPath: upside/testing-and-examples.mdx
---
## åœ¨ Localhost ä¸Šæµ‹è¯•

### å¿«é€Ÿæµ‹è¯•è®¾ç½®

æ‚¨å¯ä»¥ç›´æ¥åœ¨ Upside.win çš„æµ‹è¯•ç¯å¢ƒä¸­æµ‹è¯•æ‚¨çš„æ¸¸æˆï¼Œæ— éœ€éƒ¨ç½²å³å¯åœ¨ localhost ä¸Šè¿è¡Œã€‚

**å·¥ä½œåŸç†ï¼š**

1. åœ¨ `http://localhost:3000`ï¼ˆæˆ–ä»»ä½•ç«¯å£ï¼‰ä¸Šè¿è¡Œæ‚¨çš„æ¸¸æˆåç«¯
2. å¯¹æ‚¨çš„ localhost URL è¿›è¡Œ Base64 ç¼–ç 
3. å¯¼èˆªåˆ° upside.win ä¸Šçš„æµ‹è¯• URL

### é€æ­¥æ“ä½œ

**æ­¥éª¤ 1ï¼šå¯åŠ¨æ‚¨çš„æ¸¸æˆåç«¯**

```bash
npm run dev
# æ¸¸æˆè¿è¡Œåœ¨ http://localhost:3000
```

**æ­¥éª¤ 2ï¼šå¯¹æ‚¨çš„ URL è¿›è¡Œ Base64 ç¼–ç **

ä½¿ç”¨ Node.jsï¼š

```javascript
const url = "http://localhost:3000";
const encoded = Buffer.from(url).toString("base64");
console.log(encoded); // aHR0cDovL2xvY2FsaG9zdDozMDAw
```

ä½¿ç”¨å‘½ä»¤è¡Œï¼š

```bash
echo -n "http://localhost:3000" | base64
# aHR0cDovL2xvY2FsaG9zdDozMDAw
```

åœ¨çº¿ä½¿ç”¨ï¼šä½¿ç”¨ä»»ä½• base64 ç¼–ç å™¨ï¼Œä¾‹å¦‚ https://www.base64encode.org/

**æ­¥éª¤ 3ï¼šåœ¨ Upside.win ä¸Šæµ‹è¯•**

è®¿é—®æµ‹è¯• URLï¼š

```
https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDozMDAw
```

å°† `aHR0cDovL2xvY2FsaG9zdDozMDAw` æ›¿æ¢ä¸ºæ‚¨ç¼–ç åçš„ URLã€‚

### ç¤ºä¾‹

ä¸åŒçš„ localhost URLsï¼š

| URL                     | Base64                         | æµ‹è¯•é“¾æ¥                                                    |
| ----------------------- | ------------------------------ | ------------------------------------------------------------ |
| `http://localhost:3000` | `aHR0cDovL2xvY2FsaG9zdDozMDAw` | `https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDozMDAw` |
| `http://localhost:5000` | `aHR0cDovL2xvY2FsaG9zdDo1MDOw` | `https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDo1MDOw` |
| `http://127.0.0.1:3000` | `aHR0cDovLzEyNy4wLjAuMTozMDAw` | `https://upside.win/test/games/aHR0cDovLzEyNy4wLjAuMTozMDAw` |

### å¼€å‘å·¥ä½œæµç¨‹

1. **åˆ›å»ºæ¸¸æˆä»£ç ** - ç¼–å†™æ‚¨çš„ React å‰ç«¯å’Œ Cloudflare Hono åç«¯
2. **æœ¬åœ°å¯åŠ¨** - åœ¨ localhost ä¸Šè¿è¡Œ `npm run dev`
3. **ç”Ÿæˆæµ‹è¯• URL** - å¯¹æ‚¨çš„ localhost åœ°å€è¿›è¡Œ Base64 ç¼–ç 
4. **åœ¨ Upside ä¸Šæµ‹è¯•** - è®¿é—® `https://upside.win/test/games/<BASE64>`
5. **è·å– JWT å¹¶æµ‹è¯•** - æ¸¸æˆåŠ è½½æ—¶ä½¿ç”¨çœŸå®çš„ JWT è¿›è¡Œæµ‹è¯•
6. **è¿­ä»£** - æœ¬åœ°è¿›è¡Œæ›´æ”¹å¹¶åˆ·æ–°æµ‹è¯• URL
7. **éƒ¨ç½²** - å‡†å¤‡å°±ç»ªæ—¶ï¼Œéƒ¨ç½²åç«¯å¹¶æ›´æ–°æ¸¸æˆ URL

### æœ¬åœ°æµ‹è¯•çš„æç¤º

- **ä½¿ç”¨åŒä¸€å°æœºå™¨**ï¼šæµ‹è¯•æ—¶ä¿æŒ localhost è¿è¡Œ
- **æ£€æŸ¥ CORS**ï¼šç¡®ä¿æ‚¨çš„åç«¯å…è®¸æ¥è‡ª upside.win åŸŸçš„è¯·æ±‚

### æœ¬åœ°æµ‹è¯•çš„æ•…éšœæ’é™¤

**é—®é¢˜**ï¼š"æ¸¸æˆæœªæ‰¾åˆ°" æˆ– 404

- **è§£å†³æ–¹æ¡ˆ**ï¼šéªŒè¯ localhost URL æ˜¯å¦æ­£ç¡®ä¸”ç¼–ç å‡†ç¡®

**é—®é¢˜**ï¼šCORS é”™è¯¯

- **è§£å†³æ–¹æ¡ˆ**ï¼šæ‚¨çš„åç«¯éœ€è¦æ¥å—æ¥è‡ª upside.win åŸŸçš„è¯·æ±‚

**é—®é¢˜**ï¼šæµ‹è¯•æ—¶å‡ºç° JWT é”™è¯¯

- **è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯æµ‹è¯• API å¯†é’¥ï¼Œè€Œä¸æ˜¯ç”Ÿäº§å¯†é’¥

**é—®é¢˜**ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥

- **è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥ localhost æ˜¯å¦åœ¨è¿è¡Œä¸”é˜²ç«å¢™å…è®¸è¯·æ±‚

## å®Œæ•´ç¤ºä¾‹ï¼šç¡¬å¸ç¿»è½¬æ¸¸æˆ

### å‰ç«¯ï¼ˆReactï¼‰

```javascript
import { ParentProvider, useParentContext } from "@b3dotfun/upside-sdk";

export default function CoinFlipGame() {
  return (
    <ParentProvider>
      <CoinFlipContent />
    </ParentProvider>
  );
}

function CoinFlipContent() {
  const { token, balance, playerId } = useParentContext();
  const [gameState, setGameState] = useState("ready"); // ready, playing, won, lost
  const [prediction, setPrediction] = useState(null);
  const [result, setResult] = useState(null);
  const [earnings, setEarnings] = useState(0);

  const playGame = async playerPrediction => {
    setPrediction(playerPrediction);
    setGameState("playing");

    try {
      // è°ƒç”¨æ‚¨çš„åç«¯
      const response = await fetch("/api/game/coin-flip", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          playerId,
          prediction: playerPrediction,
          betAmount: "100000000000000000", // 1 token in wei
        }),
      });

      const data = await response.json();

      if (data.outcome === "win") {
        setGameState("won");
        setEarnings(data.payout);
      } else {
        setGameState("lost");
        setEarnings(0);
      }

      setResult(data.result);
    } catch (error) {
      console.error("Game error:", error);
      setGameState("error");
    }
  };

  return (
    <div style={{ textAlign: "center", padding: "40px" }}>
      <h1>Coin Flip</h1>
      <p>Balance: {(balance / 1e18).toFixed(2)} WIN</p>

      {gameState === "ready" && (
        <div>
          <button onClick={() => playGame("heads")}>é¢„æµ‹æ­£é¢</button>
          <button onClick={() => playGame("tails")}>é¢„æµ‹åé¢</button>
        </div>
      )}

      {gameState === "playing" && <p>ç¿»è½¬ä¸­...</p>}

      {gameState === "won" && (
        <div>
          <p>ğŸ‰ ä½ èµ¢äº†ï¼ç¡¬å¸è½åœ¨äº† {result}</p>
          <p>+{(earnings / 1e18).toFixed(2)} WIN</p>
        </div>
      )}

      {gameState === "lost" && (
        <div>
          <p>âŒ ä½ è¾“äº†ï¼ç¡¬å¸è½åœ¨äº† {result}</p>
          <p>ç¥ä½ ä¸‹æ¬¡å¥½è¿</p>
        </div>
      )}

      {gameState !== "ready" && <button onClick={() => setGameState("ready")}>å†ç©ä¸€æ¬¡</button>}
    </div>
  );
}
```

### åç«¯ï¼ˆHono + Cloudflare Workersï¼‰

```javascript
import { Hono } from "hono";
import { createB3Client } from "@b3dotfun/upside-sdk/server";

const app = new Hono();

app.post("/api/game/coin-flip", async c => {
  const { prediction, betAmount } = await c.req.json();

  try {
    // ä» Hono ä¸Šä¸‹æ–‡åˆ›å»º B3Client
    // è‡ªåŠ¨ä» Authorization å¤´éƒ¨æå– auth token
    const b3Client = createB3Client(c);

    // æ­¥éª¤ 1: ä¸‹æ³¨ï¼ˆé‡‘é¢ä»¥ wei ä¸ºå•ä½ï¼‰
    const betResult = await b3Client.placeBet("coin-flip", betAmount);

    if (!betResult.sessionId) {
      return c.json({ error: "ä¸‹æ³¨å¤±è´¥" }, 400);
    }

    // æ­¥éª¤ 2: æ¸¸æˆé€»è¾‘ - ç¿»è½¬ç¡¬å¸
    const coin = Math.random() < 0.5 ? "heads" : "tails";
    const isWin = coin === prediction;
    // è®¡ç®—èµ”ä»˜ï¼šèµ¢å¾—æ—¶ 50% çš„åˆ©æ¶¦ï¼ˆä¸‹æ³¨é‡‘é¢ * 1.5ï¼Œä»¥ wei ä¸ºå•ä½ï¼‰
    const payout = isWin ? (BigInt(betAmount) * BigInt(150)) / BigInt(100) : "0";

    // æ­¥éª¤ 3: åœ¨æ‚¨çš„æ•°æ®åº“ä¸­å­˜å‚¨æ¸¸æˆï¼ˆD1 ç­‰ï¼‰
    // await db.execute(
    //   "INSERT INTO games (sessionId, prediction, result, betAmount, payout) VALUES (?, ?, ?, ?, ?)",
    //   [betResult.sessionId, prediction, coin, betAmount, payout.toString()]
    // );

    // æ­¥éª¤ 4: å¤„ç†èµ”ä»˜
    const payoutResult = await b3Client.processPayout("coin-flip", betResult.sessionId, payout.toString(), {
      playerChoice: prediction,
      result: coin,
      outcome: isWin ? "win" : "loss",
    });

    // æ­¥éª¤ 5: å°†ç»“æœè¿”å›ç»™å‰ç«¯
    return c.json({
      sessionId: betResult.sessionId,
      prediction,
      result: coin,
      outcome: isWin ? "win" : "loss",
      payout: isWin ? payout.toString() : "0",
      newBalance: payoutResult.newBalance,
    });
  } catch (error) {
    console.error("Game error:", error);
    return c.json({ error: error.message }, 500);
  }
});

export default app;
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**é—®é¢˜**ï¼š`placeBet` ç”±äº "ä½™é¢ä¸è¶³" è€Œå¤±è´¥

- **è§£å†³æ–¹æ¡ˆ**ï¼šä¸‹æ³¨å‰æ£€æŸ¥ç©å®¶ä½™é¢ï¼Œæˆ–åœ¨ UI ä¸­å¢åŠ ä¸‹æ³¨é‡‘é¢æ˜¾ç¤º

**é—®é¢˜**ï¼š`processPayout` è¿”å› "ä¼šè¯æœªæ‰¾åˆ°"

- **è§£å†³æ–¹æ¡ˆ**ï¼šéªŒè¯ sessionId ä¸ä¸‹æ³¨å“åº”åŒ¹é…ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‹¼å†™é”™è¯¯

**é—®é¢˜**ï¼šæ¸¸æˆä¼šè¯æˆ–ä¸‹æ³¨é‡å¤

- **è§£å†³æ–¹æ¡ˆ**ï¼šå¯¹é‡è¯•ä½¿ç”¨ç›¸åŒçš„ sessionIdï¼Œå®ç°æ‚¨ç«¯çš„å¹‚ç­‰æ€§

**é—®é¢˜**ï¼šæ¸¸æˆè¿›è¡Œä¸­ JWT è¿‡æœŸ

- **è§£å†³æ–¹æ¡ˆ**ï¼šæ¸¸æˆå¼€å§‹å‰åˆ·æ–°ä»¤ç‰Œï¼Œä¼˜é›…å¤„ç†ä»¤ç‰Œè¿‡æœŸ

**é—®é¢˜**ï¼šæ¸¸æˆé€»è¾‘åœ¨å®¢æˆ·ç«¯è¿è¡Œï¼Œå¯¼è‡´ä½œå¼Š

- **è§£å†³æ–¹æ¡ˆ**ï¼šå°†æ‰€æœ‰æ¸¸æˆé€»è¾‘ç§»è‡³åç«¯ï¼Œå®¢æˆ·ç«¯ä»…æ˜¾ç¤ºç»“æœ
