---
title: Como o BondKit Funciona
description: >-
  Criar ‚Üí Vincular ‚Üí Migrar: o fluxo completo para lan√ßamento de tokens de
  t√≠tulos ERC20 na Base.
lang: pt-BR
originalPath: bondkit/how-it-works.mdx
---
## Vis√£o Geral da Arquitetura

```mermaid
graph TB
    subgraph "Camada Frontend"
        UI["Aplica√ß√£o Web"]
        SDK["BondKit SDK"]
    end
    
    subgraph "Camada de Smart Contract"
        Factory["Contrato Factory"]
        Impl["Contrato de Implementa√ß√£o"]
        Token1["Clone de Token 1"]
        Token2["Clone de Token 2"]
        TokenN["Clone de Token N"]
    end
    
    subgraph "Camada DEX"
        V4["Uniswap v4"]
        Pool1["Pool 1"]
        Pool2["Pool 2"]
    end
    
    subgraph "Servi√ßos Backend"
        API["API de An√°lise"]
        DB["Banco de Dados"]
        Indexer["Indexador de Eventos"]
    end
    
    UI --> SDK
    SDK --> Factory
    Factory -.->|implanta| Token1
    Factory -.->|implanta| Token2
    Factory -.->|implanta| TokenN
    Token1 -->|migra para| Pool1
    Token2 -->|migra para| Pool2
    Pool1 --> V4
    Pool2 --> V4
    
    Token1 --> Indexer
    Token2 --> Indexer
    Indexer --> DB
    DB --> API
    API --> UI
    
    Impl -.->|modelo para| Token1
    Impl -.->|modelo para| Token2
    
    style Factory fill:#e1f5fe
    style V4 fill:#c8e6c9
    style API fill:#fff9c4
```

## Fluxo do Produto em Detalhes

<Steps>
  <Step title="Fase 1: Cria√ß√£o de Token">
    **O que acontece:**
    - Usu√°rio chama `deployBondkitToken()` no contrato Factory
    - Factory clona o contrato de Implementa√ß√£o usando o padr√£o de proxy m√≠nimo
    - Novo token √© inicializado com par√¢metros personalizados
    - Token entra automaticamente na fase de bonding
    
    **Custo de Gas:** ~200.000 gas (90% mais barato que uma implanta√ß√£o completa)
    **Tempo:** ~15 segundos
  </Step>
  
  <Step title="Fase 2: Trading na Curva de Bonding">
    **O que acontece:**
    - Usu√°rios compram/vendem tokens diretamente do contrato
    - Pre√ßo segue a curva de bonding algor√≠tmica: `S = S_final √ó (R/R_target)^exponente`
    - Taxa de 5% em todas as transa√ß√µes vai para o destinat√°rio da taxa
    - Contrato acumula ativos de cota√ß√£o (ETH/B3) em dire√ß√£o ao alvo
    - Backend indexa todas as transa√ß√µes para an√°lise
    
    **Mec√¢nica de Trading:**
    - Compra: Envie ETH/B3, receba tokens pelo pre√ßo atual da curva
    - Venda: Envie tokens, receba ETH/B3 menos taxas
    - Reembolsos autom√°ticos se a compra exceder o alvo
    
    **Dura√ß√£o:** At√© o alvo ser alcan√ßado (horas a semanas)
  </Step>
  
  <Step title="Fase 3: Migra√ß√£o para DEX">
    **O que acontece:**
    - Admin chama `migrateToDex()` quando o alvo √© alcan√ßado
    - Contrato calcula o pre√ßo justo de mercado como `sqrtPriceX96`
    - Cria e inicializa o pool Uniswap v4
    - Transfere a liquidez acumulada para o pool
    - Renuncia √† propriedade para o endere√ßo zero
    - Token se torna um ERC20 padr√£o com trading na DEX
    
    **P√≥s-migra√ß√£o:**
    - Curva de bonding permanentemente desabilitada
    - Todo trading via Uniswap v4
    - Sem controles de administra√ß√£o restantes
    - Descentraliza√ß√£o completa alcan√ßada
    
    **Custo de Gas:** ~500.000 gas
    **Tempo:** ~30 segundos
  </Step>
</Steps>

## Componentes do Sistema

### Smart Contracts

<AccordionGroup>
  <Accordion title="üè≠ Contrato Factory">
    **Prop√≥sito:** Implanta novos tokens de bond de forma eficiente
    
    **Fun√ß√µes Principais:**
    - `deployBondkitToken()` - Cria novo clone de token
    - `getImplementationAddress()` - Retorna endere√ßo do modelo
    - `setAllowedQuoteAsset()` - Fun√ß√£o de admin para listar ativos
    
    **Otimiza√ß√£o de Gas:**
    - Usa o padr√£o de proxy m√≠nimo EIP-1167
    - Compartilha l√≥gica entre todos os tokens
    - ~90% de economia de gas vs implanta√ß√µes individuais
  </Accordion>
  
  <Accordion title="üìú Contrato de Implementa√ß√£o">
    **Prop√≥sito:** Modelo para todos os tokens de bond
    
    **Caracter√≠sticas Principais:**
    - Conformidade com o padr√£o ERC20
    - Matem√°tica da curva de bonding
    - L√≥gica de migra√ß√£o para Uniswap v4
    - Sistema de distribui√ß√£o de taxas
    
    **Transi√ß√µes de Estado:**
    1. N√£o inicializado ‚Üí Fase de Bonding
    2. Fase de Bonding ‚Üí Pronto para Migra√ß√£o
    3. Pronto para Migra√ß√£o ‚Üí Fase DEX
  </Accordion>
  
  <Accordion title="ü™ô Clones de Token">
    **Prop√≥sito:** Inst√¢ncias individuais de token
    
    **Ciclo de Vida:**
    - Criado via factory
    - Inicializado com par√¢metros √∫nicos
    - Gerencia sua pr√≥pria curva de bonding
    - Auto-migra para Uniswap v4
    
    **Armazenamento:**
    - Metadados do token (nome, s√≠mbolo)
    - Suprimento e distribui√ß√£o
    - Estado da curva de bonding
    - Par√¢metros de migra√ß√£o
  </Accordion>
</AccordionGroup>

### Servi√ßos Backend

<AccordionGroup>
  <Accordion title="üîç Indexador de Eventos">
    **Prop√≥sito:** Captura toda atividade on-chain
    
    **Monitora:**
    - Cria√ß√µes de token
    - Transa√ß√µes de compra/venda
    - Eventos de migra√ß√£o
    - Atividades de transfer√™ncia
    
    **Tecnologia:**
    - Varredura blockchain em tempo real
    - Processamento de logs de eventos
    - Sincroniza√ß√£o com banco de dados
  </Accordion>
  
  <Accordion title="üìä Motor de An√°lise">
    **Prop√≥sito:** Processa dados brutos em insights
    
    **Gera:**
    - Dados de candlestick OHLCV
    - M√©tricas de volume
    - Rastreamento de liquidez
    - Hist√≥rico de pre√ßos
    - Estat√≠sticas de usu√°rios
    
    **Atualiza√ß√µes:** A cada bloco (~2 segundos)
  </Accordion>
  
  <Accordion title="üåê API REST">
    **Prop√≥sito:** Fornece dados para frontends
    
    **Endpoints:**
    - `/tokens` - Lista todos os tokens
    - `/tokens/{address}` - Detalhes do token
    - `/tokens/{address}/transactions` - Hist√≥rico de transa√ß√µes
    - `/tokens/{address}/ohlcv` - Dados para gr√°fico
    - `/users/{address}/portfolio` - Posse do usu√°rio
    
    **Formato:** JSON com pagina√ß√£o
  </Accordion>
</AccordionGroup>

### Pap√©is dos Usu√°rios

| Papel | Responsabilidades | Permiss√µes |
|------|-----------------|-------------|
| **Criador** | Implanta token, define par√¢metros, inicia migra√ß√£o | Controle total at√© a migra√ß√£o |
| **Traders** | Compra/venda durante o bonding, trade na DEX | Direitos padr√£o de trading |
| **Destinat√°rio da Taxa** | Recebe taxas de trading | Renda passiva apenas |
| **Admin de Migra√ß√£o** | Executa migra√ß√£o quando pronto | Direito de migra√ß√£o √∫nico |
| **Provedores de LP** | (P√≥s-migra√ß√£o) Adiciona liquidez ao Uniswap | Direitos padr√£o de LP |

## Mergulho T√©cnico

### Matem√°tica da Curva de Bonding

A curva de bonding determina o pre√ßo do token baseado no suprimento:

```
F√≥rmula de Pre√ßo:
S = S_final √ó (R / R_target)^exponente

Onde:
- S = Suprimento atual do token
- S_final = Suprimento final do token
- R = Quantia arrecadada (ETH/B3)
- R_target = Quantia alvo
- exponente = 1 / (1 + fatorDeAgressividade/100)
```

**Exemplos de C√°lculos:**

| Agressividade | Exponente | Comportamento do Pre√ßo |
|---------------|----------|----------------|
| 0 | 1.00 | Linear (pre√ßo constante) |
| 25 | 0.80 | Curva suave |
| 50 | 0.67 | Curva moderada |
| 75 | 0.57 | Curva acentuada |
| 100 | 0.50 | Muito acentuada (raiz quadrada) |

### C√°lculo do Pre√ßo de Migra√ß√£o

Ao migrar para Uniswap v4, o contrato:

1. **Calcula o pre√ßo de sa√≠da** da curva de bonding
2. **Converte para o formato sqrtPriceX96**:
   ```
   sqrtPriceX96 = sqrt(pre√ßo) √ó 2^96
   ```
3. **Inicializa o pool** com esse pre√ßo
4. **Adiciona liquidez** usando os fundos acumulados

### T√©cnicas de Otimiza√ß√£o de Gas

<Info>
  **Padr√£o de Proxy M√≠nimo (EIP-1167)**
  
  Em vez de implantar o c√≥digo completo do contrato para cada token:
  - Implanta um contrato de implementa√ß√£o (600KB)
  - Implanta contratos proxy min√∫sculos (45 bytes cada)
  - Proxies delegam todas as chamadas para a implementa√ß√£o
  - Resultado: 90% de economia de gas por implanta√ß√£o
</Info>

## Par√¢metros de Configura√ß√£o

### Par√¢metros de Cria√ß√£o de Token

| Par√¢metro | Tipo | Faixa/Formato | Impacto |
|-----------|------|--------------|--------|
| `name` | string | 1-50 chars | Nome de exibi√ß√£o do token |
| `symbol` | string | 2-10 chars | S√≠mbolo de trading |
| `finalTokenSupply` | uint256 | > 0 | Total de tokens que podem ser cunhados |
| `aggressivenessFactor` | uint8 | 0-100 | Inclina√ß√£o da curva |
| `targetEth` | uint256 | > 0 | Limiar para migra√ß√£o |
| `feeRecipient` | address | Endere√ßo v√°lido | Recebe taxas |
| `lpSplitRatioFeeRecipientBps` | uint256 | 0-10000 | Participa√ß√£o da taxa de LP (pontos base) |
| `migrationAdminAddress` | address | Endere√ßo v√°lido | Pode acionar migra√ß√£o |

### Par√¢metros de Execu√ß√£o

| A√ß√£o | Par√¢metros | Valida√ß√£o |
|--------|------------|------------|
| Compra | `minTokensOut`, `ethAmount` | Prote√ß√£o contra slippage |
| Venda | `tokenAmount`, `minEthOut` | Verifica√ß√£o de saldo, slippage |
| Migra√ß√£o | Nenhum | Alvo alcan√ßado, apenas admin |

### Constantes do Sistema

| Constante | Valor | Descri√ß√£o |
|----------|-------|-------------|
| Taxa de Trading | 5% | Aplicada a todas as transa√ß√µes |
| Decimais | 18 | Decimais padr√£o ERC20 |
| Min Alvo | 0.1 ETH | Alvo m√≠nimo vi√°vel |
| M√°x Agressividade | 100 | Fator m√°ximo da curva |

## Considera√ß√µes de Seguran√ßa

<Warning>
  **Caracter√≠sticas de Seguran√ßa Importantes:**
  
  1. **Ren√∫ncia de Propriedade**: Autom√°tica ap√≥s migra√ß√£o
  2. **Sem Fun√ß√£o de Cunhagem**: Suprimento fixo na cria√ß√£o
  3. **Par√¢metros Imut√°veis**: N√£o podem ser alterados ap√≥s implanta√ß√£o
  4. **Contratos Auditados**: C√≥digo revisado profissionalmente
  5. **Sem Backdoors de Admin**: Verdadeira descentraliza√ß√£o
  6. **Prote√ß√£o contra Slippage**: Incorporada nas fun√ß√µes de compra/venda
  7. **Prote√ß√£o contra Overflow**: Matem√°tica segura em todo o lugar
</Warning>

## Cen√°rios de Falha e Tratamento

| Cen√°rio | Resposta do Sistema |
|----------|----------------|
| Compra excede o alvo | Preenchimento parcial, reembolso do excesso |
| Liquidez insuficiente para venda | Transa√ß√£o reverte |
| Migra√ß√£o antes do alvo | Transa√ß√£o reverte |
| Tentativa de migra√ß√£o por n√£o-admin | Transa√ß√£o reverte |
| Tentativa de dupla migra√ß√£o | Transa√ß√£o reverte |
| Opera√ß√µes com endere√ßo zero | Transa√ß√£o reverte |

## Pr√≥ximos Passos

<CardGroup cols={2}>
  <Card title="Mec√¢nica de Pre√ßos" icon="chart-line" href="/bondkit/concepts/pricing">
    Entenda a matem√°tica da curva de bonding
  </Card>
  <Card title="Guia de Migra√ß√£o" icon="rocket" href="/bondkit/guides/migration">
    Aprenda o processo de migra√ß√£o
  </Card>
</CardGroup>
