---
title: Sessões de Checkout
description: >-
  Gerenciamento de sessão de checkout no lado do servidor para fluxos de
  pagamento programáticos
lang: pt-BR
originalPath: anyspend/api/checkout-sessions-api.mdx
---
Sessões de checkout representam uma tentativa individual de pagamento. Você pode criar sessões no lado do servidor para gerar URLs de checkout únicas para cada cliente, preencher previamente detalhes de pagamento e rastrear conversões com seus próprios IDs de referência.

<Info>
  Sessões de checkout expiram após 30 minutos por padrão. Use o parâmetro `expires_in` para personalizar a janela de expiração (mínimo de 5 minutos, máximo de 24 horas).
</Info>

## O objeto Sessão de Checkout

<ResponseField name="id" type="string">
  Identificador único para a sessão de checkout (por exemplo, `cs_abc123`).
</ResponseField>

<ResponseField name="url" type="string">
  A URL de checkout para redirecionar o cliente.
</ResponseField>

<ResponseField name="status" type="string">
  Status atual da sessão. Um dos seguintes: `open`, `processing`, `completed`, `expired`, `failed`.
</ResponseField>

<ResponseField name="payment_link_id" type="string | null">
  ID do link de pagamento associado, se a sessão foi criada a partir de um link de pagamento.
</ResponseField>

<ResponseField name="product_id" type="string | null">
  ID do produto associado.
</ResponseField>

<ResponseField name="token_address" type="string">
  Endereço do contrato do token a receber.
</ResponseField>

<ResponseField name="chain_id" type="number">
  ID da cadeia onde você deseja receber o pagamento.
</ResponseField>

<ResponseField name="recipient_address" type="string">
  Endereço da carteira que recebe o pagamento.
</ResponseField>

<ResponseField name="amount" type="string">
  Quantidade de pagamento na menor unidade do token.
</ResponseField>

<ResponseField name="amount_usd" type="string | null">
  Equivalente em USD no momento da criação da sessão.
</ResponseField>

<ResponseField name="success_url" type="string | null">
  URL para a qual o cliente é redirecionado após o pagamento bem-sucedido. Suporta variáveis de template.
</ResponseField>

<ResponseField name="cancel_url" type="string | null">
  URL para a qual o cliente é redirecionado se cancelar.
</ResponseField>

<ResponseField name="client_reference_id" type="string | null">
  Seu ID de referência interna para esta sessão.
</ResponseField>

<ResponseField name="metadata" type="object | null">
  Pares chave-valor arbitrários passados para webhooks e a transação.
</ResponseField>

<ResponseField name="customer_email" type="string | null">
  Endereço de email do cliente. Criptografado em repouso, incluído em payloads de webhook.
</ResponseField>

<ResponseField name="customer_name" type="string | null">
  Nome do cliente. Criptografado em repouso, incluído em payloads de webhook.
</ResponseField>

<ResponseField name="payer_address" type="string | null">
  Endereço da carteira do pagador (preenchido após conexão).
</ResponseField>

<ResponseField name="tx_hash" type="string | null">
  Hash da transação on-chain (preenchido após envio).
</ResponseField>

<ResponseField name="customer_id" type="string | null">
  ID do cliente associado (preenchido após pagamento).
</ResponseField>

<ResponseField name="form_data" type="object | null">
  Dados de formulário personalizados submetidos pelo cliente.
</ResponseField>

<ResponseField name="shipping_address" type="object | null">
  Endereço de entrega fornecido pelo cliente.
</ResponseField>

<ResponseField name="utm_source" type="string | null">
  Parâmetro de fonte UTM para atribuição.
</ResponseField>

<ResponseField name="utm_medium" type="string | null">
  Parâmetro de meio UTM para atribuição.
</ResponseField>

<ResponseField name="utm_campaign" type="string | null">
  Parâmetro de campanha UTM para atribuição.
</ResponseField>

<ResponseField name="expires_at" type="string">
  Carimbo de data/hora de expiração ISO 8601.
</ResponseField>

<ResponseField name="created_at" type="string">
  Carimbo de data/hora de criação ISO 8601.
</ResponseField>

<ResponseField name="completed_at" type="string | null">
  Carimbo de data/hora de conclusão ISO 8601.
</ResponseField>

### Status das sessões

| Status | Descrição |
|--------|-------------|
| `open` | Sessão está ativa e aguardando o cliente pagar. |
| `processing` | Cliente iniciou o pagamento; transação está sendo processada on-chain. |
| `completed` | Pagamento confirmado e recebido pelo destinatário. |
| `expired` | Sessão expirou antes do cliente completar o pagamento. |
| `failed` | Pagamento falhou devido a erro on-chain ou timeout. |

### Variáveis de template para URL

Os campos `success_url` e `cancel_url` suportam variáveis de template que são substituídas por valores reais quando o cliente é redirecionado:

| Variável | Descrição | Exemplo |
|----------|-------------|---------|
| `{SESSION_ID}` | O ID da sessão de checkout | `cs_abc123` |

<Tip>
  Use variáveis de template para procurar detalhes da sessão em seu servidor após o redirecionamento:
  `https://example.com/success?session_id={SESSION_ID}`
</Tip>

---

## Listar sessões de checkout

Recupere uma lista paginada de sessões de checkout.

<ParamField query="status" type="string">
  Filtrar por status da sessão: `open`, `processing`, `completed`, `expired`, `failed`.
</ParamField>

<ParamField query="payment_link_id" type="string">
  Filtrar por ID do link de pagamento.
</ParamField>

<ParamField query="page" type="number" default={1}>
  Número da página para paginação.
</ParamField>

<ParamField query="limit" type="number" default={20}>
  Número de resultados por página (máx. 100).
</ParamField>

<CodeGroup>
```bash cURL
curl -X GET "https://platform-api.anyspend.com/api/v1/checkout-sessions?status=completed&page=1&limit=20" \
  -H "Authorization: Bearer asp_xxx"
```

```typescript SDK
import { AnySpend } from "@b3dotfun/sdk";

const anyspend = new AnySpend(process.env.ANYSPEND_API_KEY!);

const { data, pagination } = await anyspend.checkoutSessions.list({
  status: "completed",
  page: 1,
  limit: 20,
});
```
</CodeGroup>

<Tabs>
  <Tab title="Response">
    ```json
    {
      "data": [
        {
          "id": "cs_abc123",
          "url": "https://pay.anyspend.com/s/cs_abc123",
          "status": "completed",
          "payment_link_id": "pl_abc123",
          "product_id": null,
          "token_address": "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
          "chain_id": 1,
          "recipient_address": "0x1234567890abcdef1234567890abcdef12345678",
          "amount": "50000000",
          "amount_usd": "50.00",
          "success_url": "https://example.com/success?session_id=cs_abc123",
          "cancel_url": "https://example.com/cancel",
          "client_reference_id": "order_12345",
          "metadata": {
            "order_id": "12345"
          },
          "payer_address": "0xaabb1234ccdd5678eeff9900aabb1234ccdd5678",
          "tx_hash": "0x9f8e7d6c5b4a3f2e1d0c9b8a7f6e5d4c3b2a1f0e",
          "customer_id": "cust_abc123",
          "form_data": null,
          "shipping_address": null,
          "utm_source": "twitter",
          "utm_medium": "social",
          "utm_campaign": "launch_feb_2026",
          "expires_at": "2026-02-25T08:45:00Z",
          "created_at": "2026-02-25T08:15:00Z",
          "completed_at": "2026-02-25T08:16:30Z"
        }
      ],
      "pagination": {
        "page": 1,
        "limit": 20,
        "total": 340,
        "total_pages": 17,
        "has_more": true
      }
    }
    ```
  </Tab>
</Tabs>

---

## Criar uma sessão de checkout

Crie uma sessão de checkout no lado do servidor com uma URL de pagamento única. Use isso para integrações programáticas onde você controla o fluxo de checkout do seu backend.

<ParamField body="payment_link_id" type="string">
  Crie a sessão a partir de um link de pagamento existente. Isso herda a configuração do link. Ou `payment_link_id` ou os campos manuais (`token_address`, `chain_id`, `recipient_address`, `amount`) são necessários.
</ParamField>

<ParamField body="token_address" type="string">
  Endereço do contrato do token a receber. Necessário se `payment_link_id` não for fornecido.
</ParamField>

<ParamField body="chain_id" type="number">
  ID da cadeia onde você deseja receber o pagamento. Necessário se `payment_link_id` não for fornecido.
</ParamField>

<ParamField body="recipient_address" type="string">
  Endereço da carteira que recebe o pagamento. Necessário se `payment_link_id` não for fornecido.
</ParamField>

<ParamField body="amount" type="string">
  Quantidade de pagamento na menor unidade do token. Necessário se `payment_link_id` não for fornecido.
</ParamField>

<ParamField body="product_id" type="string">
  Associe a sessão a um produto.
</ParamField>

<ParamField body="success_url" type="string">
  URL para redirecionar o cliente após o pagamento bem-sucedido. Suporta a variável de template `{SESSION_ID}`.
</ParamField>

<ParamField body="cancel_url" type="string">
  URL para redirecionar o cliente se cancelar.
</ParamField>

<ParamField body="client_reference_id" type="string">
  Seu ID de referência interno (por exemplo, ID do pedido). Máximo de 200 caracteres.
</ParamField>

<ParamField body="metadata" type="object">
  Pares chave-valor arbitrários passados para webhooks e a transação resultante. Até 50 chaves, valores de 500 caracteres.
</ParamField>

<ParamField body="customer_email" type="string">
  Endereço de email do cliente. Criptografado em repouso e incluído em payloads de webhook para cumprimento de pedido.
</ParamField>

<ParamField body="customer_name" type="string">
  Nome do cliente. Criptografado em repouso e incluído em payloads de webhook para cumprimento de pedido.
</ParamField>

<ParamField body="expires_in" type="number" default={1800}>
  Tempo de expiração da sessão em segundos. Mínimo 300 (5 minutos), máximo 86400 (24 horas). Padrão: 1800 (30 minutos).
</ParamField>

<ParamField body="utm_source" type="string">
  Fonte UTM para rastreamento de atribuição.
</ParamField>

<ParamField body="utm_medium" type="string">
  Meio UTM para rastreamento de atribuição.
</ParamField>

<ParamField body="utm_campaign" type="string">
  Campanha UTM para rastreamento de atribuição.
</ParamField>

<CodeGroup>
```bash cURL
# Criar a partir de um link de pagamento
curl -X POST "https://platform-api.anyspend.com/api/v1/checkout-sessions" \
  -H "Authorization: Bearer asp_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "payment_link_id": "pl_abc123",
    "success_url": "https://example.com/success?session_id={SESSION_ID}",
    "cancel_url": "https://example.com/cancel",
    "client_reference_id": "order_12345",
    "metadata": {
      "order_id": "12345"
    },
    "customer_email": "alice@example.com",
    "customer_name": "Alice Smith",
    "expires_in": 3600
  }'

# Criar com configuração manual
curl -X POST "https://platform-api.anyspend.com/api/v1/checkout-sessions" \
  -H "Authorization: Bearer asp_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "token_address": "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
    "chain_id": 1,
    "recipient_address": "0x1234567890abcdef1234567890abcdef12345678",
    "amount": "25000000",
    "success_url": "https://example.com/success?session_id={SESSION_ID}",
    "cancel_url": "https://example.com/cancel",
    "client_reference_id": "inv_67890",
    "utm_source": "email",
    "utm_medium": "newsletter",
    "utm_campaign": "february_promo"
  }'
```

```typescript SDK
// Criar a partir de um link de pagamento
const session = await anyspend.checkoutSessions.create({
  paymentLinkId: "pl_abc123",
  successUrl: "https://example.com/success?session_id={SESSION_ID}",
  cancelUrl: "https://example.com/cancel",
  clientReferenceId: "order_12345",
  metadata: {
    order_id: "12345",
    user_email: "alice@example.com",
  },
  expiresIn: 3600,
});

// Redirecionar o cliente para pagar
console.log(session.url);
// => "https://pay.anyspend.com/s/cs_newSession123"

// Criar com configuração manual
const manualSession = await anyspend.checkoutSessions.create({
  tokenAddress: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
  chainId: 1,
  recipientAddress: "0x1234567890abcdef1234567890abcdef12345678",
  amount: "25000000",
  successUrl: "https://example.com/success?session_id={SESSION_ID}",
  cancelUrl: "https://example.com/cancel",
  clientReferenceId: "inv_67890",
});
```
</CodeGroup>

<Tabs>
  <Tab title="Response">
    ```json
    {
      "id": "cs_newSession123",
      "url": "https://pay.anyspend.com/s/cs_newSession123",
      "status": "open",
      "payment_link_id": "pl_abc123",
      "product_id": null,
      "token_address": "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
      "chain_id": 1,
      "recipient_address": "0x1234567890abcdef1234567890abcdef12345678",
      "amount": "50000000",
      "amount_usd": "50.00",
      "success_url": "https://example.com/success?session_id={SESSION_ID}",
      "cancel_url": "https://example.com/cancel",
      "client_reference_id": "order_12345",
      "metadata": {
        "order_id": "12345",
        "user_email": "alice@example.com"
      },
      "payer_address": null,
      "tx_hash": null,
      "customer_id": null,
      "form_data": null,
      "shipping_address": null,
      "utm_source": null,
      "utm_medium": null,
      "utm_campaign": null,
      "expires_at": "2026-02-27T11:30:00Z",
      "created_at": "2026-02-27T10:30:00Z",
      "completed_at": null
    }
    ```
  </Tab>
</Tabs>

---

## Recuperar uma sessão de checkout

<ParamField path="id" type="string" required>
  O ID da sessão de checkout (por exemplo, `cs_abc123`).
</ParamField>

<Tip>
  Use este endpoint no seu manipulador `success_url` para verificar o status do pagamento e recuperar detalhes da transação após o cliente ser redirecionado de volta ao seu site.
</Tip>

<CodeGroup>
```bash cURL
curl -X GET "https://platform-api.anyspend.com/api/v1/checkout-sessions/cs_abc123" \
  -H "Authorization: Bearer asp_xxx"
```

```typescript SDK
const session = await anyspend.checkoutSessions.retrieve("cs_abc123");

if (session.status === "completed") {
  // O pagamento foi bem-sucedido
  console.log("Hash da transação:", session.tx_hash);
  console.log("Pagador:", session.payer_address);
}
```
</CodeGroup>

<Tabs>
  <Tab title="Response">
    Retorna o objeto [Sessão de Checkout](#o-objeto-sessao-de-checkout) completo.
  </Tab>
</Tabs>

---

## Expirar uma sessão de checkout

Expirar manualmente uma sessão de checkout aberta. Isso é útil quando o pedido subjacente é cancelado ou o pagamento não é mais necessário.

<ParamField path="id" type="string" required>
  O ID da sessão de checkout.
</ParamField>

<Warning>
  Apenas sessões com `status: "open"` podem ser expiradas. Tentar
