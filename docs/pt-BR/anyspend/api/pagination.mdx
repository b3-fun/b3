---
title: Paginação & Filtro
description: Paginando através de endpoints de lista e filtrando resultados
lang: pt-BR
originalPath: anyspend/api/pagination.mdx
---
# Paginação & Filtragem

Todos os endpoints de listas na API da Plataforma AnySpend retornam respostas paginadas. Esta página aborda como navegar por grandes conjuntos de resultados, filtrar dados e ordenar resultados.

## Formato de resposta de lista

Cada endpoint de lista retorna um envelope consistente:

```json
{
  "object": "list",
  "data": [
    { "object": "payment_link", "id": "pl_abc123...", "name": "Premium Membership" },
    { "object": "payment_link", "id": "pl_def456...", "name": "Basic Plan" }
  ],
  "has_more": true,
  "total_count": 142,
  "url": "/api/v1/payment-links"
}
```

| Campo | Tipo | Descrição |
|-------|------|-------------|
| `object` | `string` | Sempre `"list"` para respostas de lista. |
| `data` | `array` | O array de objetos de recurso para a página atual. Cada item inclui seu próprio campo de tipo `object`. |
| `has_more` | `boolean` | `true` se houver mais resultados além desta página. Use isso para determinar se deve buscar a próxima página. |
| `total_count` | `number` | O número total de recursos correspondentes em todas as páginas. |
| `url` | `string` | O caminho do endpoint da API para esta lista. |

## Parâmetros de paginação

Use os parâmetros de consulta `page` e `limit` para navegar pelos resultados.

| Parâmetro | Tipo | Padrão | Máx | Descrição |
|-----------|------|---------|-----|-------------|
| `page` | `integer` | `1` | -- | O número da página a ser recuperada (indexada em 1). |
| `limit` | `integer` | `20` | `100` | O número de resultados por página. |

### Exemplo básico de paginação

```bash
# Primeira página (padrão: 20 resultados)
curl "https://platform-api.anyspend.com/api/v1/payment-links" \
  -H "Authorization: Bearer asp_live_abc123..."

# Segunda página, 50 resultados por página
curl "https://platform-api.anyspend.com/api/v1/payment-links?page=2&limit=50" \
  -H "Authorization: Bearer asp_live_abc123..."
```

### Navegando pelas páginas

Use o campo `has_more` para determinar quando parar de paginar:

```typescript
async function fetchAllPaymentLinks(): Promise<PaymentLink[]> {
  const allLinks: PaymentLink[] = [];
  let page = 1;
  let hasMore = true;

  while (hasMore) {
    const response = await fetch(
      `https://platform-api.anyspend.com/api/v1/payment-links?page=${page}&limit=100`,
      {
        headers: {
          "Authorization": `Bearer ${process.env.ANYSPEND_API_KEY}`,
        },
      }
    );

    const body = await response.json();
    allLinks.push(...body.data);
    hasMore = body.has_more;
    page++;
  }

  return allLinks;
}
```

## Filtragem

A maioria dos endpoints de lista suporta parâmetros de consulta para filtrar resultados. Os filtros disponíveis dependem do tipo de recurso.

### Payment Links

| Parâmetro | Tipo | Descrição |
|-----------|------|-------------|
| `search` | `string` | Busca por nome ou código curto (correspondência parcial). |
| `active` | `"true"` ou `"false"` | Filtrar por status ativo/inativo. |

```bash
# Buscar por payment links contendo "premium"
curl "https://platform-api.anyspend.com/api/v1/payment-links?search=premium" \
  -H "Authorization: Bearer asp_live_abc123..."

# Apenas payment links ativos
curl "https://platform-api.anyspend.com/api/v1/payment-links?active=true" \
  -H "Authorization: Bearer asp_live_abc123..."

# Combinar filtros
curl "https://platform-api.anyspend.com/api/v1/payment-links?search=premium&active=true&limit=10" \
  -H "Authorization: Bearer asp_live_abc123..."
```

### Checkout Sessions

| Parâmetro | Tipo | Descrição |
|-----------|------|-------------|
| `status` | `"active"`, `"completed"`, `"expired"` | Filtrar sessões por status. |

```bash
# Sessões completadas para um payment link
curl "https://platform-api.anyspend.com/api/v1/payment-links/pl_abc123/sessions?status=completed" \
  -H "Authorization: Bearer asp_live_abc123..."
```

### Transactions

| Parâmetro | Tipo | Descrição |
|-----------|------|-------------|
| `status` | `string` | Filtrar por status da transação. |
| `chain_id` | `number` | Filtrar por rede blockchain. |

```bash
# Transações na Base (chain ID 8453)
curl "https://platform-api.anyspend.com/api/v1/transactions?chain_id=8453" \
  -H "Authorization: Bearer asp_live_abc123..."
```

## Ordenação

Endpoints de lista que suportam ordenação aceitam parâmetros `sort` e `order`.

| Parâmetro | Tipo | Padrão | Descrição |
|-----------|------|---------|-------------|
| `sort` | `string` | `created_at` | O campo pelo qual ordenar. Os valores permitidos variam de acordo com o recurso. |
| `order` | `"asc"` ou `"desc"` | `desc` | Direção da ordenação. |

### Campos de ordenação de Payment Links

| Campo | Descrição |
|-------|-------------|
| `created_at` | Quando o payment link foi criado (padrão). |
| `updated_at` | Quando o payment link foi modificado pela última vez. |
| `name` | Alfabético por nome. |
| `current_uses` | Número de checkouts completados. |

```bash
# Payment links mais populares primeiro
curl "https://platform-api.anyspend.com/api/v1/payment-links?sort=current_uses&order=desc" \
  -H "Authorization: Bearer asp_live_abc123..."

# Alfabético por nome
curl "https://platform-api.anyspend.com/api/v1/payment-links?sort=name&order=asc" \
  -H "Authorization: Bearer asp_live_abc123..."
```

## Exemplo de auto-paginação

Para conveniência, você pode construir um iterador assíncrono que lida com a paginação automaticamente:

```typescript
async function* paginate<T>(
  endpoint: string,
  params: Record<string, string> = {},
  limit = 100,
): AsyncGenerator<T> {
  let page = 1;
  let hasMore = true;

  while (hasMore) {
    const queryParams = new URLSearchParams({
      ...params,
      page: String(page),
      limit: String(limit),
    });

    const response = await fetch(
      `https://platform-api.anyspend.com/api/v1/${endpoint}?${queryParams}`,
      {
        headers: {
          "Authorization": `Bearer ${process.env.ANYSPEND_API_KEY}`,
        },
      }
    );

    const body = await response.json();

    for each (const item of body.data) {
      yield item as T;
    }

    hasMore = body.has_more;
    page++;
  }
}

// Uso com for-await
async function main() {
  for await (const link of paginate<PaymentLink>("payment-links", { active: "true" })) {
    console.log(`${link.name}: ${link.current_uses} completions`);
  }
}
```

## Contando resultados

Use `total_count` de qualquer página para obter o número total de recursos correspondentes sem buscar todas as páginas:

```typescript
async function countActivePaymentLinks(): Promise<number> {
  const response = await fetch(
    "https://platform-api.anyspend.com/api/v1/payment-links?active=true&limit=1",
    {
      headers: {
        "Authorization": `Bearer ${process.env.ANYSPEND_API_KEY}`,
      },
    }
  );

  const body = await response.json();
  return body.total_count;
}
```

Definir `limit=1` minimiza a carga de resposta quando você só precisa da contagem.

## Melhores práticas

<AccordionGroup>
<Accordion title="Use limit=100 para operações em massa">
Quando precisar buscar todos os registros (por exemplo, para exportação de dados ou sincronização), use o `limit=100` máximo para minimizar o número de chamadas de API e permanecer dentro dos limites de taxa.
</Accordion>

<Accordion title="Use has_more em vez de total_count para loops de paginação">
`has_more` é o sinal autoritativo para saber se deve buscar a próxima página. Evite calcular contagens de páginas a partir de `total_count`, pois o total pode mudar entre as solicitações.
</Accordion>

<Accordion title="Cache total_count para controles de paginação da UI">
Ao construir uma UI de paginação (por exemplo, "Página 3 de 8"), busque `total_count` uma vez e armazene em cache para a sessão. Busque novamente apenas quando o usuário atualizar ou aplicar novos filtros.
</Accordion>

<Accordion title="Combine filtros com paginação">
Aplique filtros antes de paginar para reduzir o conjunto de resultados. Isso é mais eficiente do que buscar todos os registros e filtrar no lado do cliente:

```bash
# Em vez de buscar todos os links e filtrar localmente...
# Filtre no lado do servidor e pagine os resultados filtrados
curl "https://platform-api.anyspend.com/api/v1/payment-links?active=true&search=premium&limit=20" \
  -H "Authorization: Bearer asp_live_abc123..."
```
</Accordion>

<Accordion title="Respeite os limites de taxa durante buscas em massa">
Se você estiver paginando por um grande conjunto de dados, esteja atento ao limite de 120 solicitações/min. Para conjuntos de dados muito grandes, adicione um curto atraso entre as solicitações de página:

```typescript
async function fetchWithDelay() {
  for await (const link of paginate("payment-links")) {
    process.stdout.write(".");
  }
  // A função paginate faz no máximo ceil(total / 100) solicitações.
  // Para 10.000 registros, isso é 100 solicitações -- dentro do limite de 120/min.
}
```
</Accordion>
</AccordionGroup>
