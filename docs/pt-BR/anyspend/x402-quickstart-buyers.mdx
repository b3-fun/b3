---
title: Guia R√°pido para Compradores
description: >-
  Pague por APIs e servi√ßos com paywall usando qualquer token com o AnySpend
  x402 Client SDK
lang: pt-BR
originalPath: anyspend/x402-quickstart-buyers.mdx
---
## Vis√£o Geral

Este guia mostra como usar o **AnySpend x402 Client SDK** para pagar por recursos com paywall usando tokens compat√≠veis com suporte a EIP-2612 ou EIP-3009. O SDK gerencia todo o fluxo de pagamento automaticamente, incluindo a gera√ß√£o de assinatura e l√≥gica de tentativas.

Voc√™ pode usar este mesmo cliente para pagar por qualquer servi√ßo habilitado para x402, n√£o apenas aqueles que usam AnySpend.

<Card title="Verificador de Compatibilidade de Tokens" icon="check-circle" href="https://anyspend.com/x402-tokens">
  Navegue por tokens compat√≠veis com suporte a EIP-2612 ou EIP-3009 em mais de 19 redes
</Card>

## Pr√©-requisitos

Antes de come√ßar, certifique-se de ter:

- **Node.js 18+** ou runtime JavaScript compat√≠vel
- **Uma carteira cripto** com tokens compat√≠veis (USDC, DAI ou outros tokens EIP-2612/EIP-3009)
- **Uma biblioteca de carteira** como [viem](https://viem.sh) ou [ethers.js](https://docs.ethers.org)
- **Acesso a um servi√ßo habilitado para x402** (como uma API com paywall)

<Note>
**Importante**: Apenas tokens com suporte a EIP-2612 (Permit) ou EIP-3009 (TransferWithAuthorization) s√£o compat√≠veis com AnySpend x402 para pagamentos sem g√°s. Use o [Verificador de Compatibilidade de Tokens](https://anyspend.com/x402-tokens) para verificar se o seu token √© suportado.
</Note>

## Instala√ß√£o

Instale o x402 client SDK:

<CodeGroup>
```bash npm
npm install anyspend-x402-client viem
```

```bash yarn
yarn add anyspend-x402-client viem
```

```bash pnpm
pnpm add anyspend-x402-client viem
```
</CodeGroup>

O SDK usa [viem](https://viem.sh) para opera√ß√µes de carteira e gera√ß√£o de assinatura.

## Uso B√°sico

### 1. Crie um cliente de carteira

Primeiro, configure seu cliente de carteira usando viem:

```typescript
import { createWalletClient, custom } from 'viem';
import { base } from 'viem/chains';

// Para navegador com MetaMask ou outra extens√£o de carteira
const walletClient = createWalletClient({
  chain: base,
  transport: custom(window.ethereum)
});

// Obtenha o endere√ßo do usu√°rio
const [address] = await walletClient.getAddresses();
```

### 2. Inicialize o cliente x402

Crie uma inst√¢ncia do cliente x402:

```typescript
import { X402Client } from 'anyspend-x402-client';

const x402Client = new X402Client({
  walletClient,           // Seu cliente de carteira viem
  preferredToken: '0x...', // Opcional: token padr√£o para pagamento
  autoRetry: true          // Auto-gerenciar respostas 402 (padr√£o: verdadeiro)
});
```

### 3. Fa√ßa uma solicita√ß√£o paga

Use o cliente para acessar recursos com paywall:

```typescript
try {
  const response = await x402Client.request(
    'https://api.example.com/premium-data',
    {
      method: 'GET',
    }
  );

  console.log('Dados:', response.data);
  console.log('TX de Pagamento:', response.paymentResponse?.txHash);
} catch (error) {
  console.error('Pagamento falhou:', error);
}
```

**O que acontece:**

1. Cliente faz solicita√ß√£o inicial
2. API retorna `402 Payment Required` com detalhes do pagamento
3. X402Client assina automaticamente a autoriza√ß√£o de pagamento
4. Cliente tenta novamente a solicita√ß√£o com pagamento
5. API verifica e liquida o pagamento
6. Cliente recebe os dados solicitados

## Uso Avan√ßado

### Especificar token de pagamento

Existem duas maneiras de especificar com qual token voc√™ deseja pagar:

#### Op√ß√£o 1: usando X402Client

Pague com um token espec√≠fico definindo `preferredToken`:

```typescript
const response = await x402Client.request(
  'https://ai-agent-api.com/inference',
  {
    method: 'POST',
    body: { prompt: 'Gerar uma imagem de um gato' },
    preferredToken: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' // USDC na Base
  }
);
```

#### Op√ß√£o 2: usando wrapFetchWithPayment (avan√ßado)

Para mais controle, use a fun√ß√£o `wrapFetchWithPayment` de n√≠vel mais baixo:

```typescript
import { wrapFetchWithPayment } from 'anyspend-x402-client';

const tokenAddress = '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'; // USDC na Base
const selectedChain = 8453; // Base

const paymentPreferences = {
  preferredToken: tokenAddress,
  preferredNetwork: 'base' as const, // ou use getNetworkName(selectedChain)
};

// Envolva fetch com tratamento autom√°tico de pagamento
const fetchWithPayment = wrapFetchWithPayment(
  fetch,
  walletClient,
  '1000000', // Valor m√°ximo de pagamento (1 USDC em 6 decimais)
  undefined, // Use o seletor padr√£o de requisitos de pagamento
  undefined, // Use a configura√ß√£o padr√£o
  paymentPreferences, // Especifique seu token e rede preferidos
);

// Use o fetch envolvido como o fetch normal
const response = await fetchWithPayment('https://api.example.com/premium-data');
const data = await response.json();
```

**Benef√≠cios de `wrapFetchWithPayment`:**
- Funciona com qualquer c√≥digo baseado em `fetch`
- Controle mais granular sobre o comportamento de pagamento
- Pode especificar valor m√°ximo de pagamento
- Seletor de requisitos de pagamento personalizado
- Suporta signat√°rios de m√∫ltiplas redes

Se o servidor de recursos suportar o middleware AnySpend, voc√™ pagar√° o valor equivalente no seu token preferido em vez de USDC.

### Usando cabe√ßalhos HTTP para prefer√™ncias de pagamento

<Note>
**Novo no X402**: Agora voc√™ pode especificar prefer√™ncias de pagamento usando cabe√ßalhos HTTP, o que √© particularmente √∫til ao fazer solicita√ß√µes HTTP diretas ou ao integrar com clientes HTTP existentes.
</Note>

Ao fazer solicita√ß√µes para servi√ßos habilitados para X402, voc√™ pode especificar seu token de pagamento preferido e rede usando estes cabe√ßalhos HTTP:

```bash
curl -X GET https://api.example.com/premium-data \
  -H "X-PREFERRED-TOKEN: 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913" \
  -H "X-PREFERRED-NETWORK: base-mainnet"
```

**Endere√ßos Comuns de Tokens:**
- **USDC na Base**: `0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913`
- **USDT na Base**: `0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2`

**Identificadores de Rede:**
- `base-mainnet` - Base Mainnet
- `ethereum-mainnet` - Ethereum Mainnet
- `arbitrum-mainnet` - Arbitrum One
- `optimism-mainnet` - Optimism Mainnet
- `polygon-mainnet` - Polygon PoS

Esses cabe√ßalhos funcionam com qualquer cliente HTTP e s√£o automaticamente respeitados pelos servidores de recursos habilitados para X402 usando middleware AnySpend. Se nenhum cabe√ßalho for fornecido, o servidor usar√° USDC por padr√£o.

#### Usando cabe√ßalhos com X402Client

O X402Client adiciona automaticamente esses cabe√ßalhos com base na sua configura√ß√£o:

```typescript
const x402Client = new X402Client({
  walletClient,
  preferredToken: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // USDC
  network: 'base-mainnet'
});

// Cabe√ßalhos s√£o automaticamente adicionados a todas as solicita√ß√µes
const response = await x402Client.request('https://api.example.com/data');
```

#### Usando cabe√ßalhos com fetch

Voc√™ tamb√©m pode adicionar esses cabe√ßalhos manualmente ao usar a API `fetch` nativa ou outros clientes HTTP:

```typescript
const response = await fetch('https://api.example.com/premium-data', {
  headers: {
    'X-PREFERRED-TOKEN': '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
    'X-PREFERRED-NETWORK': 'base-mainnet'
  }
});

// Depois, trate a resposta 402 se necess√°rio
if (response.status === 402) {
  // Processar pagamento usando X402Client ou wrapFetchWithPayment
}
```

### Solicita√ß√µes POST com corpo

Fa√ßa solicita√ß√µes POST pagas:

```typescript
const response = await x402Client.request(
  'https://api.example.com/compute',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: {
      model: 'gpt-4',
      messages: [{ role: 'user', content: 'Ol√°!' }]
    }
  }
);
```

### Fluxo de pagamento manual

Para mais controle, gerencie o fluxo de pagamento manualmente:

```typescript
// 1. Fa√ßa solicita√ß√£o inicial
const initialResponse = await fetch('https://api.example.com/premium-data');

if (initialResponse.status === 402) {
  // 2. Analise os requisitos de pagamento
  const paymentRequired = await initialResponse.json();
  const requirements = paymentRequired.requirements[0];

  console.log('Pagamento necess√°rio:', {
    amount: requirements.amount,
    token: requirements.asset,
    recipient: requirements.recipient
  });

  // 3. Assine a autoriza√ß√£o de pagamento
  const paymentHeader = await x402Client.signPayment(requirements);

  // 4. Tente novamente com pagamento
  const paidResponse = await fetch('https://api.example.com/premium-data', {
    headers: {
      'X-PAYMENT': paymentHeader
    }
  });

  const data = await paidResponse.json();
  const paymentResponse = paidResponse.headers.get('X-PAYMENT-RESPONSE');

  console.log('Pagamento bem-sucedido!', JSON.parse(atob(paymentResponse)));
}
```

## Op√ß√µes de Configura√ß√£o

### X402ClientOptions

```typescript
interface X402ClientOptions {
  walletClient: WalletClient;        // cliente de carteira viem (obrigat√≥rio)
  network?: string;                   // Rede padr√£o (ex.: 'base-mainnet')
  preferredToken?: string;            // Endere√ßo do token de pagamento preferido
  autoRetry?: boolean;                // Auto-tentar novamente em 402 (padr√£o: verdadeiro)
  timeout?: number;                   // Tempo limite de solicita√ß√£o em ms (padr√£o: 30000)
}
```

### Op√ß√µes de Solicita√ß√£o

```typescript
interface RequestOptions {
  method?: 'GET' | 'POST' | 'PUT' | 'DELETE';
  headers?: Record<string, string>;
  body?: any;                         // Corpo da solicita√ß√£o (serializado automaticamente para JSON)
  preferredToken?: string;            // Substituir token preferido padr√£o
}
```

### Par√¢metros de wrapFetchWithPayment

Para casos de uso avan√ßados, `wrapFetchWithPayment` oferece controle de n√≠vel mais baixo:

```typescript
function wrapFetchWithPayment(
  fetchFn: typeof fetch,              // Fun√ß√£o fetch para envolver
  signer: Signer | MultiNetworkSigner, // Cliente de carteira para assinatura
  maxPaymentValue: string,             // Pagamento m√°ximo na unidade menor (ex.: '1000000' para 1 USDC)
  selectPaymentRequirements?: Function, // Seletor de requisitos de pagamento personalizado
  config?: {
    timeout?: number;                  // Tempo limite de solicita√ß√£o em ms
    maxRetries?: number;               // M√°ximo de tentativas de pagamento
  },
  paymentPreferences?: {
    preferredToken?: string;           // Endere√ßo do token para pagamento
    preferredNetwork?: string;         // Identificador de rede (ex.: 'base', 'ethereum')
  }
): typeof fetch
```

**Exemplo com todos os par√¢metros:**

```typescript
import { wrapFetchWithPayment } from 'anyspend-x402-client';

const fetchWithPayment = wrapFetchWithPayment(
  fetch,
  walletClient,
  '5000000', // M√°x 5 USDC
  undefined, // Seletor de requisitos padr√£o
  {
    timeout: 60000,    // Tempo limite de 60 segundos
    maxRetries: 3      // Tentar at√© 3 vezes
  },
  {
    preferredToken: '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb', // DAI
    preferredNetwork: 'base'
  }
);
```

## Tokens Suportados

**Apenas tokens com suporte a EIP-2612 ou EIP-3009** s√£o compat√≠veis com AnySpend x402 para pagamentos sem g√°s.

### O que s√£o EIP-2612 e EIP-3009?

- **EIP-2612 (Permit)**: Permite aprova√ß√µes de tokens sem g√°s via assinaturas fora da cadeia
- **EIP-3009 (TransferWithAuthorization)**: Habilita transfer√™ncias sem g√°s via assinaturas fora da cadeia (usado pelo USDC)


### Tokens compat√≠veis comuns

- **USDC** - Suporte a EIP-3009 em todas as cadeias
- **B3** - Suporte a permit EIP-2612
- **Muitos outros tokens** - Verifique a compatibilidade usando a ferramenta abaixo

<Card title="Verificador de Compatibilidade de Tokens" icon="check-circle" href="https://anyspend.com/x402-tokens">
  Navegue por todos os tokens compat√≠veis com suporte a EIP-2612 ou EIP-3009 em mais de 19 redes
</Card>

Veja [Suporte de Rede](/anyspend/x402-network-support) para endere√ßos de tokens detalhados por cadeia.

## Exemplos

### Componente React (usando X402Client)

```tsx
import { X402Client } from 'anyspend-x402-client';
import { useWalletClient } from 'wagmi';
import { useState } from 'react';

export function PremiumDataFetcher() {
  const { data: walletClient } = useWalletClient();
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);

  const fetchPremiumData = async () => {
    if (!walletClient) return;

    setLoading(true);
    try {
      const client = new X402Client({
        walletClient,
        preferredToken: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' // USDC na Base
      });

      const response = await client.request(
        'https://api.example.com/premium-data'
      );

      setData(response.data);
      console.log('Pago com TX:', response.paymentResponse?.txHash);
    } catch (error) {
      console.error('Pagamento falhou:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <button onClick={fetchPremiumData} disabled={loading}>
        {loading ? 'Pagando...' : 'Obter Dados Premium (Custa 1 USDC)'}
      </button>
      {data && <pre>{JSON.stringify(data, null, 2)}</pre>}
    </div>
  );
}
```

### Componente React (usando wrapFetchWithPayment)

Para aplica√ß√µes que precisam de mais controle ou usam c√≥digo baseado em fetch existente:

```tsx
import { wrapFetchWithPayment } from 'anyspend-x402-client';
import { useWalletClient, useChainId } from 'wagmi';
import { useState } from 'react';

// Auxiliar para obter o nome da rede a partir do ID da cadeia
const getNetworkName = (chainId: number): string => {
  const networks: Record<number, string> = {
    8453: 'base',
    1: 'ethereum',
    42161: 'arbitrum',
    10: 'optimism',
    137: 'polygon',
  };
  return networks[chainId] || 'base';
};

export function PremiumDataFetcherAdvanced() {
  const { data: walletClient } = useWalletClient();
  const selectedChain = useChainId();
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [log, setLog] = useState<string[]>([]);

  // Endere√ßos de tokens por cadeia
  const tokenAddresses: Record<number, string> = {
    8453: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // USDC na Base
    1: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', // USDC no Ethereum
  };

  const fetchPremiumData = async () => {
    if (!walletClient) return;

    setLoading(true);
    setLog([]);

    try {
      const tokenAddress = tokenAddresses[selectedChain];

      const paymentPreferences = {
        preferredToken: tokenAddress,
        preferredNetwork: getNetworkName(selectedChain) as any,
      };

      setLog(prev => [...prev,
        `üí° Usando token preferido: ${tokenAddress} em ${getNetworkName(selectedChain)}`
      ]);

      // En
