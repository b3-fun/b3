---
title: Tratamento de Erros & Solu√ß√£o de Problemas
description: >-
  Guia completo para tratar erros com eleg√¢ncia e depurar problemas comuns com o
  AnySpend
lang: pt-BR
originalPath: anyspend/error-handling.mdx
---
# Tratamento de Erros & Solu√ß√£o de Problemas

Guia abrangente para lidar com erros de forma graciosa e depurar problemas comuns com o AnySpend para proporcionar a melhor experi√™ncia ao usu√°rio.

## üìä Ciclo de Vida do Status do Pedido

Entender os estados dos pedidos √© crucial para o tratamento adequado de erros e a experi√™ncia do usu√°rio.

### Tipos de Status do Pedido

```typescript title="Enum de Status do Pedido" icon="list"
enum OrderStatus {
  // Estados Iniciais
  SCANNING_DEPOSIT_TRANSACTION = "scanning_deposit_transaction",
  WAITING_STRIPE_PAYMENT = "waiting_stripe_payment",
  EXPIRED = "expired",

  // Estados de Processamento
  SENDING_TOKEN_FROM_VAULT = "sending_token_from_vault",
  RELAY = "relay",

  // Estados de Sucesso
  EXECUTED = "executed",

  // Estados de Falha
  REFUNDING = "refunding",
  REFUNDED = "refunded",
  FAILURE = "failure",
}
```

### Descri√ß√µes dos Status

<table>
  <thead>
    <tr>
      <th>Status</th>
      <th>Descri√ß√£o</th>
      <th>A√ß√£o do Usu√°rio Necess√°ria</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>`scanning_deposit_transaction`</td>
      <td>Aguardando confirma√ß√£o do pagamento</td>
      <td>Nenhuma - aguarde a confirma√ß√£o da blockchain</td>
    </tr>
    <tr>
      <td>`waiting_stripe_payment`</td>
      <td>Processando pagamento com cart√£o de cr√©dito</td>
      <td>Pode ser necess√°rio completar o 3D Secure</td>
    </tr>
    <tr>
      <td>`sending_token_from_vault`</td>
      <td>Enviando tokens para troca</td>
      <td>Nenhuma - processo autom√°tico</td>
    </tr>
    <tr>
      <td>`relay`</td>
      <td>Transa√ß√£o cross-chain em progresso</td>
      <td>Nenhuma - aguarde a conclus√£o</td>
    </tr>
    <tr>
      <td>`executed`</td>
      <td>Transa√ß√£o conclu√≠da com sucesso</td>
      <td>Nenhuma - sucesso!</td>
    </tr>
    <tr>
      <td>`expired`</td>
      <td>Pedido expirou antes da conclus√£o</td>
      <td>Crie um novo pedido</td>
    </tr>
    <tr>
      <td>`refunding`</td>
      <td>Reembolso autom√°tico em progresso</td>
      <td>Nenhuma - aguarde o reembolso</td>
    </tr>
    <tr>
      <td>`refunded`</td>
      <td>Reembolso conclu√≠do</td>
      <td>Verifique a carteira para tokens reembolsados</td>
    </tr>
    <tr>
      <td>`failure`</td>
      <td>Transa√ß√£o falhou</td>
      <td>Revise os detalhes do erro, tente novamente</td>
    </tr>
  </tbody>
</table>

## ‚ö†Ô∏è C√≥digos de Erro Comuns

### Erros de Pagamento

<AccordionGroup>
<Accordion title="INSUFFICIENT_BALANCE">
**Descri√ß√£o**: Usu√°rio n√£o tem tokens suficientes para a transa√ß√£o

**Solu√ß√£o**: Solicite que o usu√°rio adicione fundos √† sua carteira ou escolha um token de pagamento diferente

**Exemplo**:

```typescript
if (error.message === "INSUFFICIENT_BALANCE") {
  toast.error("Saldo insuficiente. Por favor, adicione fundos √† sua carteira.");
  // Opcionalmente redirecione para entrada de fiat
  openFiatOnramp();
}
```

</Accordion>

<Accordion title="INVALID_TOKEN_ADDRESS">
**Descri√ß√£o**: Contrato de token n√£o suportado na cadeia de destino

**Solu√ß√£o**: Verifique se o token √© suportado e forne√ßa op√ß√µes alternativas

**Exemplo**:

```typescript
if (error.message === "INVALID_TOKEN_ADDRESS") {
  toast.error("Este token n√£o √© suportado. Por favor, escolha outro.");
  showSupportedTokens();
}
```

</Accordion>

<Accordion title="MINIMUM_AMOUNT_NOT_MET">
**Descri√ß√£o**: Quantidade da transa√ß√£o est√° abaixo do limite m√≠nimo

**Solu√ß√£o**: Aumente a quantidade da transa√ß√£o ou informe ao usu√°rio os requisitos m√≠nimos

**Exemplo**:

```typescript
if (error.message === "MINIMUM_AMOUNT_NOT_MET") {
  toast.error(`A quantidade m√≠nima √© $${minimumAmount}. Por favor, aumente sua quantidade.`);
}
```

</Accordion>

<Accordion title="MAXIMUM_AMOUNT_EXCEEDED">
**Descri√ß√£o**: Quantidade da transa√ß√£o excede o limite m√°ximo

**Solu√ß√£o**: Reduza a quantidade ou divida em m√∫ltiplas transa√ß√µes

**Exemplo**:

```typescript
if (error.message === "MAXIMUM_AMOUNT_EXCEEDED") {
  toast.error(`A quantidade m√°xima √© $${maximumAmount}. Por favor, reduza sua quantidade.`);
}
```

</Accordion>
</AccordionGroup>

### Erros de Rede

<AccordionGroup>
<Accordion title="SLIPPAGE">
**Descri√ß√£o**: Pre√ßo movido al√©m da toler√¢ncia aceit√°vel durante a execu√ß√£o

**Solu√ß√£o**: Tente novamente com maior toler√¢ncia de slippage ou aguarde a estabilidade do pre√ßo

**Exemplo**:

```typescript
if (error.message === "SLIPPAGE") {
  toast.warning("Pre√ßo movido desfavoravelmente. Tentando novamente com configura√ß√µes ajustadas...");
  retryWithHigherSlippage();
}
```

</Accordion>

<Accordion title="NETWORK_ERROR">
**Descri√ß√£o**: Problemas de conex√£o RPC ou congestionamento da blockchain

**Solu√ß√£o**: Tente novamente ap√≥s um atraso ou mude para um RPC alternativo

**Exemplo**:

```typescript
if (error.message === "NETWORK_ERROR") {
  toast.error("Problema de rede detectado. Por favor, verifique a conex√£o e tente novamente.");
  scheduleRetry();
}
```

</Accordion>

<Accordion title="QUOTE_EXPIRED">
**Descri√ß√£o**: Cota√ß√£o de pre√ßo n√£o √© mais v√°lida

**Solu√ß√£o**: Obtenha uma nova cota√ß√£o e tente a transa√ß√£o novamente

**Exemplo**:

```typescript
if (error.message === "QUOTE_EXPIRED") {
  toast.info("Cota√ß√£o de pre√ßo expirada. Obtendo nova cota√ß√£o...");
  refreshQuoteAndRetry();
}
```

</Accordion>

<Accordion title="CHAIN_NOT_SUPPORTED">
**Descri√ß√£o**: Blockchain solicitada n√£o √© suportada

**Solu√ß√£o**: Use cadeias suportadas ou implemente uma alternativa

**Exemplo**:

```typescript
if (error.message === "CHAIN_NOT_SUPPORTED") {
  toast.error("Esta blockchain n√£o √© suportada. Por favor, escolha outra.");
  showSupportedChains();
}
```

</Accordion>
</AccordionGroup>

### Erros de Contrato

<AccordionGroup>
<Accordion title="CONTRACT_CALL_FAILED">
**Descri√ß√£o**: Execu√ß√£o do contrato inteligente falhou

**Solu√ß√£o**: Verifique os par√¢metros e o estado do contrato

**Exemplo**:

```typescript
if (error.message === "CONTRACT_CALL_FAILED") {
  toast.error("Intera√ß√£o com o contrato falhou. Por favor, verifique os par√¢metros.");
  logContractError(error);
}
```

</Accordion>

<Accordion title="INSUFFICIENT_GAS">
**Descri√ß√£o**: Limite de g√°s definido muito baixo para a transa√ß√£o

**Solu√ß√£o**: Aumente o limite de g√°s ou sugira otimiza√ß√£o de g√°s

**Exemplo**:

```typescript
if (error.message === "INSUFFICIENT_GAS") {
  toast.error("Transa√ß√£o requer mais g√°s. Aumentando limite de g√°s...");
  retryWithHigherGas();
}
```

</Accordion>

<Accordion title="NONCE_TOO_LOW">
**Descri√ß√£o**: Conflito de nonce da transa√ß√£o

**Solu√ß√£o**: Aguarde a conclus√£o das transa√ß√µes pendentes

**Exemplo**:

```typescript
if (error.message === "NONCE_TOO_LOW") {
  toast.info("Por favor, aguarde a conclus√£o das transa√ß√µes pendentes.");
  waitAndRetry();
}
```

</Accordion>

<Accordion title="TRANSACTION_REVERTED">
**Descri√ß√£o**: Contrato reverteu a transa√ß√£o

**Solu√ß√£o**: Verifique o estado e os par√¢metros do contrato

**Exemplo**:

```typescript
if (error.message === "TRANSACTION_REVERTED") {
  toast.error("Transa√ß√£o foi rejeitada pelo contrato. Por favor, verifique os requisitos.");
  showTransactionDetails();
}
```

</Accordion>
</AccordionGroup>

## üõ†Ô∏è Padr√µes de Tratamento de Erros

### Tratamento de Erros no N√≠vel do Componente

```tsx title="Componente de Pagamento com Tratamento de Erros" icon="shield-exclamation" lines
import { useAnyspendCreateOrder } from "@b3dotfun/sdk/anyspend";

function PaymentComponent() {
  const [error, setError] = useState<string | null>(null);
  const [retryCount, setRetryCount] = useState(0);

  const { createOrder, isCreatingOrder } = useAnyspendCreateOrder({
    onError: error => {
      console.error("Pagamento falhou:", error);

      // Tratar erros espec√≠ficos
      switch (error.message) {
        case "INSUFFICIENT_BALANCE":
          setError("Saldo insuficiente. Por favor, adicione fundos √† sua carteira.");
          break;

        case "SLIPPAGE":
          if (retryCount < 3) {
            setError("Pre√ßo movido desfavoravelmente. Tentando novamente...");
            setTimeout(() => {
              setRetryCount(prev => prev + 1);
              retryPayment();
            }, 2000);
          } else {
            setError("Pre√ßo muito vol√°til. Por favor, tente novamente mais tarde.");
          }
          break;

        case "NETWORK_ERROR":
          setError("Problema de rede. Por favor, verifique sua conex√£o e tente novamente.");
          break;

        case "QUOTE_EXPIRED":
          setError("Cota√ß√£o de pre√ßo expirada. Obtendo nova cota√ß√£o...");
          refreshQuote();
          break;

        default:
          setError("Pagamento falhou. Por favor, tente novamente ou contate o suporte.");
      }

      // Rastrear erros para monitoramento
      analytics.track("payment_error", {
        error: error.message,
        retryCount,
        timestamp: new Date().toISOString(),
      });
    },

    onSuccess: () => {
      setError(null);
      setRetryCount(0);
    },
  });

  return (
    <div className="payment-component">
      {error && (
        <div className="error-banner">
          <span className="error-icon">‚ö†Ô∏è</span>
          <span>{error}</span>
          <button onClick={() => setError(null)}>Dispensar</button>
        </div>
      )}

      <button onClick={handlePayment} disabled={isCreatingOrder}>
        {isCreatingOrder ? "Processando..." : "Pagar Agora"}
      </button>
    </div>
  );
}
```

### Monitoramento do Status do Pedido

```tsx title="Monitor de Status do Pedido" icon="eye" lines
import { useAnyspendOrderAndTransactions } from "@b3dotfun/sdk/anyspend";

function OrderStatusMonitor({ orderId }: { orderId: string }) {
  const { orderAndTransactions, getOrderAndTransactionsError } = useAnyspendOrderAndTransactions(orderId);

  if (getOrderAndTransactionsError) {
    return (
      <div className="error-state">
        <h3>Imposs√≠vel carregar status do pedido</h3>
        <p>Por favor, verifique sua conex√£o e tente novamente.</p>
        <button onClick={() => window.location.reload()}>Tentar Novamente</button>
      </div>
    );
  }

  if (!orderAndTransactions) {
    return <div>Carregando status do pedido...</div>;
  }

  const { order, depositTxs, executeTx, refundTxs } = orderAndTransactions.data;

  const renderStatusMessage = () => {
    switch (order.status) {
      case "scanning_deposit_transaction":
        return (
          <div className="status-pending">
            <div className="spinner" />
            <div>
              <h3>‚è≥ Aguardando confirma√ß√£o do pagamento</h3>
              <p>Isso geralmente leva 1-2 minutos. Por favor, n√£o feche esta janela.</p>
              {depositTxs.length > 0 && (
                <a
                  href={getExplorerUrl(depositTxs[0].txHash, depositTxs[0].chainId)}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Ver transa√ß√£o de pagamento
                </a>
              )}
            </div>
          </div>
        );

      case "relay":
        return (
          <div className="status-processing">
            <div className="spinner" />
            <div>
              <h3>üîÑ Processando transa√ß√£o cross-chain</h3>
              <p>Seu pagamento est√° sendo processado. Isso pode levar alguns minutos.</p>
            </div>
          </div>
        );

      case "executed":
        return (
          <div className="status-success">
            <div className="success-icon">‚úÖ</div>
            <div>
              <h3>Transa√ß√£o conclu√≠da com sucesso!</h3>
              <p>Seu pedido foi processado.</p>
              {executeTx && (
                <a href={getExplorerUrl(executeTx.txHash, executeTx.chainId)} target="_blank" rel="noopener noreferrer">
                  Ver transa√ß√£o
                </a>
              )}
            </div>
          </div>
        );

      case "failure":
      case "obtain_failed":
        return (
          <div className="status-error">
            <div className="error-icon">‚ùå</div>
            <div>
              <h3>Transa√ß√£o falhou</h3>
              <p>{order.errorDetails || "Ocorreu um erro ao processar seu pedido."}</p>
              <div className="error-actions">
                <button onClick={() => createNewOrder()}>Tentar Novamente</button>
                <button onClick={() => contactSupport(orderId)}>Contatar Suporte</button>
              </div>
            </div>
          </div>
        );

      case "refunded":
        return (
          <div className="status-refunded">
            <div className="refund-icon">‚Ü©Ô∏è</div>
            <div>
              <h3>Reembolso processado</h3>
              <p>Seu pagamento foi reembolsado automaticamente.</p>
              {refundTxs.length > 0 && (
                <a
                  href={getExplorerUrl(refundTxs[0].txHash, refundTxs[0].chainId)}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  Ver transa√ß√£o de reembolso
                </a>
              )}
            </div>
          </div>
        );

      case "expired":
        return (
          <div className="status-expired">
            <div className="expired-icon">‚è∞</div>
            <div>
              <h3>Pedido expirou</h3>
              <p>Este pedido expirou antes do recebimento do pagamento.</p>
              <button onClick={() => createNewOrder()}>Criar Novo Pedido</button>
            </div>
          </div>
        );

      default:
        return (
          <div className="status-unknown">
            <div className="spinner" />
            <div>
              <h3>Processando...</h3>
              <p>Status do pedido: {order.status}</p>
            </div>
          </div>
        );
    }
  };

  return (
    <div className="order-status-monitor">
      <div className="order-header">
        <h2>Pedido #{orderId.slice(0, 8)}</h2>
        <div className="order-meta">
          <span>Criado: {new Date(order.createdAt).toLocaleString()}</span>
          <span>Status: {order.status}</span>
        </div>
      </div>

      {renderStatusMessage()}

      {/* Informa√ß√µes de depura√ß√£o em desenvolvimento */}
      {process.env.NODE_ENV === "development" && (
        <details className="debug-info">
          <summary>Informa√ß√µes de Depura√ß√£o</summary>
          <pre>{JSON.stringify(order, null, 2)}</pre>
        </details>
      )}
    </div>
  );
}
```

### Limite Global de Erros

```tsx title="Componente de Limite de Erros" icon="shield" lines
import React, { Component, ErrorInfo } from "react";

interface Props {
  children: React.ReactNode;
  fallback?: React.ComponentType<{ error: Error; resetError: () => void }>;
}

interface State {
  hasError: boolean;
  error?: Error;
}

class AnySpendErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error("Limite de Erros AnySpend capturou um erro:", error, errorInfo);

    // Reportar para servi√ßo de rastreamento de erros
    if (typeof window !== "undefined") {
      // Exemplo: Sentry.captureException(error, { contexts: { errorInfo } });
    }
  }

  resetError = () => {
    this.setState({ hasError: false, error: undefined });
  };

  render() {
    if (this.state.hasError) {
      const FallbackComponent = this.props.fallback || DefaultErrorFallback;
      return <FallbackComponent error={this.state.error!} resetError={this.resetError} />;
    }

    return this.props.children;
  }
}

function DefaultErrorFallback({ error, resetError }: { error: Error; resetError: () => void }) {
  return (
    <div className="error-fallback">
      <h2>Algo deu errado</h2>
      <p>Um erro inesperado ocorreu no componente de pagamento
