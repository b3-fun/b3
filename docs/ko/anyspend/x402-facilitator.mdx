---
title: AnySpend Facilitator
description: x402 멀티 토큰 결제를 위한 프로덕션 등급 결제 프로세서
lang: ko
originalPath: anyspend/x402-facilitator.mdx
---
<CardGroup cols={2}>
<Card title="GitHub 저장소" icon="github" href="https://github.com/b3-fun/anyspend-x402">
  소스 코드, 예제 보기 및 기여하기
</Card>

<Card title="npm 패키지" icon="npm" href="https://www.npmjs.com/package/@b3dotfun/anyspend-x402">
  @b3dotfun/anyspend-x402 패키지 설치하기
</Card>
</CardGroup>

## 개요

AnySpend x402 Facilitator는 x402 프로토콜을 위한 멀티 토큰, 크로스 체인 결제를 지원하는 생산 등급 결제 인프라입니다. 토큰 스왑, 크로스 체인 브리징 및 결제의 모든 복잡성을 처리하여 개발자가 원하는 토큰으로 결제를 받을 수 있게 하면서 선호하는 화폐로 수령할 수 있습니다.

**생산 엔드포인트:** `https://mainnet.anyspend.com/x402`

## 주요 기능

### 멀티 토큰 결제 처리

EIP-2612(permit) 또는 EIP-3009(transferWithAuthorization)을 지원하는 모든 ERC-20 토큰으로 결제를 수락합니다:

- **스테이블코인**: USDC, DAI, USDT (지원되는 체인에서)
- **네이티브 토큰**: ETH, SOL, BNB, MATIC
- **커스텀 토큰**: permit 지원이 있는 모든 토큰, B3와 같은 프로젝트 토큰 포함
- **19+ 네트워크**: EVM 체인(Base, Ethereum, Arbitrum 등) 및 SVM(Solana) 지원

### 크로스 체인 라우팅

다른 블록체인 네트워크 간의 결제를 자동으로 처리합니다:

- **동일 체인 결제**: 최소한의 오버헤드로 직접 토큰 전송
- **크로스 체인 결제**: 네트워크 간 자동 브리징(예: ETH → Base)
- **크로스 VM 결제**: Solana ↔ EVM 전송을 위한 실험적 지원
- **최적 라우팅**: 최상의 실행을 위한 스마트 라우트 선택

### 자동 토큰 변환

지원되는 모든 토큰 간에 원활하게 변환합니다:

- **구매자 유연성**: 사용자는 보유한 토큰으로 결제
- **판매자 선호도**: 판매자는 선택한 결제 화폐를 수령
- **최상의 가격**: 최적의 DEX 유동성 소스를 통한 라우팅
- **미끄러짐 보호**: 가격 영향에 대한 자동 안전장치

### 가스 없는 결제

사용자는 가스 비용을 지불하지 않습니다:

- Facilitator가 모든 온체인 가스 비용을 부담
- 사용자는 EIP-712 메시지만 서명
- 가스를 위해 네이티브 토큰을 보유할 필요 없음
- 모든 체인에서 원활한 사용자 경험

## 표준 준수

### x402 프로토콜 준수

AnySpend Facilitator는 x402 사양의 전체를 구현합니다:

- ✅ **HTTP 네이티브 결제** via `402 Payment Required` 상태
- ✅ **표준 헤더** (`X-PAYMENT`, `X-PAYMENT-RESPONSE`, `X-PREFERRED-TOKEN`)
- ✅ **정확한 결제 방식** 수령인 및 금액 검증 포함
- ✅ **서명 기반 권한 부여** (EIP-712, EIP-2612, EIP-3009)
- ✅ **암호화 검증** 신뢰할 수 있는 제3자 없이

### 드롭인 대체

어떤 x402 구현과도 완전히 호환됩니다:

- **클라이언트 호환성**: 어떤 x402 호환 클라이언트와도 작동
- **서버 호환성**: 어떤 x402 미들웨어와도 사용 가능
- **벤더 종속성 없음**: 표준 HTTP API, 언제든지 facilitator 전환 가능
- **상호 운용성**: Coinbase CDP x402, PayAI 등과 통합

## 아키텍처

### 결제 흐름

```
┌──────────────┐
│    클라이언트    │  결제 승인 서명
│  (모든 토큰) │  preferredToken: DAI
└──────┬───────┘
       │
       │ X-PAYMENT 헤더
       ▼
┌──────────────────────────┐
│   리소스 서버        │
│   (당신의 API)             │
│                          │
│  AnySpend 미들웨어     │
│  • 요청 가로채기    │
│  • 견적 얻기            │
│  • 402 반환           │
└──────┬───────────────────┘
       │
       │ /verify, /settle
       ▼
┌──────────────────────────┐
│  AnySpend Facilitator    │
│  mainnet.anyspend.com    │
│                          │
│  • 서명 유효성 검사   │
│  • 토큰 스왑 실행   │
│  • 판매자에게 결제     │
└──────┬───────────────────┘
       │
       │ 온체인 txs
       ▼
┌──────────────────────────┐
│      블록체인          │
│  • 결제 수령       │
│  • 필요시 토큰 스왑 │
│  • 판매자에게 결제    │
└──────────────────────────┘
```

### 인프라 구성 요소

**API 레이어**
- 결제 검증 및 결제를 위한 RESTful HTTP API
- 실시간 결제 상태 업데이트를 위한 WebSocket 지원
- 속도 제한 및 DDoS 보호
- 99.9% 가동 시간 SLA

**스왑 엔진**
- 여러 DEX에서 유동성 집계
- 최상의 실행 가격을 위한 최적 라우팅
- 미끄러짐 보호 및 MEV 저항
- 크로스 체인 브리징 통합

**결제 시스템**
- 병렬 트랜잭션 처리
- 자동 nonce 관리
- 실패한 트랜잭션 복구
- 실시간 결제 확인

**보안**
- EIP-712 서명 검증
- 재생 공격 방지 (nonce 추적)
- 마감 시간 집행
- 스마트 계약 감사

## API 엔드포인트

### POST /verify

온체인 실행 없이 결제 서명을 유효성 검사합니다.

**목적:**
- 빠른 유효성 검사 (100ms 미만)
- 서명 진위성 확인
- 마감 시간이 만료되지 않았는지 확인
- 가스 비용 없음

**요청:**
```json
{
  "x402Version": "0.2",
  "paymentHeader": "base64_encoded_payment",
  "paymentRequirements": {
    "scheme": "exact",
    "network": "base-mainnet",
    "amount": "1000000",
    "asset": "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",
    "recipient": "0xMerchantAddress..."
  }
}
```

**응답:**
```json
{
  "valid": true
}
```

---

### POST /settle

온체인 결제를 실행하고 트랜잭션 증명을 반환합니다.

**목적:**
- 결제 승인 실행
- 필요한 경우 토큰 스왑 (구매자 토큰 → 판매자 토큰)
- 리소스 서버에 결제
- 검증을 위한 트랜잭션 해시 반환

**요청:**
```json
{
  "x402Version": "0.2",
  "paymentHeader": "base64_encoded_payment",
  "paymentRequirements": { /* ... */ }
}
```

**응답:**
```json
{
  "txHash": "0xabc123...",
  "network": "base-mainnet",
  "metadata": {
    "receiptTxHash": "0x...",
    "swapTxHash": "0x...",
    "settlementTxHash": "0x..."
  }
}
```

---

### POST /quote

멀티 토큰 결제를 위한 토큰 변환율을 가져옵니다.

**목적:**
- 결제를 위한 정확한 토큰 양 계산
- 현재 환율 얻기
- 스왑 실행 시간 추정

**요청:**
```json
{
  "usdcAmount": "1000000",        // 목표 금액 (1 USDC)
  "paymentToken": "0x50c5...",    // DAI 주소
  "network": "base-mainnet"
}
```

**응답:**
```json
{
  "tokenAmount": "1000000000000000000",  // 1.0 DAI 필요
  "exchangeRate": "1.0",
  "deadline": 1730000000,
  "route": {
    "srcToken": "0x50c5...",
    "dstToken": "0x8335...",
    "path": ["DAI", "USDC"]
  }
}
```

---

### GET /supported

지원되는 결제 방식과 네트워크를 나열합니다.

**응답:**
```json
{
  "schemes": [{
    "scheme": "exact",
    "networks": [
      "base",
      "ethereum",
      "arbitrum",
      "optimism",
      "polygon",
      "bsc",
      "avalanche",
      "solana"
    ]
  }]
}
```

## 통합

### 서버 측 (Express)

```typescript
import { paymentMiddleware, facilitator } from '@b3dotfun/anyspend-x402';

const endpointConfig = {
  '/api/premium': {
    amount: '1.00',
    asset: 'USD'
  }
};

app.use(paymentMiddleware(
  '0xYourAddress...',
  endpointConfig,
  facilitator  // mainnet.anyspend.com/x402로 사전 구성됨
));
```

### 서버 측 (사용자 정의)

```typescript
import { X402Facilitator } from '@b3dotfun/anyspend-x402';

const facilitator = new X402Facilitator({
  url: 'https://mainnet.anyspend.com/x402',
  apiKey: process.env.ANYSPEND_API_KEY  // 선택사항
});

// 결제 검증
const { valid } = await facilitator.verify(paymentHeader, requirements);

// 결제 처리
const { txHash } = await facilitator.settle(paymentHeader, requirements);
```

### 클라이언트 측

```typescript
import { X402Client } from 'anyspend-x402-client';

const client = new X402Client({
  walletClient,
  facilitatorUrl: 'https://mainnet.anyspend.com/x402'  // 선택사항, 기본적으로 이것을 사용함
});

const response = await client.request('https://api.example.com/premium');
```

## 보안

### 서명 검증

모든 결제는 EIP-712 타입 데이터 서명을 사용하여 검증됩니다:

- **USDC**: EIP-3009 `transferWithAuthorization`
- **기타 토큰**: EIP-2612 `permit`

온체인 실행 전에 서명이 유효성 검사됩니다.

### 재생 방지

**랜덤 Nonce (USDC):**
- 각 서명에는 고유한 bytes32 nonce 포함
- Nonce는 주소당 한 번만 사용 가능
- 순서 의존성 없음

**순차 Nonce (Permit):**
- 토큰 계약은 nonce 카운터를 유지
- 허가 실행마다 자동 증가
- 순서가 뒤바뀌는 실행 방지

### 마감 시간 집행

모든 서명에는 만료 타임스탬프 포함:
- 기본값: 서명 시간으로부터 5분
- 오래된 결제 승인 방지
- 만료된 서명 자동 거부

### 개인 키 접근 없음

facilitator는 **절대** 사용자 개인 키에 접근하지 않습니다:
- 사용자가 클라이언트 측에서 메시지 서명
- 서명만 전송됨
- 비보관 아키텍처

## 성능

### 속도

- **검증**: 서명 검증에 100ms 미만
- **동일 체인 결제**: 평균 2-10초
- **크로스 체인 결제**: 2-5분 (브리징에 따라 다름)
- **견적 생성**: 200ms 미만

### 확장성

- 1000+ 동시 결제 처리
- 고처리량을 위한 수평 확장
- 병렬 트랜잭션 처리
- 여러 노드에 걸친 부하 분산

### 신뢰성

- 99.9% 가동 시간 보장
- 자동 장애 조치 및 중복성
- 실패한 트랜잭션 재시도 로직
- 24/7 모니터링 및 알림

## 네트워크 지원

### EVM 메인넷 네트워크 (12)

Abstract, Arbitrum, Avalanche, B3, Base, BNB Chain, Ethereum, IoTeX, Optimism, Peaq, Polygon, Sei

### EVM 테스트넷 (5)

Abstract Testnet, Avalanche Fuji, Base Sepolia, Polygon Amoy, Sei Testnet

### SVM 네트워크 (2)

Solana Mainnet, Solana Devnet

전체 세부 정보는 [Network Support](/anyspend/x402-network-support)를 참조하세요.

## AnySpend Facilitator를 선택해야 하는 이유?

<CardGroup cols={2}>
<Card title="표준 준수" icon="check-circle">
  완전한 x402 프로토콜 준수 - 모든 호환 가능한 클라이언트 또는 서버와 작동
</Card>

<Card title="생산 준비" icon="rocket">
  기업급 신뢰성 및 성능을 갖춘 전투 검증된 인프라
</Card>

<Card title="멀티 체인" icon="globe">
  자동 크로스 체인 라우팅을 포함한 19+ 블록체인 네트워크 지원
</Card>

<Card title="개발자 친화적" icon="code">
  Express, Next.js, Hono 및 클라이언트 측 TypeScript를 위한 간단한 API 및 SDK
</Card>
</CardGroup>

## 시작하기

<CardGroup cols={2}>
<Card title="판매자를 위한 퀵스타트" icon="money-bill" href="/anyspend/x
