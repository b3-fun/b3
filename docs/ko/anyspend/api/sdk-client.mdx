---
title: TypeScript SDK 클라이언트
description: AnySpend 플랫폼 API를 위한 Headless TypeScript 클라이언트
lang: ko
originalPath: anyspend/api/sdk-client.mdx
---
AnySpend 플랫폼 SDK 클라이언트는 **헤드리스**(React 의존성 없음) TypeScript 클라이언트로, AnySpend 플랫폼 API 전체를 지원합니다. 이 클라이언트는 Node.js, 브라우저, Cloudflare Workers, Deno, Bun 등 현대 JavaScript가 실행되는 모든 곳에서 작동합니다.

## 설치

<CodeGroup>

```bash npm
npm install @b3dotfun/sdk
```

```bash pnpm
pnpm add @b3dotfun/sdk
```

```bash yarn
yarn add @b3dotfun/sdk
```

</CodeGroup>

## 빠른 시작

```typescript
import { AnySpendPlatformClient } from "@b3dotfun/sdk/anyspend/platform";

const platform = new AnySpendPlatformClient(process.env.ANYSPEND_API_KEY!);

// 결제 링크 생성
const link = await platform.paymentLinks.create({
  name: "Pro Plan - Monthly",
  amount: "29990000",  // 29.99 USDC
  recipient_address: "0xYourAddress",
});

console.log(link.url);
```

## 초기화

```typescript
import { AnySpendPlatformClient } from "@b3dotfun/sdk/anyspend/platform";

const platform = new AnySpendPlatformClient(process.env.ANYSPEND_API_KEY!, {
  // 아래 옵션들은 모두 선택사항
  baseUrl: "https://platform-api.anyspend.com/api/v1", // 기본값
  timeout: 30_000,           // 요청 타임아웃(ms 단위, 기본값: 30s)
  maxRetries: 3,             // 5xx/네트워크 오류에 대한 자동 재시도 횟수
  idempotencyKeyGenerator: () => crypto.randomUUID(), // 사용자 정의 생성기
});
```

<Info>
  API 키는 [AnySpend 대시보드](https://app.anyspend.com)의 **설정 > API 키**에서 얻을 수 있습니다. 키는 조직에 할당되며 읽기 전용 또는 읽기-쓰기 권한을 가질 수 있습니다.
</Info>

## 사용 가능한 리소스

클라이언트는 REST 엔드포인트에 직접 매핑되는 메서드를 가진 리소스 네임스페이스로 구성됩니다.

<AccordionGroup>
  <Accordion title="paymentLinks">
    ```typescript
    // CRUD
    platform.paymentLinks.create(data)
    platform.paymentLinks.list(params?)
    platform.paymentLinks.get(id)
    platform.paymentLinks.update(id, data)
    platform.paymentLinks.delete(id)

    // 액션
    platform.paymentLinks.duplicate(id)
    platform.paymentLinks.stats(id)
    platform.paymentLinks.sessions(id, params?)
    platform.paymentLinks.visitors(id, params?)

    // 라인 아이템
    platform.paymentLinks.items(id)
    platform.paymentLinks.addItem(id, itemData)
    platform.paymentLinks.removeItem(id, itemId)
    ```
  </Accordion>

  <Accordion title="products">
    ```typescript
    platform.products.create(data)
    platform.products.list(params?)
    platform.products.get(id)
    platform.products.update(id, data)
    platform.products.delete(id)
    platform.products.generateLink(id, linkOptions?)
    ```
  </Accordion>

  <Accordion title="customers">
    ```typescript
    platform.customers.create(data)
    platform.customers.list(params?)
    platform.customers.get(id)
    platform.customers.update(id, data)
    platform.customers.delete(id)
    platform.customers.transactions(id, params?)
    platform.customers.export(params?)
    ```
  </Accordion>

  <Accordion title="transactions">
    ```typescript
    platform.transactions.list(params?)
    platform.transactions.get(id)
    platform.transactions.stats(params?)
    platform.transactions.export(params?)
    ```
  </Accordion>

  <Accordion title="checkoutSessions">
    ```typescript
    platform.checkoutSessions.create(data)
    platform.checkoutSessions.list(params?)
    platform.checkoutSessions.get(id)
    platform.checkoutSessions.expire(id)
    ```
  </Accordion>

  <Accordion title="webhooks">
    ```typescript
    platform.webhooks.create(data)
    platform.webhooks.list(params?)
    platform.webhooks.get(id)
    platform.webhooks.update(id, data)
    platform.webhooks.delete(id)
    platform.webhooks.test(id)
    platform.webhooks.deliveries(id, params?)
    platform.webhooks.retry(id, deliveryId)
    ```
  </Accordion>

  <Accordion title="discountCodes">
    ```typescript
    platform.discountCodes.create(data)
    platform.discountCodes.list(params?)
    platform.discountCodes.update(id, data)
    platform.discountCodes.delete(id)
    platform.discountCodes.validate(code, context?)
    platform.discountCodes.batchCreate(codes)
    ```
  </Accordion>

  <Accordion title="notifications">
    ```typescript
    platform.notifications.get()
    platform.notifications.update(data)
    platform.notifications.linkTelegram(chatId)
    platform.notifications.unlinkTelegram()
    platform.notifications.testEmail()
    platform.notifications.testTelegram()
    ```
  </Accordion>

  <Accordion title="widgets">
    ```typescript
    platform.widgets.create(data)
    platform.widgets.list(params?)
    platform.widgets.get(id)
    platform.widgets.update(id, data)
    platform.widgets.delete(id)
    platform.widgets.stats(id)
    ```
  </Accordion>

  <Accordion title="organization">
    ```typescript
    platform.organization.get()
    platform.organization.update(data)
    ```
  </Accordion>

  <Accordion title="analytics">
    ```typescript
    platform.analytics.overview(params?)
    ```
  </Accordion>

  <Accordion title="events">
    ```typescript
    platform.events.list(params?)
    ```
  </Accordion>
</AccordionGroup>

## 페이지네이션

모든 `list` 메서드는 선택적 페이지네이션 매개변수를 받아들이며 페이지네이션된 응답을 반환합니다:

```typescript
const page = await platform.transactions.list({
  status: "completed",
  limit: 25,
  cursor: "cur_abc123",
});

console.log(page.data);       // Transaction[]
console.log(page.has_more);   // boolean
console.log(page.next_cursor); // string | null
```

### 자동 페이지네이션

편의를 위해 모든 `list` 메서드는 항목을 소비함에 따라 내부적으로 페이지를 가져오는 비동기 반복자를 반환하는 `listAutoPaginate` 헬퍼를 가집니다.

```typescript
for await (const txn of platform.transactions.listAutoPaginate({
  status: "completed",
})) {
  console.log(txn.id, txn.amount);
}
```

<Tip>
  자동 페이지네이션은 자동으로 요율 제한을 존중합니다. API가 `429`를 반환하면 반복자는 `Retry-After` 기간 동안 기다린 후 다음 페이지를 가져옵니다.
</Tip>

또한 모든 결과를 배열로 수집할 수 있습니다:

```typescript
const allCustomers = [];
for await (const c of platform.customers.listAutoPaginate()) {
  allCustomers.push(c);
}
```

## 오류 처리

SDK는 특정 실패 모드를 처리할 수 있도록 타입화된 오류 클래스를 던집니다:

```typescript
import {
  ApiError,
  AuthenticationError,
  PermissionError,
  RateLimitError,
  NotFoundError,
  IdempotencyError,
} from "@b3dotfun/sdk/anyspend/platform";

try {
  const link = await platform.paymentLinks.get("pl_nonexistent");
} catch (err) {
  if (err instanceof NotFoundError) {
    console.log("링크가 존재하지 않습니다");
  } else if (err instanceof AuthenticationError) {
    console.log("잘못되었거나 만료된 API 키");
  } else if (err instanceof PermissionError) {
    console.log("API 키에 필요한 권한이 없습니다");
  } else if (err instanceof RateLimitError) {
    console.log(`요율 제한됨. ${err.retryAfter}초 후에 다시 시도하세요`);
  } else if (err instanceof IdempotencyError) {
    console.log("Idempotency 충돌 -- 요청이 다른 매개변수로 이미 처리되었습니다");
  } else if (err instanceof ApiError) {
    // API 오류에 대한 포괄적인 캐치
    console.log(err.status, err.code, err.message);
  }
}
```

### 오류 클래스 참조

| 클래스 | HTTP 상태 | 설명 |
|-------|-------------|-------------|
| `AuthenticationError` | `401` | 누락되었거나 잘못되었거나 만료된 API 키 |
| `PermissionError` | `403` | API 키가 필요한 범위를 가지고 있지 않음 |
| `NotFoundError` | `404` | 리소스가 존재하지 않음 |
| `RateLimitError` | `429` | 요청이 너무 많음. `retryAfter` (초) 포함 |
| `IdempotencyError` | `409` | Idempotency 키가 다른 매개변수로 재사용됨 |
| `ApiError` | 어떤 경우 | 모든 API 오류의 기본 클래스 |

## 자동 재시도

클라이언트는 다음 경우에 실패한 요청을 자동으로 재시도합니다:

- **5xx 서버 오류** -- 서버에 일시적인 실패가 있었습니다
- **네트워크 오류** -- 연결 재설정, DNS 실패, 타임아웃
- **429 요율 제한 응답** -- `Retry-After` 기간 동안 기다립니다

재시도는 **지수 백오프**와 지터를 사용합니다. 기본값은 3번의 재시도이며, `maxRetries` 옵션을 통해 구성할 수 있습니다.

```typescript
const platform = new AnySpendPlatformClient("asp_key", {
  maxRetries: 5, // 최대 5번 재시도
});
```

<Warning>
  `429`를 제외한 `4xx` 오류의 경우 재시도가 **실행되지 않습니다**. 이러한 오류는 클라이언트 측 문제를 나타내며 재시도해도 해결되지 않습니다.
</Warning>

## Idempotency

모든 `POST` 및 `PATCH` 요청은 자동으로 `Idempotency-Key` 헤더를 포함합니다. 이는 요청이 재시도될 경우(예: 네트워크 오류로 인해) 서버가 이를 두 번 처리하지 않도록 보장합니다.

기본 생성기는 `crypto.randomUUID()`을 사용합니다. 자신만의 생성기를 제공할 수 있습니다:

```typescript
const platform = new AnySpendPlatformClient("asp_key", {
  idempotencyKeyGenerator: () => `my-app-${Date.now()}-${Math.random()}`,
});
```

요청별로 특정 idempotency 키를 전달할 수도 있습니다:

```typescript
const link = await platform.paymentLinks.create(
  { name: "Order #1234", amount: "50000000", recipient_address: "0x..." },
  { idempotencyKey: "order-1234-link" }
);
```

<Tip>
  결정적인 idempotency 키(예: 주문 ID) 사용이 중요한 작업에 권장됩니다. 같은 요청을 실수로 두 번 보내면 두 번째 호출은 중복을 생성하는 대신 원래 응답을 반환합니다.
</Tip>

## TypeScript 타입

요청 및 응답 타입은 모두 사용자 코드에서 사용할 수 있도록 내보내집니다:

```typescript
import type {
  PaymentLink,
  CreatePaymentLinkRequest,
  Transaction,
  Customer,
  CheckoutSession,
  Webhook,
  PaginatedResponse,
} from "@b3dotfun/sdk/anyspend/platform";
```

## 런타임 호환성

| 런타임 | 지원 여부 |
|---------|-----------|
| Node.js 18+ | 예 |
| 브라우저 (ES2020+) | 예 |
| Cloudflare Workers | 예 |
| Deno | 예 |
| Bun | 예 |

클라이언트는 내부적으로 표준 `fetch` API를 사용합니다. Node.js 18+에서는 내장된 `fetch`가 사용됩니다. 폴리필이 필요하지 않습니다.
