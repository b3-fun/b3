---
title: Panduan Cepat untuk Pembeli
description: >-
  Bayar untuk API dan layanan berbayar menggunakan token apa pun dengan AnySpend
  x402 Client SDK
lang: id
originalPath: anyspend/x402-quickstart-buyers.mdx
---
## Ikhtisar

Panduan ini menunjukkan cara menggunakan **AnySpend x402 Client SDK** untuk membayar sumber daya berbayar menggunakan token yang kompatibel dengan dukungan EIP-2612 atau EIP-3009. SDK menangani seluruh alur pembayaran secara otomatis, termasuk generasi tanda tangan dan logika pengulangan.

Anda dapat menggunakan klien yang sama untuk membayar layanan apa pun yang diaktifkan x402, tidak hanya yang menggunakan AnySpend.

<Card title="Token Compatibility Checker" icon="check-circle" href="https://anyspend.com/x402-tokens">
  Telusuri token yang kompatibel dengan dukungan EIP-2612 atau EIP-3009 di lebih dari 19 jaringan
</Card>

## Prasyarat

Sebelum Anda mulai, pastikan Anda memiliki:

- **Node.js 18+** atau runtime JavaScript yang kompatibel
- **Dompet kripto** dengan token yang kompatibel (USDC, DAI, atau token EIP-2612/EIP-3009 lainnya)
- **Perpustakaan dompet** seperti [viem](https://viem.sh) atau [ethers.js](https://docs.ethers.org)
- **Akses ke layanan yang diaktifkan x402** (seperti API berbayar)

<Note>
**Penting**: Hanya token dengan dukungan EIP-2612 (Permit) atau EIP-3009 (TransferWithAuthorization) yang kompatibel dengan AnySpend x402 untuk pembayaran tanpa gas. Gunakan [Token Compatibility Checker](https://anyspend.com/x402-tokens) untuk memverifikasi token Anda didukung.
</Note>

## Instalasi

Instal x402 client SDK:

<CodeGroup>
```bash npm
npm install anyspend-x402-client viem
```

```bash yarn
yarn add anyspend-x402-client viem
```

```bash pnpm
pnpm add anyspend-x402-client viem
```
</CodeGroup>

SDK menggunakan [viem](https://viem.sh) untuk operasi dompet dan generasi tanda tangan.

## Penggunaan Dasar

### 1. Buat klien dompet

Pertama, siapkan klien dompet Anda menggunakan viem:

```typescript
import { createWalletClient, custom } from 'viem';
import { base } from 'viem/chains';

// Untuk browser dengan MetaMask atau ekstensi dompet lainnya
const walletClient = createWalletClient({
  chain: base,
  transport: custom(window.ethereum)
});

// Dapatkan alamat pengguna
const [address] = await walletClient.getAddresses();
```

### 2. Inisialisasi klien x402

Buat instance dari klien x402:

```typescript
import { X402Client } from 'anyspend-x402-client';

const x402Client = new X402Client({
  walletClient,           // Klien dompet viem Anda
  preferredToken: '0x...', // Opsional: token default untuk pembayaran
  autoRetry: true          // Otomatis menangani respons 402 (default: true)
});
```

### 3. Lakukan permintaan berbayar

Gunakan klien untuk mengakses sumber daya berbayar:

```typescript
try {
  const response = await x402Client.request(
    'https://api.example.com/premium-data',
    {
      method: 'GET',
    }
  );

  console.log('Data:', response.data);
  console.log('Pembayaran TX:', response.paymentResponse?.txHash);
} catch (error) {
  console.error('Pembayaran gagal:', error);
}
```

**Apa yang terjadi:**

1. Klien membuat permintaan awal
2. API mengembalikan `402 Payment Required` dengan detail pembayaran
3. X402Client secara otomatis menandatangani otorisasi pembayaran
4. Klien mencoba permintaan lagi dengan pembayaran
5. API memverifikasi dan menyelesaikan pembayaran
6. Klien menerima data yang diminta

## Penggunaan Lanjutan

### Tentukan token pembayaran

Ada dua cara untuk menentukan token yang ingin Anda bayarkan:

#### Opsi 1: menggunakan X402Client

Bayar dengan token tertentu dengan mengatur `preferredToken`:

```typescript
const response = await x402Client.request(
  'https://ai-agent-api.com/inference',
  {
    method: 'POST',
    body: { prompt: 'Generate an image of a cat' },
    preferredToken: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' // USDC di Base
  }
);
```

#### Opsi 2: menggunakan wrapFetchWithPayment (lanjutan)

Untuk kontrol lebih, gunakan fungsi `wrapFetchWithPayment` yang lebih rendah:

```typescript
import { wrapFetchWithPayment } from 'anyspend-x402-client';

const tokenAddress = '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'; // USDC di Base
const selectedChain = 8453; // Base

const paymentPreferences = {
  preferredToken: tokenAddress,
  preferredNetwork: 'base' as const, // atau gunakan getNetworkName(selectedChain)
};

// Bungkus fetch dengan penanganan pembayaran otomatis
const fetchWithPayment = wrapFetchWithPayment(
  fetch,
  walletClient,
  '1000000', // Nilai pembayaran maksimal (1 USDC dalam 6 desimal)
  undefined, // Gunakan pemilih persyaratan pembayaran default
  undefined, // Gunakan konfigurasi default
  paymentPreferences, // Tentukan token dan jaringan yang diinginkan
);

// Gunakan fetch yang dibungkus seperti fetch normal
const response = await fetchWithPayment('https://api.example.com/premium-data');
const data = await response.json();
```

**Manfaat dari `wrapFetchWithPayment`:**
- Bekerja dengan kode berbasis `fetch` yang ada
- Kontrol lebih granular atas perilaku pembayaran
- Dapat menentukan nilai pembayaran maksimal
- Pemilih persyaratan pembayaran kustom
- Mendukung penandatangan multi-jaringan

Jika server sumber daya mendukung middleware AnySpend, Anda akan membayar jumlah yang setara dalam token yang diinginkan Anda bukan USDC.

### Menggunakan header HTTP untuk preferensi pembayaran

<Note>
**Baru di X402**: Anda sekarang dapat menentukan preferensi pembayaran menggunakan header HTTP, yang sangat berguna saat melakukan permintaan HTTP langsung atau saat mengintegrasikan dengan klien HTTP yang ada.
</Note>

Saat membuat permintaan ke layanan yang diaktifkan X402, Anda dapat menentukan token pembayaran dan jaringan yang diinginkan Anda menggunakan header HTTP ini:

```bash
curl -X GET https://api.example.com/premium-data \
  -H "X-PREFERRED-TOKEN: 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913" \
  -H "X-PREFERRED-NETWORK: base-mainnet"
```

**Alamat Token Umum:**
- **USDC di Base**: `0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913`
- **USDT di Base**: `0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2`

**Pengenal Jaringan:**
- `base-mainnet` - Base Mainnet
- `ethereum-mainnet` - Ethereum Mainnet
- `arbitrum-mainnet` - Arbitrum One
- `optimism-mainnet` - Optimism Mainnet
- `polygon-mainnet` - Polygon PoS

Header ini bekerja dengan klien HTTP apa pun dan secara otomatis dihormati oleh server sumber daya yang diaktifkan X402 menggunakan middleware AnySpend. Jika tidak ada header yang disediakan, server akan default ke USDC.

#### Menggunakan header dengan X402Client

X402Client secara otomatis menambahkan header ini berdasarkan konfigurasi Anda:

```typescript
const x402Client = new X402Client({
  walletClient,
  preferredToken: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // USDC
  network: 'base-mainnet'
});

// Header secara otomatis ditambahkan ke semua permintaan
const response = await x402Client.request('https://api.example.com/data');
```

#### Menggunakan header dengan fetch

Anda juga dapat menambahkan header ini secara manual saat menggunakan API `fetch` asli atau klien HTTP lainnya:

```typescript
const response = await fetch('https://api.example.com/premium-data', {
  headers: {
    'X-PREFERRED-TOKEN': '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
    'X-PREFERRED-NETWORK': 'base-mainnet'
  }
});

// Kemudian tangani respons 402 jika diperlukan
if (response.status === 402) {
  // Proses pembayaran menggunakan X402Client atau wrapFetchWithPayment
}
```

### Permintaan POST dengan body

Lakukan permintaan POST berbayar:

```typescript
const response = await x402Client.request(
  'https://api.example.com/compute',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: {
      model: 'gpt-4',
      messages: [{ role: 'user', content: 'Hello!' }]
    }
  }
);
```

### Alur pembayaran manual

Untuk kontrol lebih, tangani alur pembayaran secara manual:

```typescript
// 1. Lakukan permintaan awal
const initialResponse = await fetch('https://api.example.com/premium-data');

if (initialResponse.status === 402) {
  // 2. Parse persyaratan pembayaran
  const paymentRequired = await initialResponse.json();
  const requirements = paymentRequired.requirements[0];

  console.log('Pembayaran diperlukan:', {
    amount: requirements.amount,
    token: requirements.asset,
    recipient: requirements.recipient
  });

  // 3. Tandatangani otorisasi pembayaran
  const paymentHeader = await x402Client.signPayment(requirements);

  // 4. Coba lagi dengan pembayaran
  const paidResponse = await fetch('https://api.example.com/premium-data', {
    headers: {
      'X-PAYMENT': paymentHeader
    }
  });

  const data = await paidResponse.json();
  const paymentResponse = paidResponse.headers.get('X-PAYMENT-RESPONSE');

  console.log('Pembayaran berhasil!', JSON.parse(atob(paymentResponse)));
}
```

## Opsi Konfigurasi

### X402ClientOptions

```typescript
interface X402ClientOptions {
  walletClient: WalletClient;        // klien dompet viem (diperlukan)
  network?: string;                   // Jaringan default (mis., 'base-mainnet')
  preferredToken?: string;            // Alamat token pembayaran yang diinginkan
  autoRetry?: boolean;                // Otomatis mengulangi pada 402 (default: true)
  timeout?: number;                   // Batas waktu permintaan dalam ms (default: 30000)
}
```

### Opsi Permintaan

```typescript
interface RequestOptions {
  method?: 'GET' | 'POST' | 'PUT' | 'DELETE';
  headers?: Record<string, string>;
  body?: any;                         // Isi permintaan (otomatis diserialisasi ke JSON)
  preferredToken?: string;            // Timpa token yang diinginkan default
}
```

### Parameter wrapFetchWithPayment

Untuk kasus penggunaan lanjutan, `wrapFetchWithPayment` memberikan kontrol tingkat rendah:

```typescript
function wrapFetchWithPayment(
  fetchFn: typeof fetch,              // Fungsi fetch untuk dibungkus
  signer: Signer | MultiNetworkSigner, // Klien dompet untuk penandatanganan
  maxPaymentValue: string,             // Pembayaran maksimal dalam unit terkecil (mis., '1000000' untuk 1 USDC)
  selectPaymentRequirements?: Function, // Pemilih persyaratan kustom
  config?: {
    timeout?: number;                  // Batas waktu permintaan dalam ms
    maxRetries?: number;               // Maksimal percobaan pembayaran ulang
  },
  paymentPreferences?: {
    preferredToken?: string;           // Alamat token untuk pembayaran
    preferredNetwork?: string;         // Pengenal jaringan (mis., 'base', 'ethereum')
  }
): typeof fetch
```

**Contoh dengan semua parameter:**

```typescript
import { wrapFetchWithPayment } from 'anyspend-x402-client';

const fetchWithPayment = wrapFetchWithPayment(
  fetch,
  walletClient,
  '5000000', // Maks 5 USDC
  undefined, // Pemilih persyaratan default
  {
    timeout: 60000,    // Batas waktu 60 detik
    maxRetries: 3      // Coba ulang hingga 3 kali
  },
  {
    preferredToken: '0x50c5725949A6F0c72E6C4a641F24049A917DB0Cb', // DAI
    preferredNetwork: 'base'
  }
);
```

## Token yang Didukung

**Hanya token dengan dukungan EIP-2612 atau EIP-3009 yang kompatibel** dengan AnySpend x402 untuk pembayaran tanpa gas.

### Apa itu EIP-2612 dan EIP-3009?

- **EIP-2612 (Permit)**: Memungkinkan persetujuan token tanpa gas melalui tanda tangan off-chain
- **EIP-3009 (TransferWithAuthorization)**: Memungkinkan transfer tanpa gas melalui tanda tangan off-chain (digunakan oleh USDC)


### Token yang Kompatibel Umum

- **USDC** - Dukungan EIP-3009 di semua jaringan
- **B3** - Dukungan permit EIP-2612
- **Banyak token lainnya** - Periksa kompatibilitas menggunakan alat di bawah ini

<Card title="Token Compatibility Checker" icon="check-circle" href="https://anyspend.com/x402-tokens">
  Telusuri semua token yang kompatibel dengan dukungan EIP-2612 atau EIP-3009 di lebih dari 19 jaringan
</Card>

Lihat [Dukungan Jaringan](/anyspend/x402-network-support) untuk alamat token terperinci per jaringan.

## Contoh

### Komponen React (menggunakan X402Client)

```tsx
import { X402Client } from 'anyspend-x402-client';
import { useWalletClient } from 'wagmi';
import { useState } from 'react';

export function PremiumDataFetcher() {
  const { data: walletClient } = useWalletClient();
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);

  const fetchPremiumData = async () => {
    if (!walletClient) return;

    setLoading(true);
    try {
      const client = new X402Client({
        walletClient,
        preferredToken: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' // USDC di Base
      });

      const response = await client.request(
        'https://api.example.com/premium-data'
      );

      setData(response.data);
      console.log('Dibayar dengan TX:', response.paymentResponse?.txHash);
    } catch (error) {
      console.error('Pembayaran gagal:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <button onClick={fetchPremiumData} disabled={loading}>
        {loading ? 'Membayar...' : 'Dapatkan Data Premium (Biaya 1 USDC)'}
      </button>
      {data && <pre>{JSON.stringify(data, null, 2)}</pre>}
    </div>
  );
}
```

### Komponen React (menggunakan wrapFetchWithPayment)

Untuk aplikasi yang memerlukan kontrol lebih atau menggunakan kode berbasis fetch yang ada:

```tsx
import { wrapFetchWithPayment } from 'anyspend-x402-client';
import { useWalletClient, useChainId } from 'wagmi';
import { useState } from 'react';

// Pembantu untuk mendapatkan nama jaringan dari ID rantai
const getNetworkName = (chainId: number): string => {
  const networks: Record<number, string> = {
    8453: 'base',
    1: 'ethereum',
    42161: 'arbitrum',
    10: 'optimism',
    137: 'polygon',
  };
  return networks[chainId] || 'base';
};

export function PremiumDataFetcherAdvanced() {
  const { data: walletClient } = useWalletClient();
  const selectedChain = useChainId();
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [log, setLog] = useState<string[]>([]);

  // Alamat token berdasarkan rantai
  const tokenAddresses: Record<number, string> = {
    8453: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913', // USDC di Base
    1: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', // USDC di Ethereum
  };

  const fetchPremiumData = async () => {
    if (!walletClient) return;

    setLoading(true);
    setLog([]);

    try {
      const tokenAddress = tokenAddresses[selectedChain];

      const paymentPreferences = {
        preferredToken: tokenAddress,
        preferredNetwork: getNetworkName(selectedChain) as any,
      };

