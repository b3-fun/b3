---
title: Webhooks
description: Konfigurasikan endpoint webhook untuk notifikasi event secara real-time
lang: id
originalPath: anyspend/api/webhooks-api.mdx
---
Webhooks memungkinkan Anda menerima notifikasi HTTP POST secara real-time ketika terjadi event di akun AnySpend Anda. Konfigurasikan endpoint, pilih event yang ingin Anda langgani, dan pantau riwayat pengiriman.

<Info>
  Semua endpoint manajemen webhook memerlukan izin **admin** kecuali dicatat. Endpoint baca-saja (list, get, deliveries) memerlukan izin **read**.
</Info>

## Autentikasi

```bash
Authorization: Bearer asp_xxx
```

URL Dasar: `https://platform-api.anyspend.com/api/v1`

## Endpoint

### Daftar Webhook

<ParamField path="GET /webhooks" type="read">
  Mengembalikan semua endpoint webhook yang dikonfigurasi untuk akun Anda.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X GET https://platform-api.anyspend.com/api/v1/webhooks \
      -H "Authorization: Bearer asp_xxx"
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    import { AnySpendClient } from "@b3dotfun/sdk/anyspend";

    const client = new AnySpendClient({ apiKey: process.env.ANYSPEND_API_KEY! });
    const webhooks = await client.webhooks.list();
    ```
  </Tab>
</Tabs>

**Respon**

```json
{
  "success": true,
  "data": [
    {
      "id": "wh_abc123",
      "url": "https://myapp.com/webhooks/anyspend",
      "events": ["payment.completed", "payment.failed"],
      "is_active": true,
      "success_count": 142,
      "failure_count": 3,
      "last_triggered_at": "2026-02-27T10:30:00Z",
      "created_at": "2026-01-15T08:00:00Z",
      "updated_at": "2026-02-27T10:30:00Z"
    }
  ]
}
```

---

### Membuat Webhook

<ParamField path="POST /webhooks" type="admin">
  Membuat endpoint webhook baru. Responnya termasuk field `secret` yang digunakan untuk memverifikasi tanda tangan webhook. Simpan ini dengan aman -- hanya dikembalikan sekali pada saat pembuatan.
</ParamField>

<ParamField path="url" type="string" required>
  URL HTTPS yang akan menerima permintaan POST webhook.
</ParamField>

<ParamField path="events" type="string[]" required>
  Array tipe event yang ingin dilanggani. Lihat [Event yang Didukung](#supported-events) di bawah.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X POST https://platform-api.anyspend.com/api/v1/webhooks \
      -H "Authorization: Bearer asp_xxx" \
      -H "Content-Type: application/json" \
      -d '{
        "url": "https://myapp.com/webhooks/anyspend",
        "events": ["payment.completed", "payment.failed", "checkout.completed"]
      }'
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    const webhook = await client.webhooks.create({
      url: "https://myapp.com/webhooks/anyspend",
      events: ["payment.completed", "payment.failed", "checkout.completed"],
    });

    // Simpan webhook.secret dengan aman -- hanya dikembalikan saat pembuatan
    console.log("Signing secret:", webhook.secret);
    ```
  </Tab>
</Tabs>

**Respon**

```json
{
  "success": true,
  "data": {
    "id": "wh_abc123",
    "url": "https://myapp.com/webhooks/anyspend",
    "events": ["payment.completed", "payment.failed", "checkout.completed"],
    "secret": "whsec_a1b2c3d4e5f6...",
    "is_active": true,
    "success_count": 0,
    "failure_count": 0,
    "last_triggered_at": null,
    "created_at": "2026-02-27T12:00:00Z",
    "updated_at": "2026-02-27T12:00:00Z"
  }
}
```

<Warning>
  Field `secret` hanya disertakan dalam respon pembuatan. Salin segera dan simpan di variabel lingkungan atau manajer rahasia Anda.
</Warning>

---

### Mendapatkan Webhook

<ParamField path="GET /webhooks/:id" type="read">
  Mengambil satu endpoint webhook berdasarkan ID.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X GET https://platform-api.anyspend.com/api/v1/webhooks/wh_abc123 \
      -H "Authorization: Bearer asp_xxx"
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    const webhook = await client.webhooks.get("wh_abc123");
    ```
  </Tab>
</Tabs>

---

### Memperbarui Webhook

<ParamField path="PATCH /webhooks/:id" type="admin">
  Memperbarui endpoint webhook yang ada. Semua field bersifat opsional.
</ParamField>

<ParamField path="url" type="string">
  URL endpoint HTTPS yang diperbarui.
</ParamField>

<ParamField path="events" type="string[]">
  Daftar tipe event yang dilanggani yang diperbarui. Menggantikan daftar yang ada sepenuhnya.
</ParamField>

<ParamField path="is_active" type="boolean">
  Atur ke `false` untuk menjeda pengiriman tanpa menghapus endpoint.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X PATCH https://platform-api.anyspend.com/api/v1/webhooks/wh_abc123 \
      -H "Authorization: Bearer asp_xxx" \
      -H "Content-Type: application/json" \
      -d '{
        "events": ["payment.completed", "checkout.completed"],
        "is_active": false
      }'
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    const updated = await client.webhooks.update("wh_abc123", {
      events: ["payment.completed", "checkout.completed"],
      is_active: false,
    });
    ```
  </Tab>
</Tabs>

---

### Menghapus Webhook

<ParamField path="DELETE /webhooks/:id" type="admin">
  Menghapus secara permanen endpoint webhook. Pengiriman yang tertunda akan dibatalkan.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X DELETE https://platform-api.anyspend.com/api/v1/webhooks/wh_abc123 \
      -H "Authorization: Bearer asp_xxx"
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    await client.webhooks.delete("wh_abc123");
    ```
  </Tab>
</Tabs>

---

### Mengirim Webhook Tes

<ParamField path="POST /webhooks/:id/test" type="admin">
  Mengirim event tes ke URL webhook agar Anda dapat memverifikasi endpoint Anda menerima dan memproses event dengan benar. Payload tes menggunakan tipe event `test.ping`.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X POST https://platform-api.anyspend.com/api/v1/webhooks/wh_abc123/test \
      -H "Authorization: Bearer asp_xxx"
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    const result = await client.webhooks.test("wh_abc123");
    // result.delivery_id dapat digunakan untuk memeriksa status pengiriman
    ```
  </Tab>
</Tabs>

**Respon**

```json
{
  "success": true,
  "data": {
    "delivery_id": "del_xyz789",
    "status": "sent",
    "response_code": 200
  }
}
```

---

### Daftar Riwayat Pengiriman

<ParamField path="GET /webhooks/:id/deliveries" type="read">
  Melihat log pengiriman untuk endpoint webhook. Mengembalikan upaya pengiriman terbaru dengan kode status dan waktu respons.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X GET https://platform-api.anyspend.com/api/v1/webhooks/wh_abc123/deliveries \
      -H "Authorization: Bearer asp_xxx"
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    const deliveries = await client.webhooks.listDeliveries("wh_abc123");
    ```
  </Tab>
</Tabs>

**Respon**

```json
{
  "success": true,
  "data": [
    {
      "id": "del_xyz789",
      "event_type": "payment.completed",
      "status": "success",
      "response_code": 200,
      "response_time_ms": 245,
      "attempts": 1,
      "created_at": "2026-02-27T10:30:00Z"
    },
    {
      "id": "del_xyz790",
      "event_type": "payment.failed",
      "status": "failed",
      "response_code": 500,
      "response_time_ms": 3012,
      "attempts": 3,
      "created_at": "2026-02-27T09:15:00Z"
    }
  ]
}
```

---

### Mencoba Kembali Pengiriman yang Gagal

<ParamField path="POST /webhooks/:id/deliveries/:did/retry" type="admin">
  Mencoba kembali pengiriman webhook yang gagal secara manual. Pengiriman harus memiliki status `failed`.
</ParamField>

<Tabs>
  <Tab title="cURL">
    ```bash
    curl -X POST https://platform-api.anyspend.com/api/v1/webhooks/wh_abc123/deliveries/del_xyz790/retry \
      -H "Authorization: Bearer asp_xxx"
    ```
  </Tab>
  <Tab title="SDK">
    ```typescript
    const result = await client.webhooks.retryDelivery("wh_abc123", "del_xyz790");
    ```
  </Tab>
</Tabs>

**Respon**

```json
{
  "success": true,
  "data": {
    "delivery_id": "del_xyz790",
    "status": "sent",
    "response_code": 200,
    "attempts": 4
  }
}
```

---

## Objek Webhook

| Field | Tipe | Deskripsi |
|-------|------|-------------|
| `id` | `string` | Pengenal webhook unik (mis., `wh_abc123`) |
| `url` | `string` | URL endpoint HTTPS |
| `events` | `string[]` | Tipe event yang dilanggani |
| `secret` | `string` | Rahasia tanda tangan (hanya dikembalikan saat pembuatan) |
| `is_active` | `boolean` | Apakah webhook saat ini aktif |
| `success_count` | `number` | Total pengiriman berhasil |
| `failure_count` | `number` | Total pengiriman gagal |
| `last_triggered_at` | `string \| null` | Cap waktu ISO 8601 upaya pengiriman terakhir |
| `created_at` | `string` | Cap waktu pembuatan ISO 8601 |
| `updated_at` | `string` | Cap waktu pembaruan terakhir ISO 8601 |

## Event yang Didukung

| Tipe Event | Deskripsi |
|------------|-------------|
| `payment.completed` | Pembayaran berhasil diproses |
| `payment.failed` | Upaya pembayaran gagal |
| `checkout.completed` | Sesi checkout selesai (termasuk data formulir, pengiriman, info diskon) |

## Memverifikasi Tanda Tangan Webhook

Setiap permintaan webhook mencakup tanda tangan dalam header `X-AnySpend-Signature`. Verifikasilah menggunakan rahasia webhook Anda untuk memastikan permintaan tersebut otentik.

```typescript
import crypto from "crypto";

function verifyWebhookSignature(
  payload: string,
  signature: string,
  secret: string
): boolean {
  const expected = crypto
    .createHmac("sha256", secret)
    .update(payload)
    .digest("hex");
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(expected)
  );
}

// Dalam handler webhook Anda
app.post("/webhooks/anyspend", (req, res) => {
  const signature = req.headers["x-anyspend-signature"];
  const isValid = verifyWebhookSignature(
    JSON.stringify(req.body),
    signature,
    process.env.ANYSPEND_WEBHOOK_SECRET
  );

  if (!isValid) {
    return res.status(401).json({ error: "Invalid signature" });
  }

  // Proses event
  const { type, data } = req.body;
  switch (type) {
    case "payment.completed":
      // Menangani pembayaran yang berhasil
      break;
    case "payment.failed":
      // Menangani pembayaran yang gagal
      break;
  }

  res.status(200).json({ received: true });
});
```

<Note>
  Selalu kembalikan kode status `2xx` dalam waktu 30 detik. Pengiriman yang gagal akan dicoba kembali hingga 3 kali dengan penundaan eksponensial.
</Note>
