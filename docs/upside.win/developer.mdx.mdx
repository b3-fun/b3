---
title: "Game Integration"
description: "Integrate your games with Upside.win using the Upside SDK. Handle game logic in your backend while Upside manages WIN token rewards."
---

## Overview

Integrating with Upside.win is simple. Your game runs in an iframe on our platform, receives player authentication via JWT, and interacts with the Upside backend through our SDK for bet placement and payout processing.

**Key principle**: Your backend handles game logic and state (cards, winners, outcomes), while Upside handles all WIN token transactions.

## Integration Flow

<Steps>
<Step title="Contact B3 Team">
  Reach out to get your game approved and configured on Upside.
  
  ```text
  Contact: developers@upside.win
  Include: Game name, description, game type, and your backend URL
  ```
</Step>

<Step title="Game Loads in Iframe">
  Players launch your game, which loads inside an iframe on upside.win. Your game receives: - JWT token for the player -
  Player authentication context - Access to the Upside SDK
</Step>

<Step title="Frontend: Receive JWT">
  Wrap your game with `ParentProvider` from the Upside SDK to receive the JWT.
  
  ```javascript
  import { ParentProvider } from "@b3dotfun/upside-sdk";
  
  export default function GameApp() {
    return (
      <ParentProvider>
        <YourGameComponent />
      </ParentProvider>
    );
  }
  ```
</Step>

<Step title="Backend: Place Bet">
  When a player starts playing, your backend calls `placeBet` to lock in their wager. ```javascript import{" "}
  {createB3Client} from "@b3dotfun/upside-sdk/server"; const b3Client = createB3Client(); const betResult = await
  b3Client.placeBet( "coin-flip", // gameType "100000000000000000" // betAmount in wei (1 token = 10^18 wei) ); ```
</Step>

<Step title="Backend: Handle Game Logic">
  Your backend: - Determines game outcome (coin lands on heads/tails) - Stores game state in your database - Calculates
  payout amount - Prepares outcome data (player choice, result, outcome)
</Step>

<Step title="Backend: Process Payout">
  When game ends, send the result to Upside to credit the player's WIN balance.
  
  ```javascript
  const payoutResult = await b3Client.processPayout(
    "coin-flip",      // gameType
    sessionId,        // unique game session ID
    payoutAmount,     // WIN tokens to award (0 if loss)
    {
      playerChoice: "heads",
      result: "heads",
      outcome: "win"
    }
  );
  ```
</Step>

<Step title="Frontend: Show Result">
  Your game displays the outcome to the player.
  
  The Upside platform automatically:
  - Updates the player's WIN balance
  - Adds the win/loss to leaderboards
  - Sends notifications
</Step>
</Steps>

## SDK Setup

### Installation

```bash
npm install @b3dotfun/upside-sdk
# or
yarn add @b3dotfun/upside-sdk
# or
pnpm add @b3dotfun/upside-sdk
```

### Frontend: ParentProvider

The `ParentProvider` component connects your game frontend to the Upside platform and provides authentication.

```javascript
import { ParentProvider, useParentContext } from "@b3dotfun/upside-sdk";

export default function CoinFlipGame() {
  return (
    <ParentProvider>
      <GameContent />
    </ParentProvider>
  );
}

function GameContent() {
  const { token, balance, playerId } = useParentContext();

  // token: JWT for authenticating your API calls
  // balance: Player's current WIN balance
  // playerId: Unique player identifier

  return (
    <div>
      <p>Balance: {balance} WIN</p>
      <button onClick={() => startGame(token)}>Play</button>
    </div>
  );
}
```

### Backend: createB3Client

Initialize the B3 client in your backend to interact with Upside's API.

```javascript
import { createB3Client } from "@b3dotfun/upside-sdk/server";

const b3Client = createB3Client({
  apiKey: process.env.UPSIDE_API_KEY,
  environment: "production", // or "staging"
  baseUrl: "https://api.upside.win", // optional, defaults to production
});
```

## Testing on Localhost

### Quick Testing Setup

You can test your game running on localhost directly in the Upside.win test environment without deploying.

**How it works:**

1. Run your game backend on `http://localhost:3000` (or any port)
2. Base64 encode your localhost URL
3. Navigate to the test URL on upside.win

### Step-by-Step

**Step 1: Start your game backend**

```bash
npm run dev
# Game running at http://localhost:3000
```

**Step 2: Base64 encode your URL**

Using Node.js:

```javascript
const url = "http://localhost:3000";
const encoded = Buffer.from(url).toString("base64");
console.log(encoded); // aHR0cDovL2xvY2FsaG9zdDozMDAw
```

Using command line:

```bash
echo -n "http://localhost:3000" | base64
# aHR0cDovL2xvY2FsaG9zdDozMDAw
```

Online: Use any base64 encoder at https://www.base64encode.org/

**Step 3: Test in Upside.win**

Visit the test URL:

```
https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDozMDAw
```

Replace `aHR0cDovL2xvY2FsaG9zdDozMDAw` with your encoded URL.

### Examples

Different localhost URLs:

| URL                     | Base64                         | Test Link                                                    |
| ----------------------- | ------------------------------ | ------------------------------------------------------------ |
| `http://localhost:3000` | `aHR0cDovL2xvY2FsaG9zdDozMDAw` | `https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDozMDAw` |
| `http://localhost:5000` | `aHR0cDovL2xvY2FsaG9zdDo1MDOw` | `https://upside.win/test/games/aHR0cDovL2xvY2FsaG9zdDo1MDOw` |
| `http://127.0.0.1:3000` | `aHR0cDovLzEyNy4wLjAuMTozMDAw` | `https://upside.win/test/games/aHR0cDovLzEyNy4wLjAuMTozMDAw` |

### Development Workflow

1. **Create game code** - Write your React frontend and Node backend
2. **Start locally** - Run `npm run dev` on localhost
3. **Generate test URL** - Base64 encode your localhost address
4. **Test on Upside** - Visit `https://upside.win/test/games/<BASE64>`
5. **Get JWT & test** - Game loads with real JWT for testing
6. **Iterate** - Make changes locally and refresh the test URL
7. **Deploy** - When ready, deploy backend and update game URL

### Tips for Local Testing

- **Use same machine**: Keep localhost running while testing
- **Check CORS**: Ensure your backend allows requests from upside.win domains
- **Use staging API**: Test with `environment: "staging"` first

```javascript
const b3Client = createB3Client({
  apiKey: process.env.STAGING_API_KEY,
  environment: "staging", // Use staging for development
});
```

- **Enable debug logging**:

```javascript
const b3Client = createB3Client({
  apiKey: process.env.UPSIDE_API_KEY,
  environment: "staging",
  debug: true, // See all API calls
});
```

- **Hot reload**: Your code changes will be reflected on page refresh

### Troubleshooting Local Testing

**Problem**: "Game not found" or 404

- **Solution**: Verify localhost URL is correct and encoding is accurate

**Problem**: CORS errors

- **Solution**: Your backend needs to accept requests from upside.win domain

```javascript
// Express example
app.use(
  cors({
    origin: ["https://upside.win", "http://localhost:3000"],
    credentials: true,
  }),
);
```

**Problem**: JWT errors during testing

- **Solution**: Make sure you're using staging API key, not production

**Problem**: Network requests failing

- **Solution**: Check that localhost is running and firewall allows requests

## Core Functions

### placeBet

Start a game session by placing a bet. This locks in the wager and creates a game session.

```javascript
const betResult = await b3Client.placeBet(
  gameType, // string: "coin-flip", "dice", etc.
  betAmount, // string: bet in wei (e.g., "100000000000000000" = 1 token)
);

// Response:
// {
//   sessionId: "session_abc123",
//   gameId: "game_xyz789",
//   status: "active",
//   createdAt: "2024-01-15T10:30:00Z"
// }
```

**Parameters:**

- `gameType` (string): Your game's identifier (e.g., "coin-flip", "dice-roll")
- `betAmount` (string): Bet amount in wei (1 token = 10^18 wei, e.g., "100000000000000000")

**Returns:**

- `sessionId`: Unique identifier for this game session
- `gameId`: Game record identifier
- `status`: Current session status ("active", "completed", "failed")
- `createdAt`: ISO timestamp of bet creation

**Errors:**

- Insufficient player balance
- Invalid game type
- Game not active/enabled
- Invalid bet amount

### processPayout

Complete the game and credit the player's winnings.

```javascript
const payoutResult = await b3Client.processPayout(
  gameType, // string: "coin-flip", etc.
  sessionId, // string: from placeBet response
  payoutAmount, // string: WIN to award in wei (0 for loss)
  {
    playerChoice: "heads", // what player chose/predicted
    result: "heads", // actual game result
    outcome: "win", // "win" or "loss"
  },
);

// Response:
// {
//   status: "completed",
//   payoutAmount: "150000000000000000",
//   newBalance: "1350000000000000000",
//   updatedAt: "2024-01-15T10:30:30Z"
// }
```

**Parameters:**

- `gameType` (string): Same game type from placeBet
- `sessionId` (string): Session ID from placeBet response
- `payoutAmount` (string): WIN tokens to credit in wei (0 for losses, e.g., "150000000000000000" = 1.5 tokens)
- `metadata` (object):
  - `playerChoice`: What the player chose/predicted
  - `result`: The actual game outcome
  - `outcome`: "win" or "loss"

**Returns:**

- `status`: "completed", "failed", etc.
- `payoutAmount`: Amount credited in wei
- `newBalance`: Player's updated WIN balance in wei
- `updatedAt`: ISO timestamp of completion

**Errors:**

- Session not found
- Session already completed (duplicate request)
- Payout exceeds pool limits
- Invalid bet amount format

## Complete Example: Coin Flip Game

### Frontend (React)

```javascript
import { ParentProvider, useParentContext } from "@b3dotfun/upside-sdk";

export default function CoinFlipGame() {
  return (
    <ParentProvider>
      <CoinFlipContent />
    </ParentProvider>
  );
}

function CoinFlipContent() {
  const { token, balance, playerId } = useParentContext();
  const [gameState, setGameState] = useState("ready"); // ready, playing, won, lost
  const [prediction, setPrediction] = useState(null);
  const [result, setResult] = useState(null);
  const [earnings, setEarnings] = useState(0);

  const playGame = async playerPrediction => {
    setPrediction(playerPrediction);
    setGameState("playing");

    try {
      // Call your backend
      const response = await fetch("/api/game/coin-flip", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          playerId,
          prediction: playerPrediction,
          betAmount: "100000000000000000", // 1 token in wei
        }),
      });

      const data = await response.json();

      if (data.outcome === "win") {
        setGameState("won");
        setEarnings(data.payout);
      } else {
        setGameState("lost");
        setEarnings(0);
      }

      setResult(data.result);
    } catch (error) {
      console.error("Game error:", error);
      setGameState("error");
    }
  };

  return (
    <div style={{ textAlign: "center", padding: "40px" }}>
      <h1>Coin Flip</h1>
      <p>Balance: {(balance / 1e18).toFixed(2)} WIN</p>

      {gameState === "ready" && (
        <div>
          <button onClick={() => playGame("heads")}>Predict Heads</button>
          <button onClick={() => playGame("tails")}>Predict Tails</button>
        </div>
      )}

      {gameState === "playing" && <p>Flipping...</p>}

      {gameState === "won" && (
        <div>
          <p>üéâ You won! Coin landed on {result}</p>
          <p>+{(earnings / 1e18).toFixed(2)} WIN</p>
        </div>
      )}

      {gameState === "lost" && (
        <div>
          <p>‚ùå You lost! Coin landed on {result}</p>
          <p>Better luck next time</p>
        </div>
      )}

      {gameState !== "ready" && <button onClick={() => setGameState("ready")}>Play Again</button>}
    </div>
  );
}
```

### Backend (Node.js/Express)

```javascript
import express from "express";
import { createB3Client } from "@b3dotfun/upside-sdk/server";

const app = express();
app.use(express.json());

const b3Client = createB3Client({
  apiKey: process.env.UPSIDE_API_KEY,
});

// Middleware to verify JWT from frontend
const verifyToken = (req, res, next) => {
  const token = req.headers.authorization?.split(" ")[1];
  if (!token) return res.status(401).json({ error: "No token" });

  // Verify token with Upside (or your auth provider)
  req.token = token;
  next();
};

// Game endpoint
app.post("/api/game/coin-flip", verifyToken, async (req, res) => {
  const { playerId, prediction, betAmount } = req.body;
  const sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

  try {
    // Step 1: Place the bet (amounts in wei)
    const betResult = await b3Client.placeBet("coin-flip", betAmount);

    if (!betResult.sessionId) {
      return res.status(400).json({ error: "Failed to place bet" });
    }

    // Step 2: Game logic - flip coin
    const coin = Math.random() < 0.5 ? "heads" : "tails";
    const isWin = coin === prediction;
    // Calculate payout: 50% profit on win (betAmount * 1.5, in wei)
    const payout = isWin ? (BigInt(betAmount) * BigInt(150)) / BigInt(100) : "0";

    // Step 3: Store game in your DB (for history, analytics, etc.)
    await saveGameToDatabase({
      sessionId: betResult.sessionId,
      playerId,
      gameType: "coin-flip",
      prediction,
      result: coin,
      betAmount,
      payout: payout.toString(),
      outcome: isWin ? "win" : "loss",
    });

    // Step 4: Process payout
    const payoutResult = await b3Client.processPayout("coin-flip", betResult.sessionId, payout.toString(), {
      playerChoice: prediction,
      result: coin,
      outcome: isWin ? "win" : "loss",
    });

    // Step 5: Return result to frontend
    res.json({
      sessionId: betResult.sessionId,
      prediction,
      result: coin,
      outcome: isWin ? "win" : "loss",
      payout: isWin ? payout.toString() : "0",
      newBalance: payoutResult.newBalance,
    });
  } catch (error) {
    console.error("Game error:", error);
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => console.log("Game server running on port 3000"));
```

## Best Practices

### Bet Placement

- **Always validate amounts**: Check bet is within player balance
- **Use idempotency**: Retry failed `placeBet` calls with the same sessionId
- **Lock immediately**: Once `placeBet` succeeds, prevent player from placing another bet

### Game Logic

- **Backend is source of truth**: Never trust client-side game outcomes
- **Store everything**: Log all game events for audits and disputes
- **Validate results**: Ensure game outcome matches expected range
- **Timeout games**: Cancel bets if no payout is processed within 5 minutes

### Payout Processing

- **Process once**: Only call `processPayout` once per game session
- **Use correct amounts**: Verify payout calculation before sending
- **Handle duplicates**: If `processPayout` returns "already completed", that's OK
- **Handle failures**: Retry failed payouts, but check if already paid first

### Security

- **Verify tokens**: Always validate JWT in every backend request
- **Use HTTPS**: All communication must be encrypted
- **Never expose API keys**: Keep `UPSIDE_API_KEY` server-side only
- **Validate game types**: Only allow known, approved game types
- **Rate limit**: Implement rate limiting to prevent abuse

### Error Handling

```javascript
async function safePlayGame(gameType, betAmount) {
  try {
    // Place bet
    let betResult;
    try {
      betResult = await b3Client.placeBet(gameType, betAmount);
    } catch (error) {
      if (error.message.includes("Insufficient balance")) {
        return { error: "Player balance too low" };
      }
      throw error;
    }

    // Run game logic
    const outcome = await runGameLogic();

    // Process payout
    try {
      const payout = outcome.isWin ? betAmount * 1.5 : "0";
      await b3Client.processPayout(gameType, betResult.sessionId, payout, {
        playerChoice: outcome.choice,
        result: outcome.result,
        outcome: outcome.isWin ? "win" : "loss",
      });
    } catch (error) {
      if (error.message.includes("already completed")) {
        console.log("Payout already processed for session");
      } else {
        throw error;
      }
    }

    return outcome;
  } catch (error) {
    console.error("Game error:", error);
    throw error;
  }
}
```

## Troubleshooting

### Common Issues

**Problem**: `placeBet` fails with "Insufficient balance"

- **Solution**: Check player balance before placing bet, or increase bet amount display in UI

**Problem**: `processPayout` returns "session not found"

- **Solution**: Verify sessionId matches bet response, check for typos

**Problem**: Duplicate game sessions or bets

- **Solution**: Use same sessionId for retries, implement idempotency on your end

**Problem**: JWT expires during gameplay

- **Solution**: Refresh token before game starts, handle token expiration gracefully

**Problem**: Game logic runs on client, leading to cheating

- **Solution**: Move ALL game logic to backend, client only displays results

## What Can You Build?

<CardGroup cols={2}>
<Card title="Prediction Games" icon="crystal-ball">
  Coin flips, roulette, choice prediction
</Card>

<Card title="Skill Games" icon="brain">
  Puzzles, quizzes, memory games with progressive difficulty
</Card>

<Card title="Chance Games" icon="dice">
  Dice rolls, card draws, number generation
</Card>

<Card title="Tournament Games" icon="trophy">
  Ranked competitions, brackets, seasonal events
</Card>

<Card title="Hybrid Games" icon="gamepad">
  Mix of skill and chance for engagement
</Card>

<Card title="Multiplayer Games" icon="users">
  Head-to-head or team-based competitions
</Card>
</CardGroup>

## Support

<CardGroup cols={2}>
<Card title="SDK Documentation" icon="book" href="https://docs.upside.win/sdk">
  Complete SDK API reference
</Card>

<Card title="Discord Community" icon="discord" href="https://discord.gg/upside">
  Get help from the team and other developers
</Card>

<Card title="GitHub Examples" icon="github" href="https://github.com/upside-games">
  Complete game implementations
</Card>

<Card title="API Endpoints" icon="code" href="/upside/api">
  Full API reference documentation
</Card>
</CardGroup>
